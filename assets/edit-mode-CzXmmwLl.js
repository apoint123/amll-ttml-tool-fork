import{m as q,e as Q,h as ue,l as D,k as a,aa as B,z as he,ba as H,y as J,E as xe,g as ee,a as U,f as X,u as te,A as ae,p as be,b2 as ge,d as re,s as le,__tla as pe}from"./index-B3K8Wc-q.js";import{R as I,a as je,__tla as ye}from"./common-89fW9bAI.js";let Z,we=Promise.all([(()=>{try{return pe}catch{}})(),(()=>{try{return ye}catch{}})()]).then(async()=>{globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(r,e){return this.cache.has(r)?this.cache.get(r):(this.cache.set(r,e),e)}},globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(r,e){return this.cache.has(r)?this.cache.get(r):(this.cache.set(r,e),e)}};const A=Symbol("multiple-values");function N(r){const e=Q.c(36),{label:t,isWordField:s,fieldName:l,formatter:h,parser:x,textFieldStyle:n}=r,[b,o]=q.useState(void 0),[g,d]=q.useState("");let V;V=s?re:le;const v=V,z=ee(D);let Y,p;e[0]!==l||e[1]!==h||e[2]!==s||e[3]!==v?(p=U(u=>{const C=u(v),M=u(D);if(C.size===0)return;if(s){const G=C,O=new Set;for(const me of M.lyricLines)for(const $ of me.words)G.has($.id)&&O.add($[l]);return O.size===1?h(O.values().next().value):A}const P=C,E=new Set;for(const G of M.lyricLines)P.has(G.id)&&E.add(G[l]);return E.size===1?h(E.values().next().value):A}),e[0]=l,e[1]=h,e[2]=s,e[3]=v,e[4]=p):p=e[4],Y=p;const i=X(Y),_=te();let j;e[5]!==i||e[6]!==z||e[7]!==l||e[8]!==s||e[9]!==v||e[10]!==x||e[11]!==_?(j=u=>{try{const C=_.get(v),M=x(u);z(P=>{for(const E of P.lyricLines)if(s)for(const G of E.words)C.has(G.id)&&(G[l]=M);else C.has(E.id)&&(E[l]=M);return P})}catch(C){console.warn("EditField.onInputFinished",C),typeof i=="string"&&o(i)}},e[5]=i,e[6]=z,e[7]=l,e[8]=s,e[9]=v,e[10]=x,e[11]=_,e[12]=j):j=e[12];const y=j;let c,w;e[13]!==i?(c=()=>{i===A?(o(""),d("\u591A\u4E2A\u503C...")):(o(i),d(""))},w=[i],e[13]=i,e[14]=c,e[15]=w):(c=e[14],w=e[15]),q.useLayoutEffect(c,w);let f;e[16]!==t?(f=a.jsx(ae,{wrap:"nowrap",size:"1",children:t}),e[16]=t,e[17]=f):f=e[17];let m;e[18]!==n?(m={width:"8em",...n},e[18]=n,e[19]=m):m=e[19];const S=b??"",T=b===void 0;let L;e[20]===Symbol.for("react.memo_cache_sentinel")?(L=u=>o(u.currentTarget.value),e[20]=L):L=e[20];let W;e[21]!==y?(W=u=>{u.key==="Enter"&&y(u.currentTarget.value)},e[21]=y,e[22]=W):W=e[22];let F;e[23]!==i||e[24]!==y?(F=u=>{u.currentTarget.value!==i&&y(u.currentTarget.value)},e[23]=i,e[24]=y,e[25]=F):F=e[25];let k;e[26]!==g||e[27]!==T||e[28]!==W||e[29]!==F||e[30]!==m||e[31]!==S?(k=a.jsx(be,{size:"1",style:m,value:S,placeholder:g,disabled:T,onChange:L,onKeyDown:W,onBlur:F}),e[26]=g,e[27]=T,e[28]=W,e[29]=F,e[30]=m,e[31]=S,e[32]=k):k=e[32];let K;return e[33]!==k||e[34]!==f?(K=a.jsxs(a.Fragment,{children:[f,k]}),e[33]=k,e[34]=f,e[35]=K):K=e[35],K}function R(r){const e=Q.c(21),{label:t,isWordField:s,fieldName:l,defaultValue:h}=r;let x;x=s?re:le;const n=x,b=ee(D),o=te();let g,d;e[0]!==l||e[1]!==s||e[2]!==n?(d=U(c=>{const w=c(n),f=c(D);if(w.size){if(s){const T=w,L=new Set;for(const W of f.lyricLines)for(const F of W.words)T.has(F.id)&&L.add(F[l]);return L.size===1?L.values().next().value:A}const m=w,S=new Set;for(const T of f.lyricLines)m.has(T.id)&&S.add(T[l]);return S.size===1?S.values().next().value:A}}),e[0]=l,e[1]=s,e[2]=n,e[3]=d):d=e[3],g=d;const V=X(g);let v,z;e[4]!==n?(z=U(c=>c(n).size===0),e[4]=n,e[5]=z):z=e[5],v=z;const Y=X(v);let p;e[6]!==t?(p=a.jsx(ae,{wrap:"nowrap",size:"1",children:t}),e[6]=t,e[7]=p):p=e[7];const i=V?V===A?"indeterminate":V:h;let _;e[8]!==b||e[9]!==l||e[10]!==s||e[11]!==n||e[12]!==o?(_=c=>{c!=="indeterminate"&&b(w=>{const f=o.get(n);for(const m of w.lyricLines)if(s)for(const S of m.words)f.has(S.id)&&(S[l]=c);else f.has(m.id)&&(m[l]=c);return w})},e[8]=b,e[9]=l,e[10]=s,e[11]=n,e[12]=o,e[13]=_):_=e[13];let j;e[14]!==Y||e[15]!==i||e[16]!==_?(j=a.jsx(ge,{disabled:Y,checked:i,onCheckedChange:_}),e[14]=Y,e[15]=i,e[16]=_,e[17]=j):j=e[17];let y;return e[18]!==p||e[19]!==j?(y=a.jsxs(a.Fragment,{children:[p,j]}),e[18]=p,e[19]=j,e[20]=y):y=e[20],y}Z=q.forwardRef((r,e)=>{const t=Q.c(11),s=ue(D);let l;t[0]!==s?(l=a.jsx(I,{label:"\u65B0\u5EFA",children:a.jsx(B,{columns:"1",gap:"1",gapY:"1",flexGrow:"1",align:"center",children:a.jsx(he,{size:"1",variant:"soft",onClick:()=>s(se),children:"\u6B4C\u8BCD\u884C"})})}),t[0]=s,t[1]=l):l=t[1];let h;t[2]===Symbol.for("react.memo_cache_sentinel")?(h=a.jsx(I,{label:"\u884C\u65F6\u95F4\u6233",children:a.jsxs(B,{columns:"0fr 1fr",gap:"2",gapY:"1",flexGrow:"1",align:"center",children:[a.jsx(N,{label:"\u8D77\u59CB\u65F6\u95F4",fieldName:"startTime",parser:H,formatter:J}),a.jsx(N,{label:"\u7ED3\u675F\u65F6\u95F4",fieldName:"endTime",parser:H,formatter:J})]})}),t[2]=h):h=t[2];let x;t[3]===Symbol.for("react.memo_cache_sentinel")?(x=a.jsx(I,{label:"\u884C\u5C5E\u6027",children:a.jsxs(B,{columns:"0fr 1fr",gap:"2",gapY:"1",flexGrow:"1",align:"center",children:[a.jsx(R,{label:"\u80CC\u666F\u6B4C\u8BCD",isWordField:!1,fieldName:"isBG",defaultValue:!1}),a.jsx(R,{label:"\u5BF9\u5531\u6B4C\u8BCD",isWordField:!1,fieldName:"isDuet",defaultValue:!1}),a.jsx(R,{label:"\u5FFD\u7565\u6253\u8F74",isWordField:!1,fieldName:"ignoreSync",defaultValue:!1})]})}),t[3]=x):x=t[3];let n;t[4]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(I,{label:"\u8BCD\u65F6\u95F4\u6233",children:a.jsxs(B,{columns:"0fr 1fr",gap:"2",gapY:"1",flexGrow:"1",align:"center",children:[a.jsx(N,{label:"\u8D77\u59CB\u65F6\u95F4",fieldName:"startTime",isWordField:!0,parser:H,formatter:J}),a.jsx(N,{label:"\u7ED3\u675F\u65F6\u95F4",fieldName:"endTime",isWordField:!0,parser:H,formatter:J}),a.jsx(N,{label:"\u7A7A\u62CD\u6570\u91CF",fieldName:"emptyBeat",isWordField:!0,parser:Number.parseInt,formatter:String})]})}),t[4]=n):n=t[4];let b;t[5]===Symbol.for("react.memo_cache_sentinel")?(b=a.jsx(I,{label:"\u5355\u8BCD\u5C5E\u6027",children:a.jsxs(B,{columns:"0fr 1fr",gap:"2",gapY:"1",flexGrow:"1",align:"center",children:[a.jsx(N,{label:"\u5355\u8BCD\u5185\u5BB9",fieldName:"word",isWordField:!0,parser:ne,formatter:ie}),a.jsx(R,{label:"\u4E0D\u96C5\u7528\u8BED",isWordField:!0,fieldName:"obscene",defaultValue:!1})]})}),t[5]=b):b=t[5];let o;t[6]===Symbol.for("react.memo_cache_sentinel")?(o=a.jsx(N,{label:"\u7FFB\u8BD1\u6B4C\u8BCD",fieldName:"translatedLyric",parser:oe,formatter:ce,textFieldStyle:{width:"20em"}}),t[6]=o):o=t[6];let g;t[7]===Symbol.for("react.memo_cache_sentinel")?(g=a.jsx(I,{label:"\u6B21\u8981\u5185\u5BB9",children:a.jsxs(B,{columns:"0fr 1fr",gap:"2",gapY:"1",flexGrow:"1",align:"center",children:[o,a.jsx(N,{label:"\u97F3\u8BD1\u6B4C\u8BCD",fieldName:"romanLyric",parser:de,formatter:fe,textFieldStyle:{width:"20em"}})]})}),t[7]=g):g=t[7];let d;return t[8]!==e||t[9]!==l?(d=a.jsxs(je,{ref:e,children:[l,h,x,n,b,g]}),t[8]=e,t[9]=l,t[10]=d):d=t[10],d});function se(r){return{...r,lyricLines:[...r.lyricLines,xe()]}}function ne(r){return r}function ie(r){return r}function oe(r){return r}function ce(r){return r}function de(r){return r}function fe(r){return r}});export{Z as EditModeRibbonBar,we as __tla,Z as default};
