import{G as vf,H as ps,I as bf,m as it,k as tr,J as xf,e as _f,f as Me,o as Ef,l as Tf,w as wf,K as Af,L as Mf,M as Sf,N as Rf,__tla as If}from"./index-B3K8Wc-q.js";import{s as Lf,a as Ff,l as Nf,__tla as Of}from"./preview-B8M52awC.js";let Zi,Pf=Promise.all([(()=>{try{return If}catch{}})(),(()=>{try{return Of}catch{}})()]).then(async()=>{var he=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(he||{}),sn=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(sn||{}),bs=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(bs||{}),et=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(et||{}),xr=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(xr||{}),X=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(X||{}),Se=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(Se||{}),ot=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(ot||{}),$=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))($||{}),Yt=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(Yt||{}),xs=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(xs||{}),le=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(le||{}),ue=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(ue||{}),ce=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(ce||{}),_s=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(_s||{}),kt=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(kt||{}),Rt=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(Rt||{}),St=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(St||{}),Ht=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Ht||{});const qh={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},ft={ADAPTER:qh,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Es=/iPhone/i,nn=/iPod/i,an=/iPad/i,on=/\biOS-universal(?:.+)Mac\b/i,Ts=/\bAndroid(?:.+)Mobile\b/i,hn=/Android/i,Re=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,_r=/Silk/i,Kt=/Windows Phone/i,ln=/\bWindows(?:.+)ARM\b/i,un=/BlackBerry/i,cn=/BB10/i,dn=/Opera Mini/i,fn=/\b(CriOS|Chrome)(?:.+)Mobile/i,pn=/Mobile(?:.+)Firefox\b/i,mn=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function Yh(s){return function(t){return t.test(s)}}function gn(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var i=Yh(e),n={apple:{phone:i(Es)&&!i(Kt),ipod:i(nn),tablet:!i(Es)&&(i(an)||mn(t))&&!i(Kt),universal:i(on),device:(i(Es)||i(nn)||i(an)||i(on)||mn(t))&&!i(Kt)},amazon:{phone:i(Re),tablet:!i(Re)&&i(_r),device:i(Re)||i(_r)},android:{phone:!i(Kt)&&i(Re)||!i(Kt)&&i(Ts),tablet:!i(Kt)&&!i(Re)&&!i(Ts)&&(i(_r)||i(hn)),device:!i(Kt)&&(i(Re)||i(_r)||i(Ts)||i(hn))||i(/\bokhttp\b/i)},windows:{phone:i(Kt),tablet:i(ln),device:i(Kt)||i(ln)},other:{blackberry:i(un),blackberry10:i(cn),opera:i(dn),firefox:i(pn),chrome:i(fn),device:i(un)||i(cn)||i(dn)||i(pn)||i(fn)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Kh=gn.default??gn,Ie=Kh(globalThis.navigator);ft.RETINA_PREFIX=/@([0-9\.]+)x/,ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var yn={exports:{}},vn;function Zh(){return vn||(vn=1,function(s){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function i(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,d,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new i(u,d||h,c),v=e?e+l:l;return h._events[v]?h._events[v].fn?h._events[v]=[h._events[v],p]:h._events[v].push(p):(h._events[v]=p,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var h=[],l,u;if(this._eventsCount===0)return h;for(u in l=this._events)t.call(l,u)&&h.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(l)):h},o.prototype.listeners=function(h){var l=e?e+h:h,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,c=u.length,p=new Array(c);d<c;d++)p[d]=u[d].fn;return p},o.prototype.listenerCount=function(h){var l=e?e+h:h,u=this._events[l];return u?u.fn?1:u.length:0},o.prototype.emit=function(h,l,u,d,c,p){var v=e?e+h:h;if(!this._events[v])return!1;var f=this._events[v],m=arguments.length,y,x;if(f.fn){switch(f.once&&this.removeListener(h,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,l),!0;case 3:return f.fn.call(f.context,l,u),!0;case 4:return f.fn.call(f.context,l,u,d),!0;case 5:return f.fn.call(f.context,l,u,d,c),!0;case 6:return f.fn.call(f.context,l,u,d,c,p),!0}for(x=1,y=new Array(m-1);x<m;x++)y[x-1]=arguments[x];f.fn.apply(f.context,y)}else{var T=f.length,M;for(x=0;x<T;x++)switch(f[x].once&&this.removeListener(h,f[x].fn,void 0,!0),m){case 1:f[x].fn.call(f[x].context);break;case 2:f[x].fn.call(f[x].context,l);break;case 3:f[x].fn.call(f[x].context,l,u);break;case 4:f[x].fn.call(f[x].context,l,u,d);break;default:if(!y)for(M=1,y=new Array(m-1);M<m;M++)y[M-1]=arguments[M];f[x].fn.apply(f[x].context,y)}}return!0},o.prototype.on=function(h,l,u){return n(this,h,l,u,!1)},o.prototype.once=function(h,l,u){return n(this,h,l,u,!0)},o.prototype.removeListener=function(h,l,u,d){var c=e?e+h:h;if(!this._events[c])return this;if(!l)return a(this,c),this;var p=this._events[c];if(p.fn)p.fn===l&&(!d||p.once)&&(!u||p.context===u)&&a(this,c);else{for(var v=0,f=[],m=p.length;v<m;v++)(p[v].fn!==l||d&&!p[v].once||u&&p[v].context!==u)&&f.push(p[v]);f.length?this._events[c]=f.length===1?f[0]:f:a(this,c)}return this},o.prototype.removeAllListeners=function(h){var l;return h?(l=e?e+h:h,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o}(yn)),yn.exports}var Jh=Zh();const Er=vf(Jh);var Tr={exports:{}},bn;function Qh(){if(bn)return Tr.exports;bn=1,Tr.exports=s,Tr.exports.default=s;function s(E,w,_){_=_||2;var O=w&&w.length,A=O?w[0]*_:E.length,R=t(E,0,A,_,!0),N=[];if(!R||R.next===R.prev)return N;var F,j,z,q,J,tt,K;if(O&&(R=h(E,w,R,_)),E.length>80*_){F=z=E[0],j=q=E[1];for(var W=_;W<A;W+=_)J=E[W],tt=E[W+1],J<F&&(F=J),tt<j&&(j=tt),J>z&&(z=J),tt>q&&(q=tt);K=Math.max(z-F,q-j),K=K!==0?32767/K:0}return r(R,N,_,F,j,K,0),N}function t(E,w,_,O,A){var R,N;if(A===V(E,w,_,O)>0)for(R=w;R<_;R+=O)N=U(R,E[R],E[R+1],N);else for(R=_-O;R>=w;R-=O)N=U(R,E[R],E[R+1],N);return N&&M(N,N.next)&&(Y(N),N=N.next),N}function e(E,w){if(!E)return E;w||(w=E);var _=E,O;do if(O=!1,!_.steiner&&(M(_,_.next)||T(_.prev,_,_.next)===0)){if(Y(_),_=w=_.prev,_===_.next)break;O=!0}else _=_.next;while(O||_!==w);return w}function r(E,w,_,O,A,R,N){if(E){!N&&R&&p(E,O,A,R);for(var F=E,j,z;E.prev!==E.next;){if(j=E.prev,z=E.next,R?n(E,O,A,R):i(E)){w.push(j.i/_|0),w.push(E.i/_|0),w.push(z.i/_|0),Y(E),E=z.next,F=z.next;continue}if(E=z,E===F){N?N===1?(E=a(e(E),w,_),r(E,w,_,O,A,R,2)):N===2&&o(E,w,_,O,A,R):r(e(E),w,_,O,A,R,1);break}}}}function i(E){var w=E.prev,_=E,O=E.next;if(T(w,_,O)>=0)return!1;for(var A=w.x,R=_.x,N=O.x,F=w.y,j=_.y,z=O.y,q=A<R?A<N?A:N:R<N?R:N,J=F<j?F<z?F:z:j<z?j:z,tt=A>R?A>N?A:N:R>N?R:N,K=F>j?F>z?F:z:j>z?j:z,W=O.next;W!==w;){if(W.x>=q&&W.x<=tt&&W.y>=J&&W.y<=K&&y(A,F,R,j,N,z,W.x,W.y)&&T(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n(E,w,_,O){var A=E.prev,R=E,N=E.next;if(T(A,R,N)>=0)return!1;for(var F=A.x,j=R.x,z=N.x,q=A.y,J=R.y,tt=N.y,K=F<j?F<z?F:z:j<z?j:z,W=q<J?q<tt?q:tt:J<tt?J:tt,Q=F>j?F>z?F:z:j>z?j:z,st=q>J?q>tt?q:tt:J>tt?J:tt,dt=f(K,W,w,_,O),vt=f(Q,st,w,_,O),Z=E.prevZ,rt=E.nextZ;Z&&Z.z>=dt&&rt&&rt.z<=vt;){if(Z.x>=K&&Z.x<=Q&&Z.y>=W&&Z.y<=st&&Z!==A&&Z!==N&&y(F,q,j,J,z,tt,Z.x,Z.y)&&T(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,rt.x>=K&&rt.x<=Q&&rt.y>=W&&rt.y<=st&&rt!==A&&rt!==N&&y(F,q,j,J,z,tt,rt.x,rt.y)&&T(rt.prev,rt,rt.next)>=0))return!1;rt=rt.nextZ}for(;Z&&Z.z>=dt;){if(Z.x>=K&&Z.x<=Q&&Z.y>=W&&Z.y<=st&&Z!==A&&Z!==N&&y(F,q,j,J,z,tt,Z.x,Z.y)&&T(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;rt&&rt.z<=vt;){if(rt.x>=K&&rt.x<=Q&&rt.y>=W&&rt.y<=st&&rt!==A&&rt!==N&&y(F,q,j,J,z,tt,rt.x,rt.y)&&T(rt.prev,rt,rt.next)>=0)return!1;rt=rt.nextZ}return!0}function a(E,w,_){var O=E;do{var A=O.prev,R=O.next.next;!M(A,R)&&g(A,O,O.next,R)&&C(A,R)&&C(R,A)&&(w.push(A.i/_|0),w.push(O.i/_|0),w.push(R.i/_|0),Y(O),Y(O.next),O=E=R),O=O.next}while(O!==E);return e(O)}function o(E,w,_,O,A,R){var N=E;do{for(var F=N.next.next;F!==N.prev;){if(N.i!==F.i&&x(N,F)){var j=D(N,F);N=e(N,N.next),j=e(j,j.next),r(N,w,_,O,A,R,0),r(j,w,_,O,A,R,0);return}F=F.next}N=N.next}while(N!==E)}function h(E,w,_,O){var A=[],R,N,F,j,z;for(R=0,N=w.length;R<N;R++)F=w[R]*O,j=R<N-1?w[R+1]*O:E.length,z=t(E,F,j,O,!1),z===z.next&&(z.steiner=!0),A.push(m(z));for(A.sort(l),R=0;R<A.length;R++)_=u(A[R],_);return _}function l(E,w){return E.x-w.x}function u(E,w){var _=d(E,w);if(!_)return w;var O=D(_,E);return e(O,O.next),e(_,_.next)}function d(E,w){var _=w,O=E.x,A=E.y,R=-1/0,N;do{if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){var F=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(F<=O&&F>R&&(R=F,N=_.x<_.next.x?_:_.next,F===O))return N}_=_.next}while(_!==w);if(!N)return null;var j=N,z=N.x,q=N.y,J=1/0,tt;_=N;do O>=_.x&&_.x>=z&&O!==_.x&&y(A<q?O:R,A,z,q,A<q?R:O,A,_.x,_.y)&&(tt=Math.abs(A-_.y)/(O-_.x),C(_,E)&&(tt<J||tt===J&&(_.x>N.x||_.x===N.x&&c(N,_)))&&(N=_,J=tt)),_=_.next;while(_!==j);return N}function c(E,w){return T(E.prev,E,w.prev)<0&&T(w.next,E,E.next)<0}function p(E,w,_,O){var A=E;do A.z===0&&(A.z=f(A.x,A.y,w,_,O)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==E);A.prevZ.nextZ=null,A.prevZ=null,v(A)}function v(E){var w,_,O,A,R,N,F,j,z=1;do{for(_=E,E=null,R=null,N=0;_;){for(N++,O=_,F=0,w=0;w<z&&(F++,O=O.nextZ,!!O);w++);for(j=z;F>0||j>0&&O;)F!==0&&(j===0||!O||_.z<=O.z)?(A=_,_=_.nextZ,F--):(A=O,O=O.nextZ,j--),R?R.nextZ=A:E=A,A.prevZ=R,R=A;_=O}R.nextZ=null,z*=2}while(N>1);return E}function f(E,w,_,O,A){return E=(E-_)*A|0,w=(w-O)*A|0,E=(E|E<<8)&16711935,E=(E|E<<4)&252645135,E=(E|E<<2)&858993459,E=(E|E<<1)&1431655765,w=(w|w<<8)&16711935,w=(w|w<<4)&252645135,w=(w|w<<2)&858993459,w=(w|w<<1)&1431655765,E|w<<1}function m(E){var w=E,_=E;do(w.x<_.x||w.x===_.x&&w.y<_.y)&&(_=w),w=w.next;while(w!==E);return _}function y(E,w,_,O,A,R,N,F){return(A-N)*(w-F)>=(E-N)*(R-F)&&(E-N)*(O-F)>=(_-N)*(w-F)&&(_-N)*(R-F)>=(A-N)*(O-F)}function x(E,w){return E.next.i!==w.i&&E.prev.i!==w.i&&!B(E,w)&&(C(E,w)&&C(w,E)&&G(E,w)&&(T(E.prev,E,w.prev)||T(E,w.prev,w))||M(E,w)&&T(E.prev,E,E.next)>0&&T(w.prev,w,w.next)>0)}function T(E,w,_){return(w.y-E.y)*(_.x-w.x)-(w.x-E.x)*(_.y-w.y)}function M(E,w){return E.x===w.x&&E.y===w.y}function g(E,w,_,O){var A=b(T(E,w,_)),R=b(T(E,w,O)),N=b(T(_,O,E)),F=b(T(_,O,w));return!!(A!==R&&N!==F||A===0&&S(E,_,w)||R===0&&S(E,O,w)||N===0&&S(_,E,O)||F===0&&S(_,w,O))}function S(E,w,_){return w.x<=Math.max(E.x,_.x)&&w.x>=Math.min(E.x,_.x)&&w.y<=Math.max(E.y,_.y)&&w.y>=Math.min(E.y,_.y)}function b(E){return E>0?1:E<0?-1:0}function B(E,w){var _=E;do{if(_.i!==E.i&&_.next.i!==E.i&&_.i!==w.i&&_.next.i!==w.i&&g(_,_.next,E,w))return!0;_=_.next}while(_!==E);return!1}function C(E,w){return T(E.prev,E,E.next)<0?T(E,w,E.next)>=0&&T(E,E.prev,w)>=0:T(E,w,E.prev)<0||T(E,E.next,w)<0}function G(E,w){var _=E,O=!1,A=(E.x+w.x)/2,R=(E.y+w.y)/2;do _.y>R!=_.next.y>R&&_.next.y!==_.y&&A<(_.next.x-_.x)*(R-_.y)/(_.next.y-_.y)+_.x&&(O=!O),_=_.next;while(_!==E);return O}function D(E,w){var _=new H(E.i,E.x,E.y),O=new H(w.i,w.x,w.y),A=E.next,R=w.prev;return E.next=w,w.prev=E,_.next=A,A.prev=_,O.next=_,_.prev=O,R.next=O,O.prev=R,O}function U(E,w,_,O){var A=new H(E,w,_);return O?(A.next=O.next,A.prev=O,O.next.prev=A,O.next=A):(A.prev=A,A.next=A),A}function Y(E){E.next.prev=E.prev,E.prev.next=E.next,E.prevZ&&(E.prevZ.nextZ=E.nextZ),E.nextZ&&(E.nextZ.prevZ=E.prevZ)}function H(E,w,_){this.i=E,this.x=w,this.y=_,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}s.deviation=function(E,w,_,O){var A=w&&w.length,R=A?w[0]*_:E.length,N=Math.abs(V(E,0,R,_));if(A)for(var F=0,j=w.length;F<j;F++){var z=w[F]*_,q=F<j-1?w[F+1]*_:E.length;N-=Math.abs(V(E,z,q,_))}var J=0;for(F=0;F<O.length;F+=3){var tt=O[F]*_,K=O[F+1]*_,W=O[F+2]*_;J+=Math.abs((E[tt]-E[W])*(E[K+1]-E[tt+1])-(E[tt]-E[K])*(E[W+1]-E[tt+1]))}return N===0&&J===0?0:Math.abs((J-N)/N)};function V(E,w,_,O){for(var A=0,R=w,N=_-O;R<_;R+=O)A+=(E[N]-E[R])*(E[R+1]+E[N+1]),N=R;return A}return s.flatten=function(E){for(var w=E[0][0].length,_={vertices:[],holes:[],dimensions:w},O=0,A=0;A<E.length;A++){for(var R=0;R<E[A].length;R++)for(var N=0;N<w;N++)_.vertices.push(E[A][R][N]);A>0&&(O+=E[A-1].length,_.holes.push(O))}return _},Tr.exports}Qh();var de={},wr={exports:{}},tl=wr.exports,xn;function el(){return xn||(xn=1,function(s,t){(function(e){var r=t&&!t.nodeType&&t,i=!s.nodeType&&s,n=typeof ps=="object"&&ps;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,l=1,u=26,d=38,c=700,p=72,v=128,f="-",m=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=h-l,g=Math.floor,S=String.fromCharCode,b;function B(A){throw new RangeError(T[A])}function C(A,R){for(var N=A.length,F=[];N--;)F[N]=R(A[N]);return F}function G(A,R){var N=A.split("@"),F="";N.length>1&&(F=N[0]+"@",A=N[1]),A=A.replace(x,".");var j=A.split("."),z=C(j,R).join(".");return F+z}function D(A){for(var R=[],N=0,F=A.length,j,z;N<F;)j=A.charCodeAt(N++),j>=55296&&j<=56319&&N<F?(z=A.charCodeAt(N++),(z&64512)==56320?R.push(((j&1023)<<10)+(z&1023)+65536):(R.push(j),N--)):R.push(j);return R}function U(A){return C(A,function(R){var N="";return R>65535&&(R-=65536,N+=S(R>>>10&1023|55296),R=56320|R&1023),N+=S(R),N}).join("")}function Y(A){return A-48<10?A-22:A-65<26?A-65:A-97<26?A-97:h}function H(A,R){return A+22+75*(A<26)-((R!=0)<<5)}function V(A,R,N){var F=0;for(A=N?g(A/c):A>>1,A+=g(A/R);A>M*u>>1;F+=h)A=g(A/M);return g(F+(M+1)*A/(A+d))}function E(A){var R=[],N=A.length,F,j=0,z=v,q=p,J,tt,K,W,Q,st,dt,vt,Z;for(J=A.lastIndexOf(f),J<0&&(J=0),tt=0;tt<J;++tt)A.charCodeAt(tt)>=128&&B("not-basic"),R.push(A.charCodeAt(tt));for(K=J>0?J+1:0;K<N;){for(W=j,Q=1,st=h;K>=N&&B("invalid-input"),dt=Y(A.charCodeAt(K++)),(dt>=h||dt>g((o-j)/Q))&&B("overflow"),j+=dt*Q,vt=st<=q?l:st>=q+u?u:st-q,!(dt<vt);st+=h)Z=h-vt,Q>g(o/Z)&&B("overflow"),Q*=Z;F=R.length+1,q=V(j-W,F,W==0),g(j/F)>o-z&&B("overflow"),z+=g(j/F),j%=F,R.splice(j++,0,z)}return U(R)}function w(A){var R,N,F,j,z,q,J,tt,K,W,Q,st=[],dt,vt,Z,rt;for(A=D(A),dt=A.length,R=v,N=0,z=p,q=0;q<dt;++q)Q=A[q],Q<128&&st.push(S(Q));for(F=j=st.length,j&&st.push(f);F<dt;){for(J=o,q=0;q<dt;++q)Q=A[q],Q>=R&&Q<J&&(J=Q);for(vt=F+1,J-R>g((o-N)/vt)&&B("overflow"),N+=(J-R)*vt,R=J,q=0;q<dt;++q)if(Q=A[q],Q<R&&++N>o&&B("overflow"),Q==R){for(tt=N,K=h;W=K<=z?l:K>=z+u?u:K-z,!(tt<W);K+=h)rt=tt-W,Z=h-W,st.push(S(H(W+rt%Z,0))),tt=g(rt/Z);st.push(S(H(tt,0))),z=V(N,vt,F==j),N=0,++F}++N,++R}return st.join("")}function _(A){return G(A,function(R){return m.test(R)?E(R.slice(4).toLowerCase()):R})}function O(A){return G(A,function(R){return y.test(R)?"xn--"+w(R):R})}if(a={version:"1.4.1",ucs2:{decode:D,encode:U},decode:E,encode:w,toASCII:O,toUnicode:_},r&&i)if(s.exports==r)i.exports=a;else for(b in a)a.hasOwnProperty(b)&&(r[b]=a[b]);else e.punycode=a})(tl)}(wr,wr.exports)),wr.exports}var _n,En;function Le(){return En||(En=1,_n=TypeError),_n}const rl={},sl=Object.freeze(Object.defineProperty({__proto__:null,default:rl},Symbol.toStringTag,{value:"Module"})),il=bf(sl);var ws,Tn;function Ar(){if(Tn)return ws;Tn=1;var s=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=s&&t&&typeof t.get=="function"?t.get:null,r=s&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=i&&n&&typeof n.get=="function"?n.get:null,o=i&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,d=u?WeakSet.prototype.has:null,c=typeof WeakRef=="function"&&WeakRef.prototype,p=c?WeakRef.prototype.deref:null,v=Boolean.prototype.valueOf,f=Object.prototype.toString,m=Function.prototype.toString,y=String.prototype.match,x=String.prototype.slice,T=String.prototype.replace,M=String.prototype.toUpperCase,g=String.prototype.toLowerCase,S=RegExp.prototype.test,b=Array.prototype.concat,B=Array.prototype.join,C=Array.prototype.slice,G=Math.floor,D=typeof BigInt=="function"?BigInt.prototype.valueOf:null,U=Object.getOwnPropertySymbols,Y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,H=typeof Symbol=="function"&&typeof Symbol.iterator=="object",V=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===H||!0)?Symbol.toStringTag:null,E=Object.prototype.propertyIsEnumerable,w=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(L){return L.__proto__}:null);function _(L,k){if(L===1/0||L===-1/0||L!==L||L&&L>-1e3&&L<1e3||S.call(/e/,k))return k;var mt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof L=="number"){var Tt=L<0?-G(-L):G(L);if(Tt!==L){var wt=String(Tt),at=x.call(k,wt.length+1);return T.call(wt,mt,"$&_")+"."+T.call(T.call(at,/([0-9]{3})/g,"$&_"),/_$/,"")}}return T.call(k,mt,"$&_")}var O=il,A=O.custom,R=vt(A)?A:null,N={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};ws=function L(k,mt,Tt,wt){var at=mt||{};if(Ft(at,"quoteStyle")&&!Ft(N,at.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ft(at,"maxStringLength")&&(typeof at.maxStringLength=="number"?at.maxStringLength<0&&at.maxStringLength!==1/0:at.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var ie=Ft(at,"customInspect")?at.customInspect:!0;if(typeof ie!="boolean"&&ie!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ft(at,"indent")&&at.indent!==null&&at.indent!=="	"&&!(parseInt(at.indent,10)===at.indent&&at.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ft(at,"numericSeparator")&&typeof at.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ae=at.numericSeparator;if(typeof k>"u")return"undefined";if(k===null)return"null";if(typeof k=="boolean")return k?"true":"false";if(typeof k=="string")return Bh(k,at);if(typeof k=="number"){if(k===0)return 1/0/k>0?"0":"-0";var Ct=String(k);return Ae?_(k,Ct):Ct}if(typeof k=="bigint"){var ne=String(k)+"n";return Ae?_(k,ne):ne}var Hi=typeof at.depth>"u"?5:at.depth;if(typeof Tt>"u"&&(Tt=0),Tt>=Hi&&Hi>0&&typeof k=="object")return J(k)?"[Array]":"[Object]";var Je=mf(at,Tt);if(typeof wt>"u")wt=[];else if(Ut(wt,k)>=0)return"[Circular]";function zt(Qe,fs,yf){if(fs&&(wt=C.call(wt),wt.push(fs)),yf){var $h={depth:at.depth};return Ft(at,"quoteStyle")&&($h.quoteStyle=at.quoteStyle),L(Qe,$h,Tt+1,wt)}return L(Qe,at,Tt+1,wt)}if(typeof k=="function"&&!K(k)){var Gh=we(k),jh=cs(k,zt);return"[Function"+(Gh?": "+Gh:" (anonymous)")+"]"+(jh.length>0?" { "+B.call(jh,", ")+" }":"")}if(vt(k)){var zh=H?T.call(String(k),/^(Symbol\(.*\))_[^)]*$/,"$1"):Y.call(k);return typeof k=="object"&&!H?gr(zh):zh}if(df(k)){for(var yr="<"+g.call(String(k.nodeName)),Xi=k.attributes||[],ds=0;ds<Xi.length;ds++)yr+=" "+Xi[ds].name+"="+j(z(Xi[ds].value),"double",at);return yr+=">",k.childNodes&&k.childNodes.length&&(yr+="..."),yr+="</"+g.call(String(k.nodeName))+">",yr}if(J(k)){if(k.length===0)return"[]";var Wi=cs(k,zt);return Je&&!pf(Wi)?"["+Vi(Wi,Je)+"]":"[ "+B.call(Wi,", ")+" ]"}if(W(k)){var $i=cs(k,zt);return!("cause"in Error.prototype)&&"cause"in k&&!E.call(k,"cause")?"{ ["+String(k)+"] "+B.call(b.call("[cause]: "+zt(k.cause),$i),", ")+" }":$i.length===0?"["+String(k)+"]":"{ ["+String(k)+"] "+B.call($i,", ")+" }"}if(typeof k=="object"&&ie){if(R&&typeof k[R]=="function"&&O)return O(k,{depth:Hi-Tt});if(ie!=="symbol"&&typeof k.inspect=="function")return k.inspect()}if(Ye(k)){var Vh=[];return r&&r.call(k,function(Qe,fs){Vh.push(zt(fs,k,!0)+" => "+zt(Qe,k))}),Uh("Map",e.call(k),Vh,Je)}if(uf(k)){var Hh=[];return o&&o.call(k,function(Qe){Hh.push(zt(Qe,k))}),Uh("Set",a.call(k),Hh,Je)}if(Ke(k))return zi("WeakMap");if(cf(k))return zi("WeakSet");if(Ze(k))return zi("WeakRef");if(st(k))return gr(zt(Number(k)));if(Z(k))return gr(zt(D.call(k)));if(dt(k))return gr(v.call(k));if(Q(k))return gr(zt(String(k)));if(typeof window<"u"&&k===window)return"{ [object Window] }";if(typeof globalThis<"u"&&k===globalThis||typeof ps<"u"&&k===ps)return"{ [object globalThis] }";if(!tt(k)&&!K(k)){var qi=cs(k,zt),Xh=w?w(k)===Object.prototype:k instanceof Object||k.constructor===Object,Yi=k instanceof Object?"":"null prototype",Wh=!Xh&&V&&Object(k)===k&&V in k?x.call(Pt(k),8,-1):Yi?"Object":"",gf=Xh||typeof k.constructor!="function"?"":k.constructor.name?k.constructor.name+" ":"",Ki=gf+(Wh||Yi?"["+B.call(b.call([],Wh||[],Yi||[]),": ")+"] ":"");return qi.length===0?Ki+"{}":Je?Ki+"{"+Vi(qi,Je)+"}":Ki+"{ "+B.call(qi,", ")+" }"}return String(k)};function j(L,k,mt){var Tt=mt.quoteStyle||k,wt=N[Tt];return wt+L+wt}function z(L){return T.call(String(L),/"/g,"&quot;")}function q(L){return!V||!(typeof L=="object"&&(V in L||typeof L[V]<"u"))}function J(L){return Pt(L)==="[object Array]"&&q(L)}function tt(L){return Pt(L)==="[object Date]"&&q(L)}function K(L){return Pt(L)==="[object RegExp]"&&q(L)}function W(L){return Pt(L)==="[object Error]"&&q(L)}function Q(L){return Pt(L)==="[object String]"&&q(L)}function st(L){return Pt(L)==="[object Number]"&&q(L)}function dt(L){return Pt(L)==="[object Boolean]"&&q(L)}function vt(L){if(H)return L&&typeof L=="object"&&L instanceof Symbol;if(typeof L=="symbol")return!0;if(!L||typeof L!="object"||!Y)return!1;try{return Y.call(L),!0}catch{}return!1}function Z(L){if(!L||typeof L!="object"||!D)return!1;try{return D.call(L),!0}catch{}return!1}var rt=Object.prototype.hasOwnProperty||function(L){return L in this};function Ft(L,k){return rt.call(L,k)}function Pt(L){return f.call(L)}function we(L){if(L.name)return L.name;var k=y.call(m.call(L),/^function\s*([\w$]+)/);return k?k[1]:null}function Ut(L,k){if(L.indexOf)return L.indexOf(k);for(var mt=0,Tt=L.length;mt<Tt;mt++)if(L[mt]===k)return mt;return-1}function Ye(L){if(!e||!L||typeof L!="object")return!1;try{e.call(L);try{a.call(L)}catch{return!0}return L instanceof Map}catch{}return!1}function Ke(L){if(!l||!L||typeof L!="object")return!1;try{l.call(L,l);try{d.call(L,d)}catch{return!0}return L instanceof WeakMap}catch{}return!1}function Ze(L){if(!p||!L||typeof L!="object")return!1;try{return p.call(L),!0}catch{}return!1}function uf(L){if(!a||!L||typeof L!="object")return!1;try{a.call(L);try{e.call(L)}catch{return!0}return L instanceof Set}catch{}return!1}function cf(L){if(!d||!L||typeof L!="object")return!1;try{d.call(L,d);try{l.call(L,l)}catch{return!0}return L instanceof WeakSet}catch{}return!1}function df(L){return!L||typeof L!="object"?!1:typeof HTMLElement<"u"&&L instanceof HTMLElement?!0:typeof L.nodeName=="string"&&typeof L.getAttribute=="function"}function Bh(L,k){if(L.length>k.maxStringLength){var mt=L.length-k.maxStringLength,Tt="... "+mt+" more character"+(mt>1?"s":"");return Bh(x.call(L,0,k.maxStringLength),k)+Tt}var wt=F[k.quoteStyle||"single"];wt.lastIndex=0;var at=T.call(T.call(L,wt,"\\$1"),/[\x00-\x1f]/g,ff);return j(at,"single",k)}function ff(L){var k=L.charCodeAt(0),mt={8:"b",9:"t",10:"n",12:"f",13:"r"}[k];return mt?"\\"+mt:"\\x"+(k<16?"0":"")+M.call(k.toString(16))}function gr(L){return"Object("+L+")"}function zi(L){return L+" { ? }"}function Uh(L,k,mt,Tt){var wt=Tt?Vi(mt,Tt):B.call(mt,", ");return L+" ("+k+") {"+wt+"}"}function pf(L){for(var k=0;k<L.length;k++)if(Ut(L[k],`
`)>=0)return!1;return!0}function mf(L,k){var mt;if(L.indent==="	")mt="	";else if(typeof L.indent=="number"&&L.indent>0)mt=B.call(Array(L.indent+1)," ");else return null;return{base:mt,prev:B.call(Array(k+1),mt)}}function Vi(L,k){if(L.length===0)return"";var mt=`
`+k.prev+k.base;return mt+B.call(L,","+mt)+`
`+k.prev}function cs(L,k){var mt=J(L),Tt=[];if(mt){Tt.length=L.length;for(var wt=0;wt<L.length;wt++)Tt[wt]=Ft(L,wt)?k(L[wt],L):""}var at=typeof U=="function"?U(L):[],ie;if(H){ie={};for(var Ae=0;Ae<at.length;Ae++)ie["$"+at[Ae]]=at[Ae]}for(var Ct in L)Ft(L,Ct)&&(mt&&String(Number(Ct))===Ct&&Ct<L.length||H&&ie["$"+Ct]instanceof Symbol||(S.call(/[^\w$]/,Ct)?Tt.push(k(Ct,L)+": "+k(L[Ct],L)):Tt.push(Ct+": "+k(L[Ct],L))));if(typeof U=="function")for(var ne=0;ne<at.length;ne++)E.call(L,at[ne])&&Tt.push("["+k(at[ne])+"]: "+k(L[at[ne]],L));return Tt}return ws}var As,wn;function nl(){if(wn)return As;wn=1;var s=Ar(),t=Le(),e=function(o,h,l){for(var u=o,d;(d=u.next)!=null;u=d)if(d.key===h)return u.next=d.next,l||(d.next=o.next,o.next=d),d},r=function(o,h){if(o){var l=e(o,h);return l&&l.value}},i=function(o,h,l){var u=e(o,h);u?u.value=l:o.next={key:h,next:o.next,value:l}},n=function(o,h){return o?!!e(o,h):!1},a=function(o,h){if(o)return e(o,h,!0)};return As=function(){var o,h={assert:function(l){if(!h.has(l))throw new t("Side channel does not contain "+s(l))},delete:function(l){var u=o&&o.next,d=a(o,l);return d&&u&&u===d&&(o=void 0),!!d},get:function(l){return r(o,l)},has:function(l){return n(o,l)},set:function(l,u){o||(o={next:void 0}),i(o,l,u)}};return h},As}var An,Mn;function Sn(){return Mn||(Mn=1,An=Object),An}var Rn,In;function al(){return In||(In=1,Rn=Error),Rn}var Ln,Fn;function ol(){return Fn||(Fn=1,Ln=EvalError),Ln}var Nn,On;function hl(){return On||(On=1,Nn=RangeError),Nn}var Pn,Cn;function ll(){return Cn||(Cn=1,Pn=ReferenceError),Pn}var Dn,kn;function ul(){return kn||(kn=1,Dn=SyntaxError),Dn}var Bn,Un;function cl(){return Un||(Un=1,Bn=URIError),Bn}var Gn,jn;function dl(){return jn||(jn=1,Gn=Math.abs),Gn}var zn,Vn;function fl(){return Vn||(Vn=1,zn=Math.floor),zn}var Hn,Xn;function pl(){return Xn||(Xn=1,Hn=Math.max),Hn}var Wn,$n;function ml(){return $n||($n=1,Wn=Math.min),Wn}var qn,Yn;function gl(){return Yn||(Yn=1,qn=Math.pow),qn}var Kn,Zn;function yl(){return Zn||(Zn=1,Kn=Math.round),Kn}var Jn,Qn;function vl(){return Qn||(Qn=1,Jn=Number.isNaN||function(s){return s!==s}),Jn}var Ms,ta;function bl(){if(ta)return Ms;ta=1;var s=vl();return Ms=function(t){return s(t)||t===0?t:t<0?-1:1},Ms}var ea,ra;function xl(){return ra||(ra=1,ea=Object.getOwnPropertyDescriptor),ea}var Ss,sa;function ia(){if(sa)return Ss;sa=1;var s=xl();if(s)try{s([],"length")}catch{s=null}return Ss=s,Ss}var Rs,na;function _l(){if(na)return Rs;na=1;var s=Object.defineProperty||!1;if(s)try{s({},"a",{value:1})}catch{s=!1}return Rs=s,Rs}var aa,oa;function El(){return oa||(oa=1,aa=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var s={},t=Symbol("test"),e=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(e)!=="[object Symbol]")return!1;var r=42;s[t]=r;for(var i in s)return!1;if(typeof Object.keys=="function"&&Object.keys(s).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(s).length!==0)return!1;var n=Object.getOwnPropertySymbols(s);if(n.length!==1||n[0]!==t||!Object.prototype.propertyIsEnumerable.call(s,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(s,t);if(a.value!==r||a.enumerable!==!0)return!1}return!0}),aa}var Is,ha;function Tl(){if(ha)return Is;ha=1;var s=typeof Symbol<"u"&&Symbol,t=El();return Is=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Is}var la,ua;function ca(){return ua||(ua=1,la=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),la}var Ls,da;function fa(){if(da)return Ls;da=1;var s=Sn();return Ls=s.getPrototypeOf||null,Ls}var Fs,pa;function wl(){if(pa)return Fs;pa=1;var s="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,r="[object Function]",i=function(o,h){for(var l=[],u=0;u<o.length;u+=1)l[u]=o[u];for(var d=0;d<h.length;d+=1)l[d+o.length]=h[d];return l},n=function(o,h){for(var l=[],u=h,d=0;u<o.length;u+=1,d+=1)l[d]=o[u];return l},a=function(o,h){for(var l="",u=0;u<o.length;u+=1)l+=o[u],u+1<o.length&&(l+=h);return l};return Fs=function(o){var h=this;if(typeof h!="function"||t.apply(h)!==r)throw new TypeError(s+h);for(var l=n(arguments,1),u,d=function(){if(this instanceof u){var m=h.apply(this,i(l,arguments));return Object(m)===m?m:this}return h.apply(o,i(l,arguments))},c=e(0,h.length-l.length),p=[],v=0;v<c;v++)p[v]="$"+v;if(u=Function("binder","return function ("+a(p,",")+"){ return binder.apply(this,arguments); }")(d),h.prototype){var f=function(){};f.prototype=h.prototype,u.prototype=new f,f.prototype=null}return u},Fs}var Ns,ma;function Mr(){if(ma)return Ns;ma=1;var s=wl();return Ns=Function.prototype.bind||s,Ns}var ga,ya;function Os(){return ya||(ya=1,ga=Function.prototype.call),ga}var va,ba;function xa(){return ba||(ba=1,va=Function.prototype.apply),va}var _a,Ea;function Al(){return Ea||(Ea=1,_a=typeof Reflect<"u"&&Reflect&&Reflect.apply),_a}var Ps,Ta;function Ml(){if(Ta)return Ps;Ta=1;var s=Mr(),t=xa(),e=Os(),r=Al();return Ps=r||s.call(e,t),Ps}var Cs,wa;function Aa(){if(wa)return Cs;wa=1;var s=Mr(),t=Le(),e=Os(),r=Ml();return Cs=function(i){if(i.length<1||typeof i[0]!="function")throw new t("a function is required");return r(s,e,i)},Cs}var Ds,Ma;function Sl(){if(Ma)return Ds;Ma=1;var s=Aa(),t=ia(),e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!e&&t&&t(Object.prototype,"__proto__"),i=Object,n=i.getPrototypeOf;return Ds=r&&typeof r.get=="function"?s([r.get]):typeof n=="function"?function(a){return n(a==null?a:i(a))}:!1,Ds}var ks,Sa;function Rl(){if(Sa)return ks;Sa=1;var s=ca(),t=fa(),e=Sl();return ks=s?function(r){return s(r)}:t?function(r){if(!r||typeof r!="object"&&typeof r!="function")throw new TypeError("getProto: not an object");return t(r)}:e?function(r){return e(r)}:null,ks}var Bs,Ra;function Il(){if(Ra)return Bs;Ra=1;var s=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Mr();return Bs=e.call(s,t),Bs}var Us,Ia;function Gs(){if(Ia)return Us;Ia=1;var s,t=Sn(),e=al(),r=ol(),i=hl(),n=ll(),a=ul(),o=Le(),h=cl(),l=dl(),u=fl(),d=pl(),c=ml(),p=gl(),v=yl(),f=bl(),m=Function,y=function(K){try{return m('"use strict"; return ('+K+").constructor;")()}catch{}},x=ia(),T=_l(),M=function(){throw new o},g=x?function(){try{return arguments.callee,M}catch{try{return x(arguments,"callee").get}catch{return M}}}():M,S=Tl()(),b=Rl(),B=fa(),C=ca(),G=xa(),D=Os(),U={},Y=typeof Uint8Array>"u"||!b?s:b(Uint8Array),H={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?s:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?s:ArrayBuffer,"%ArrayIteratorPrototype%":S&&b?b([][Symbol.iterator]()):s,"%AsyncFromSyncIteratorPrototype%":s,"%AsyncFunction%":U,"%AsyncGenerator%":U,"%AsyncGeneratorFunction%":U,"%AsyncIteratorPrototype%":U,"%Atomics%":typeof Atomics>"u"?s:Atomics,"%BigInt%":typeof BigInt>"u"?s:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?s:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?s:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?s:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?s:Float16Array,"%Float32Array%":typeof Float32Array>"u"?s:Float32Array,"%Float64Array%":typeof Float64Array>"u"?s:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?s:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":U,"%Int8Array%":typeof Int8Array>"u"?s:Int8Array,"%Int16Array%":typeof Int16Array>"u"?s:Int16Array,"%Int32Array%":typeof Int32Array>"u"?s:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":S&&b?b(b([][Symbol.iterator]())):s,"%JSON%":typeof JSON=="object"?JSON:s,"%Map%":typeof Map>"u"?s:Map,"%MapIteratorPrototype%":typeof Map>"u"||!S||!b?s:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":x,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?s:Promise,"%Proxy%":typeof Proxy>"u"?s:Proxy,"%RangeError%":i,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?s:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?s:Set,"%SetIteratorPrototype%":typeof Set>"u"||!S||!b?s:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?s:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":S&&b?b(""[Symbol.iterator]()):s,"%Symbol%":S?Symbol:s,"%SyntaxError%":a,"%ThrowTypeError%":g,"%TypedArray%":Y,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?s:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?s:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?s:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?s:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?s:WeakMap,"%WeakRef%":typeof WeakRef>"u"?s:WeakRef,"%WeakSet%":typeof WeakSet>"u"?s:WeakSet,"%Function.prototype.call%":D,"%Function.prototype.apply%":G,"%Object.defineProperty%":T,"%Object.getPrototypeOf%":B,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":d,"%Math.min%":c,"%Math.pow%":p,"%Math.round%":v,"%Math.sign%":f,"%Reflect.getPrototypeOf%":C};if(b)try{null.error}catch(K){var V=b(b(K));H["%Error.prototype%"]=V}var E=function K(W){var Q;if(W==="%AsyncFunction%")Q=y("async function () {}");else if(W==="%GeneratorFunction%")Q=y("function* () {}");else if(W==="%AsyncGeneratorFunction%")Q=y("async function* () {}");else if(W==="%AsyncGenerator%"){var st=K("%AsyncGeneratorFunction%");st&&(Q=st.prototype)}else if(W==="%AsyncIteratorPrototype%"){var dt=K("%AsyncGenerator%");dt&&b&&(Q=b(dt.prototype))}return H[W]=Q,Q},w={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=Mr(),O=Il(),A=_.call(D,Array.prototype.concat),R=_.call(G,Array.prototype.splice),N=_.call(D,String.prototype.replace),F=_.call(D,String.prototype.slice),j=_.call(D,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,q=/\\(\\)?/g,J=function(K){var W=F(K,0,1),Q=F(K,-1);if(W==="%"&&Q!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(Q==="%"&&W!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var st=[];return N(K,z,function(dt,vt,Z,rt){st[st.length]=Z?N(rt,q,"$1"):vt||dt}),st},tt=function(K,W){var Q=K,st;if(O(w,Q)&&(st=w[Q],Q="%"+st[0]+"%"),O(H,Q)){var dt=H[Q];if(dt===U&&(dt=E(Q)),typeof dt>"u"&&!W)throw new o("intrinsic "+K+" exists, but is not available. Please file an issue!");return{alias:st,name:Q,value:dt}}throw new a("intrinsic "+K+" does not exist!")};return Us=function(K,W){if(typeof K!="string"||K.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof W!="boolean")throw new o('"allowMissing" argument must be a boolean');if(j(/^%?[^%]*%?$/,K)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Q=J(K),st=Q.length>0?Q[0]:"",dt=tt("%"+st+"%",W),vt=dt.name,Z=dt.value,rt=!1,Ft=dt.alias;Ft&&(st=Ft[0],R(Q,A([0,1],Ft)));for(var Pt=1,we=!0;Pt<Q.length;Pt+=1){var Ut=Q[Pt],Ye=F(Ut,0,1),Ke=F(Ut,-1);if((Ye==='"'||Ye==="'"||Ye==="`"||Ke==='"'||Ke==="'"||Ke==="`")&&Ye!==Ke)throw new a("property names with quotes must have matching quotes");if((Ut==="constructor"||!we)&&(rt=!0),st+="."+Ut,vt="%"+st+"%",O(H,vt))Z=H[vt];else if(Z!=null){if(!(Ut in Z)){if(!W)throw new o("base intrinsic for "+K+" exists, but the property is not available.");return}if(x&&Pt+1>=Q.length){var Ze=x(Z,Ut);we=!!Ze,we&&"get"in Ze&&!("originalValue"in Ze.get)?Z=Ze.get:Z=Z[Ut]}else we=O(Z,Ut),Z=Z[Ut];we&&!rt&&(H[vt]=Z)}}return Z},Us}var js,La;function Fa(){if(La)return js;La=1;var s=Gs(),t=Aa(),e=t([s("%String.prototype.indexOf%")]);return js=function(r,i){var n=s(r,!!i);return typeof n=="function"&&e(r,".prototype.")>-1?t([n]):n},js}var zs,Na;function Oa(){if(Na)return zs;Na=1;var s=Gs(),t=Fa(),e=Ar(),r=Le(),i=s("%Map%",!0),n=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),o=t("Map.prototype.has",!0),h=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return zs=!!i&&function(){var u,d={assert:function(c){if(!d.has(c))throw new r("Side channel does not contain "+e(c))},delete:function(c){if(u){var p=h(u,c);return l(u)===0&&(u=void 0),p}return!1},get:function(c){if(u)return n(u,c)},has:function(c){return u?o(u,c):!1},set:function(c,p){u||(u=new i),a(u,c,p)}};return d},zs}var Vs,Pa;function Ll(){if(Pa)return Vs;Pa=1;var s=Gs(),t=Fa(),e=Ar(),r=Oa(),i=Le(),n=s("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),h=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return Vs=n?function(){var u,d,c={assert:function(p){if(!c.has(p))throw new i("Side channel does not contain "+e(p))},delete:function(p){if(n&&p&&(typeof p=="object"||typeof p=="function")){if(u)return l(u,p)}else if(r&&d)return d.delete(p);return!1},get:function(p){return n&&p&&(typeof p=="object"||typeof p=="function")&&u?a(u,p):d&&d.get(p)},has:function(p){return n&&p&&(typeof p=="object"||typeof p=="function")&&u?h(u,p):!!d&&d.has(p)},set:function(p,v){n&&p&&(typeof p=="object"||typeof p=="function")?(u||(u=new n),o(u,p,v)):r&&(d||(d=r()),d.set(p,v))}};return c}:r,Vs}var Hs,Ca;function Fl(){if(Ca)return Hs;Ca=1;var s=Le(),t=Ar(),e=nl(),r=Oa(),i=Ll(),n=i||r||e;return Hs=function(){var a,o={assert:function(h){if(!o.has(h))throw new s("Side channel does not contain "+t(h))},delete:function(h){return!!a&&a.delete(h)},get:function(h){return a&&a.get(h)},has:function(h){return!!a&&a.has(h)},set:function(h,l){a||(a=n()),a.set(h,l)}};return o},Hs}var Xs,Da;function Ws(){if(Da)return Xs;Da=1;var s=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Xs={default:e.RFC3986,formatters:{RFC1738:function(r){return s.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},Xs}var $s,ka;function Ba(){if(ka)return $s;ka=1;var s=Ws(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=function(){for(var m=[],y=0;y<256;++y)m.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return m}(),i=function(m){for(;m.length>1;){var y=m.pop(),x=y.obj[y.prop];if(e(x)){for(var T=[],M=0;M<x.length;++M)typeof x[M]<"u"&&T.push(x[M]);y.obj[y.prop]=T}}},n=function(m,y){for(var x=y&&y.plainObjects?{__proto__:null}:{},T=0;T<m.length;++T)typeof m[T]<"u"&&(x[T]=m[T]);return x},a=function m(y,x,T){if(!x)return y;if(typeof x!="object"&&typeof x!="function"){if(e(y))y.push(x);else if(y&&typeof y=="object")(T&&(T.plainObjects||T.allowPrototypes)||!t.call(Object.prototype,x))&&(y[x]=!0);else return[y,x];return y}if(!y||typeof y!="object")return[y].concat(x);var M=y;return e(y)&&!e(x)&&(M=n(y,T)),e(y)&&e(x)?(x.forEach(function(g,S){if(t.call(y,S)){var b=y[S];b&&typeof b=="object"&&g&&typeof g=="object"?y[S]=m(b,g,T):y.push(g)}else y[S]=g}),y):Object.keys(x).reduce(function(g,S){var b=x[S];return t.call(g,S)?g[S]=m(g[S],b,T):g[S]=b,g},M)},o=function(m,y){return Object.keys(y).reduce(function(x,T){return x[T]=y[T],x},m)},h=function(m,y,x){var T=m.replace(/\+/g," ");if(x==="iso-8859-1")return T.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(T)}catch{return T}},l=1024,u=function(m,y,x,T,M){if(m.length===0)return m;var g=m;if(typeof m=="symbol"?g=Symbol.prototype.toString.call(m):typeof m!="string"&&(g=String(m)),x==="iso-8859-1")return escape(g).replace(/%u[0-9a-f]{4}/gi,function(U){return"%26%23"+parseInt(U.slice(2),16)+"%3B"});for(var S="",b=0;b<g.length;b+=l){for(var B=g.length>=l?g.slice(b,b+l):g,C=[],G=0;G<B.length;++G){var D=B.charCodeAt(G);if(D===45||D===46||D===95||D===126||D>=48&&D<=57||D>=65&&D<=90||D>=97&&D<=122||M===s.RFC1738&&(D===40||D===41)){C[C.length]=B.charAt(G);continue}if(D<128){C[C.length]=r[D];continue}if(D<2048){C[C.length]=r[192|D>>6]+r[128|D&63];continue}if(D<55296||D>=57344){C[C.length]=r[224|D>>12]+r[128|D>>6&63]+r[128|D&63];continue}G+=1,D=65536+((D&1023)<<10|B.charCodeAt(G)&1023),C[C.length]=r[240|D>>18]+r[128|D>>12&63]+r[128|D>>6&63]+r[128|D&63]}S+=C.join("")}return S},d=function(m){for(var y=[{obj:{o:m},prop:"o"}],x=[],T=0;T<y.length;++T)for(var M=y[T],g=M.obj[M.prop],S=Object.keys(g),b=0;b<S.length;++b){var B=S[b],C=g[B];typeof C=="object"&&C!==null&&x.indexOf(C)===-1&&(y.push({obj:g,prop:B}),x.push(C))}return i(y),m},c=function(m){return Object.prototype.toString.call(m)==="[object RegExp]"},p=function(m){return!m||typeof m!="object"?!1:!!(m.constructor&&m.constructor.isBuffer&&m.constructor.isBuffer(m))},v=function(m,y){return[].concat(m,y)},f=function(m,y){if(e(m)){for(var x=[],T=0;T<m.length;T+=1)x.push(y(m[T]));return x}return y(m)};return $s={arrayToObject:n,assign:o,combine:v,compact:d,decode:h,encode:u,isBuffer:p,isRegExp:c,maybeMap:f,merge:a},$s}var qs,Ua;function Nl(){if(Ua)return qs;Ua=1;var s=Fl(),t=Ba(),e=Ws(),r=Object.prototype.hasOwnProperty,i={brackets:function(f){return f+"[]"},comma:"comma",indices:function(f,m){return f+"["+m+"]"},repeat:function(f){return f}},n=Array.isArray,a=Array.prototype.push,o=function(f,m){a.apply(f,n(m)?m:[m])},h=Date.prototype.toISOString,l=e.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:e.formatters[l],indices:!1,serializeDate:function(f){return h.call(f)},skipNulls:!1,strictNullHandling:!1},d=function(f){return typeof f=="string"||typeof f=="number"||typeof f=="boolean"||typeof f=="symbol"||typeof f=="bigint"},c={},p=function f(m,y,x,T,M,g,S,b,B,C,G,D,U,Y,H,V,E,w){for(var _=m,O=w,A=0,R=!1;(O=O.get(c))!==void 0&&!R;){var N=O.get(m);if(A+=1,typeof N<"u"){if(N===A)throw new RangeError("Cyclic object value");R=!0}typeof O.get(c)>"u"&&(A=0)}if(typeof C=="function"?_=C(y,_):_ instanceof Date?_=U(_):x==="comma"&&n(_)&&(_=t.maybeMap(_,function(Z){return Z instanceof Date?U(Z):Z})),_===null){if(g)return B&&!V?B(y,u.encoder,E,"key",Y):y;_=""}if(d(_)||t.isBuffer(_)){if(B){var F=V?y:B(y,u.encoder,E,"key",Y);return[H(F)+"="+H(B(_,u.encoder,E,"value",Y))]}return[H(y)+"="+H(String(_))]}var j=[];if(typeof _>"u")return j;var z;if(x==="comma"&&n(_))V&&B&&(_=t.maybeMap(_,B)),z=[{value:_.length>0?_.join(",")||null:void 0}];else if(n(C))z=C;else{var q=Object.keys(_);z=G?q.sort(G):q}var J=b?String(y).replace(/\./g,"%2E"):String(y),tt=T&&n(_)&&_.length===1?J+"[]":J;if(M&&n(_)&&_.length===0)return tt+"[]";for(var K=0;K<z.length;++K){var W=z[K],Q=typeof W=="object"&&W&&typeof W.value<"u"?W.value:_[W];if(!(S&&Q===null)){var st=D&&b?String(W).replace(/\./g,"%2E"):String(W),dt=n(_)?typeof x=="function"?x(tt,st):tt:tt+(D?"."+st:"["+st+"]");w.set(m,A);var vt=s();vt.set(c,w),o(j,f(Q,dt,x,T,M,g,S,b,x==="comma"&&V&&n(_)?null:B,C,G,D,U,Y,H,V,E,vt))}}return j},v=function(f){if(!f)return u;if(typeof f.allowEmptyArrays<"u"&&typeof f.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof f.encodeDotInKeys<"u"&&typeof f.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(f.encoder!==null&&typeof f.encoder<"u"&&typeof f.encoder!="function")throw new TypeError("Encoder has to be a function.");var m=f.charset||u.charset;if(typeof f.charset<"u"&&f.charset!=="utf-8"&&f.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var y=e.default;if(typeof f.format<"u"){if(!r.call(e.formatters,f.format))throw new TypeError("Unknown format option provided.");y=f.format}var x=e.formatters[y],T=u.filter;(typeof f.filter=="function"||n(f.filter))&&(T=f.filter);var M;if(f.arrayFormat in i?M=f.arrayFormat:"indices"in f?M=f.indices?"indices":"repeat":M=u.arrayFormat,"commaRoundTrip"in f&&typeof f.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g=typeof f.allowDots>"u"?f.encodeDotInKeys===!0?!0:u.allowDots:!!f.allowDots;return{addQueryPrefix:typeof f.addQueryPrefix=="boolean"?f.addQueryPrefix:u.addQueryPrefix,allowDots:g,allowEmptyArrays:typeof f.allowEmptyArrays=="boolean"?!!f.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:M,charset:m,charsetSentinel:typeof f.charsetSentinel=="boolean"?f.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!f.commaRoundTrip,delimiter:typeof f.delimiter>"u"?u.delimiter:f.delimiter,encode:typeof f.encode=="boolean"?f.encode:u.encode,encodeDotInKeys:typeof f.encodeDotInKeys=="boolean"?f.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof f.encoder=="function"?f.encoder:u.encoder,encodeValuesOnly:typeof f.encodeValuesOnly=="boolean"?f.encodeValuesOnly:u.encodeValuesOnly,filter:T,format:y,formatter:x,serializeDate:typeof f.serializeDate=="function"?f.serializeDate:u.serializeDate,skipNulls:typeof f.skipNulls=="boolean"?f.skipNulls:u.skipNulls,sort:typeof f.sort=="function"?f.sort:null,strictNullHandling:typeof f.strictNullHandling=="boolean"?f.strictNullHandling:u.strictNullHandling}};return qs=function(f,m){var y=f,x=v(m),T,M;typeof x.filter=="function"?(M=x.filter,y=M("",y)):n(x.filter)&&(M=x.filter,T=M);var g=[];if(typeof y!="object"||y===null)return"";var S=i[x.arrayFormat],b=S==="comma"&&x.commaRoundTrip;T||(T=Object.keys(y)),x.sort&&T.sort(x.sort);for(var B=s(),C=0;C<T.length;++C){var G=T[C],D=y[G];x.skipNulls&&D===null||o(g,p(D,G,S,b,x.allowEmptyArrays,x.strictNullHandling,x.skipNulls,x.encodeDotInKeys,x.encode?x.encoder:null,x.filter,x.sort,x.allowDots,x.serializeDate,x.format,x.formatter,x.encodeValuesOnly,x.charset,B))}var U=g.join(x.delimiter),Y=x.addQueryPrefix===!0?"?":"";return x.charsetSentinel&&(x.charset==="iso-8859-1"?Y+="utf8=%26%2310003%3B&":Y+="utf8=%E2%9C%93&"),U.length>0?Y+U:""},qs}var Ys,Ga;function Ol(){if(Ga)return Ys;Ga=1;var s=Ba(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:s.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(c){return c.replace(/&#(\d+);/g,function(p,v){return String.fromCharCode(parseInt(v,10))})},n=function(c,p,v){if(c&&typeof c=="string"&&p.comma&&c.indexOf(",")>-1)return c.split(",");if(p.throwOnLimitExceeded&&v>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return c},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",h=function(c,p){var v={__proto__:null},f=p.ignoreQueryPrefix?c.replace(/^\?/,""):c;f=f.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var m=p.parameterLimit===1/0?void 0:p.parameterLimit,y=f.split(p.delimiter,p.throwOnLimitExceeded?m+1:m);if(p.throwOnLimitExceeded&&y.length>m)throw new RangeError("Parameter limit exceeded. Only "+m+" parameter"+(m===1?"":"s")+" allowed.");var x=-1,T,M=p.charset;if(p.charsetSentinel)for(T=0;T<y.length;++T)y[T].indexOf("utf8=")===0&&(y[T]===o?M="utf-8":y[T]===a&&(M="iso-8859-1"),x=T,T=y.length);for(T=0;T<y.length;++T)if(T!==x){var g=y[T],S=g.indexOf("]="),b=S===-1?g.indexOf("="):S+1,B,C;b===-1?(B=p.decoder(g,r.decoder,M,"key"),C=p.strictNullHandling?null:""):(B=p.decoder(g.slice(0,b),r.decoder,M,"key"),C=s.maybeMap(n(g.slice(b+1),p,e(v[B])?v[B].length:0),function(D){return p.decoder(D,r.decoder,M,"value")})),C&&p.interpretNumericEntities&&M==="iso-8859-1"&&(C=i(String(C))),g.indexOf("[]=")>-1&&(C=e(C)?[C]:C);var G=t.call(v,B);G&&p.duplicates==="combine"?v[B]=s.combine(v[B],C):(!G||p.duplicates==="last")&&(v[B]=C)}return v},l=function(c,p,v,f){var m=0;if(c.length>0&&c[c.length-1]==="[]"){var y=c.slice(0,-1).join("");m=Array.isArray(p)&&p[y]?p[y].length:0}for(var x=f?p:n(p,v,m),T=c.length-1;T>=0;--T){var M,g=c[T];if(g==="[]"&&v.parseArrays)M=v.allowEmptyArrays&&(x===""||v.strictNullHandling&&x===null)?[]:s.combine([],x);else{M=v.plainObjects?{__proto__:null}:{};var S=g.charAt(0)==="["&&g.charAt(g.length-1)==="]"?g.slice(1,-1):g,b=v.decodeDotInKeys?S.replace(/%2E/g,"."):S,B=parseInt(b,10);!v.parseArrays&&b===""?M={0:x}:!isNaN(B)&&g!==b&&String(B)===b&&B>=0&&v.parseArrays&&B<=v.arrayLimit?(M=[],M[B]=x):b!=="__proto__"&&(M[b]=x)}x=M}return x},u=function(c,p,v,f){if(c){var m=v.allowDots?c.replace(/\.([^.[]+)/g,"[$1]"):c,y=/(\[[^[\]]*])/,x=/(\[[^[\]]*])/g,T=v.depth>0&&y.exec(m),M=T?m.slice(0,T.index):m,g=[];if(M){if(!v.plainObjects&&t.call(Object.prototype,M)&&!v.allowPrototypes)return;g.push(M)}for(var S=0;v.depth>0&&(T=x.exec(m))!==null&&S<v.depth;){if(S+=1,!v.plainObjects&&t.call(Object.prototype,T[1].slice(1,-1))&&!v.allowPrototypes)return;g.push(T[1])}if(T){if(v.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+v.depth+" and strictDepth is true");g.push("["+m.slice(T.index)+"]")}return l(g,p,v,f)}},d=function(c){if(!c)return r;if(typeof c.allowEmptyArrays<"u"&&typeof c.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof c.decodeDotInKeys<"u"&&typeof c.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(c.decoder!==null&&typeof c.decoder<"u"&&typeof c.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof c.charset<"u"&&c.charset!=="utf-8"&&c.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof c.throwOnLimitExceeded<"u"&&typeof c.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof c.charset>"u"?r.charset:c.charset,v=typeof c.duplicates>"u"?r.duplicates:c.duplicates;if(v!=="combine"&&v!=="first"&&v!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var f=typeof c.allowDots>"u"?c.decodeDotInKeys===!0?!0:r.allowDots:!!c.allowDots;return{allowDots:f,allowEmptyArrays:typeof c.allowEmptyArrays=="boolean"?!!c.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof c.allowPrototypes=="boolean"?c.allowPrototypes:r.allowPrototypes,allowSparse:typeof c.allowSparse=="boolean"?c.allowSparse:r.allowSparse,arrayLimit:typeof c.arrayLimit=="number"?c.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof c.charsetSentinel=="boolean"?c.charsetSentinel:r.charsetSentinel,comma:typeof c.comma=="boolean"?c.comma:r.comma,decodeDotInKeys:typeof c.decodeDotInKeys=="boolean"?c.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof c.decoder=="function"?c.decoder:r.decoder,delimiter:typeof c.delimiter=="string"||s.isRegExp(c.delimiter)?c.delimiter:r.delimiter,depth:typeof c.depth=="number"||c.depth===!1?+c.depth:r.depth,duplicates:v,ignoreQueryPrefix:c.ignoreQueryPrefix===!0,interpretNumericEntities:typeof c.interpretNumericEntities=="boolean"?c.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof c.parameterLimit=="number"?c.parameterLimit:r.parameterLimit,parseArrays:c.parseArrays!==!1,plainObjects:typeof c.plainObjects=="boolean"?c.plainObjects:r.plainObjects,strictDepth:typeof c.strictDepth=="boolean"?!!c.strictDepth:r.strictDepth,strictNullHandling:typeof c.strictNullHandling=="boolean"?c.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof c.throwOnLimitExceeded=="boolean"?c.throwOnLimitExceeded:!1}};return Ys=function(c,p){var v=d(p);if(c===""||c===null||typeof c>"u")return v.plainObjects?{__proto__:null}:{};for(var f=typeof c=="string"?h(c,v):c,m=v.plainObjects?{__proto__:null}:{},y=Object.keys(f),x=0;x<y.length;++x){var T=y[x],M=u(T,f[T],v,typeof c=="string");m=s.merge(m,M,v)}return v.allowSparse===!0?m:s.compact(m)},Ys}var Ks,ja;function Pl(){if(ja)return Ks;ja=1;var s=Nl(),t=Ol(),e=Ws();return Ks={formats:e,parse:t,stringify:s},Ks}var za;function Cl(){if(za)return de;za=1;var s=el();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),o=["'"].concat(a),h=["%","/","?",";","#"].concat(o),l=["/","?","#"],u=255,d=/^[+a-z0-9A-Z_-]{0,63}$/,c=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=Pl();function y(g,S,b){if(g&&typeof g=="object"&&g instanceof t)return g;var B=new t;return B.parse(g,S,b),B}t.prototype.parse=function(g,S,b){if(typeof g!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof g);var B=g.indexOf("?"),C=B!==-1&&B<g.indexOf("#")?"?":"#",G=g.split(C),D=/\\/g;G[0]=G[0].replace(D,"/"),g=G.join(C);var U=g;if(U=U.trim(),!b&&g.split("#").length===1){var Y=i.exec(U);if(Y)return this.path=U,this.href=U,this.pathname=Y[1],Y[2]?(this.search=Y[2],S?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):S&&(this.search="",this.query={}),this}var H=e.exec(U);if(H){H=H[0];var V=H.toLowerCase();this.protocol=V,U=U.substr(H.length)}if(b||H||U.match(/^\/\/[^@/]+@[^@/]+/)){var E=U.substr(0,2)==="//";E&&!(H&&v[H])&&(U=U.substr(2),this.slashes=!0)}if(!v[H]&&(E||H&&!f[H])){for(var w=-1,_=0;_<l.length;_++){var O=U.indexOf(l[_]);O!==-1&&(w===-1||O<w)&&(w=O)}var A,R;w===-1?R=U.lastIndexOf("@"):R=U.lastIndexOf("@",w),R!==-1&&(A=U.slice(0,R),U=U.slice(R+1),this.auth=decodeURIComponent(A)),w=-1;for(var _=0;_<h.length;_++){var O=U.indexOf(h[_]);O!==-1&&(w===-1||O<w)&&(w=O)}w===-1&&(w=U.length),this.host=U.slice(0,w),U=U.slice(w),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var F=this.hostname.split(/\./),_=0,j=F.length;_<j;_++){var z=F[_];if(z&&!z.match(d)){for(var q="",J=0,tt=z.length;J<tt;J++)z.charCodeAt(J)>127?q+="x":q+=z[J];if(!q.match(d)){var K=F.slice(0,_),W=F.slice(_+1),Q=z.match(c);Q&&(K.push(Q[1]),W.unshift(Q[2])),W.length&&(U="/"+W.join(".")+U),this.hostname=K.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=s.toASCII(this.hostname));var st=this.port?":"+this.port:"",dt=this.hostname||"";this.host=dt+st,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),U[0]!=="/"&&(U="/"+U))}if(!p[V])for(var _=0,j=o.length;_<j;_++){var vt=o[_];if(U.indexOf(vt)!==-1){var Z=encodeURIComponent(vt);Z===vt&&(Z=escape(vt)),U=U.split(vt).join(Z)}}var rt=U.indexOf("#");rt!==-1&&(this.hash=U.substr(rt),U=U.slice(0,rt));var Ft=U.indexOf("?");if(Ft!==-1?(this.search=U.substr(Ft),this.query=U.substr(Ft+1),S&&(this.query=m.parse(this.query)),U=U.slice(0,Ft)):S&&(this.search="",this.query={}),U&&(this.pathname=U),f[V]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var st=this.pathname||"",Pt=this.search||"";this.path=st+Pt}return this.href=this.format(),this};function x(g){return typeof g=="string"&&(g=y(g)),g instanceof t?g.format():t.prototype.format.call(g)}t.prototype.format=function(){var g=this.auth||"";g&&(g=encodeURIComponent(g),g=g.replace(/%3A/i,":"),g+="@");var S=this.protocol||"",b=this.pathname||"",B=this.hash||"",C=!1,G="";this.host?C=g+this.host:this.hostname&&(C=g+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(C+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(G=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var D=this.search||G&&"?"+G||"";return S&&S.substr(-1)!==":"&&(S+=":"),this.slashes||(!S||f[S])&&C!==!1?(C="//"+(C||""),b&&b.charAt(0)!=="/"&&(b="/"+b)):C||(C=""),B&&B.charAt(0)!=="#"&&(B="#"+B),D&&D.charAt(0)!=="?"&&(D="?"+D),b=b.replace(/[?#]/g,function(U){return encodeURIComponent(U)}),D=D.replace("#","%23"),S+C+b+D+B};function T(g,S){return y(g,!1,!0).resolve(S)}t.prototype.resolve=function(g){return this.resolveObject(y(g,!1,!0)).format()};function M(g,S){return g?y(g,!1,!0).resolveObject(S):S}return t.prototype.resolveObject=function(g){if(typeof g=="string"){var S=new t;S.parse(g,!1,!0),g=S}for(var b=new t,B=Object.keys(this),C=0;C<B.length;C++){var G=B[C];b[G]=this[G]}if(b.hash=g.hash,g.href==="")return b.href=b.format(),b;if(g.slashes&&!g.protocol){for(var D=Object.keys(g),U=0;U<D.length;U++){var Y=D[U];Y!=="protocol"&&(b[Y]=g[Y])}return f[b.protocol]&&b.hostname&&!b.pathname&&(b.pathname="/",b.path=b.pathname),b.href=b.format(),b}if(g.protocol&&g.protocol!==b.protocol){if(!f[g.protocol]){for(var H=Object.keys(g),V=0;V<H.length;V++){var E=H[V];b[E]=g[E]}return b.href=b.format(),b}if(b.protocol=g.protocol,!g.host&&!v[g.protocol]){for(var j=(g.pathname||"").split("/");j.length&&!(g.host=j.shift()););g.host||(g.host=""),g.hostname||(g.hostname=""),j[0]!==""&&j.unshift(""),j.length<2&&j.unshift(""),b.pathname=j.join("/")}else b.pathname=g.pathname;if(b.search=g.search,b.query=g.query,b.host=g.host||"",b.auth=g.auth,b.hostname=g.hostname||g.host,b.port=g.port,b.pathname||b.search){var w=b.pathname||"",_=b.search||"";b.path=w+_}return b.slashes=b.slashes||g.slashes,b.href=b.format(),b}var O=b.pathname&&b.pathname.charAt(0)==="/",A=g.host||g.pathname&&g.pathname.charAt(0)==="/",R=A||O||b.host&&g.pathname,N=R,F=b.pathname&&b.pathname.split("/")||[],j=g.pathname&&g.pathname.split("/")||[],z=b.protocol&&!f[b.protocol];if(z&&(b.hostname="",b.port=null,b.host&&(F[0]===""?F[0]=b.host:F.unshift(b.host)),b.host="",g.protocol&&(g.hostname=null,g.port=null,g.host&&(j[0]===""?j[0]=g.host:j.unshift(g.host)),g.host=null),R=R&&(j[0]===""||F[0]==="")),A)b.host=g.host||g.host===""?g.host:b.host,b.hostname=g.hostname||g.hostname===""?g.hostname:b.hostname,b.search=g.search,b.query=g.query,F=j;else if(j.length)F||(F=[]),F.pop(),F=F.concat(j),b.search=g.search,b.query=g.query;else if(g.search!=null){if(z){b.host=F.shift(),b.hostname=b.host;var q=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;q&&(b.auth=q.shift(),b.hostname=q.shift(),b.host=b.hostname)}return b.search=g.search,b.query=g.query,(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.href=b.format(),b}if(!F.length)return b.pathname=null,b.search?b.path="/"+b.search:b.path=null,b.href=b.format(),b;for(var J=F.slice(-1)[0],tt=(b.host||g.host||F.length>1)&&(J==="."||J==="..")||J==="",K=0,W=F.length;W>=0;W--)J=F[W],J==="."?F.splice(W,1):J===".."?(F.splice(W,1),K++):K&&(F.splice(W,1),K--);if(!R&&!N)for(;K--;K)F.unshift("..");R&&F[0]!==""&&(!F[0]||F[0].charAt(0)!=="/")&&F.unshift(""),tt&&F.join("/").substr(-1)!=="/"&&F.push("");var Q=F[0]===""||F[0]&&F[0].charAt(0)==="/";if(z){b.hostname=Q?"":F.length?F.shift():"",b.host=b.hostname;var q=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;q&&(b.auth=q.shift(),b.hostname=q.shift(),b.host=b.hostname)}return R=R||b.host&&F.length,R&&!Q&&F.unshift(""),F.length>0?b.pathname=F.join("/"):(b.pathname=null,b.path=null),(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.auth=g.auth||b.auth,b.slashes=b.slashes||g.slashes,b.href=b.format(),b},t.prototype.parseHost=function(){var g=this.host,S=r.exec(g);S&&(S=S[0],S!==":"&&(this.port=S.substr(1)),g=g.substr(0,g.length-S.length)),g&&(this.hostname=g)},de.parse=y,de.resolve=T,de.resolveObject=M,de.format=x,de.Url=t,de}Cl();const Va={};function bt(s,t,e=3){if(Va[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(r))),Va[t]=!0}let Zs;function Dl(){return typeof Zs>"u"&&(Zs=function(){const s={stencil:!0,failIfMajorPerformanceCaveat:ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ft.ADAPTER.getWebGLRenderingContext())return!1;const t=ft.ADAPTER.createCanvas();let e=t.getContext("webgl",s)||t.getContext("experimental-webgl",s);const r=!!e?.getContextAttributes()?.stencil;if(e){const i=e.getExtension("WEBGL_lose_context");i&&i.loseContext()}return e=null,r}catch{return!1}}()),Zs}var kl={grad:.9,turn:360,rad:360/(2*Math.PI)},Zt=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},Lt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},Bt=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},Ha=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},Xa=function(s){return{r:Bt(s.r,0,255),g:Bt(s.g,0,255),b:Bt(s.b,0,255),a:Bt(s.a)}},Js=function(s){return{r:Lt(s.r),g:Lt(s.g),b:Lt(s.b),a:Lt(s.a,3)}},Bl=/^#([0-9a-f]{3,8})$/i,Sr=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},Wa=function(s){var t=s.r,e=s.g,r=s.b,i=s.a,n=Math.max(t,e,r),a=n-Math.min(t,e,r),o=a?n===t?(e-r)/a:n===e?2+(r-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:i}},$a=function(s){var t=s.h,e=s.s,r=s.v,i=s.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),a=r*(1-e),o=r*(1-(t-n)*e),h=r*(1-(1-t+n)*e),l=n%6;return{r:255*[r,o,a,a,h,r][l],g:255*[h,r,r,o,a,a][l],b:255*[a,a,h,r,r,o][l],a:i}},qa=function(s){return{h:Ha(s.h),s:Bt(s.s,0,100),l:Bt(s.l,0,100),a:Bt(s.a)}},Ya=function(s){return{h:Lt(s.h),s:Lt(s.s),l:Lt(s.l),a:Lt(s.a,3)}},Ka=function(s){return $a((e=(t=s).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},sr=function(s){return{h:(t=Wa(s)).h,s:(i=(200-(e=t.s))*(r=t.v)/100)>0&&i<200?e*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a};var t,e,r,i},Ul=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Gl=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,jl=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zl=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Qs={string:[[function(s){var t=Bl.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?Lt(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?Lt(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=jl.exec(s)||zl.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:Xa({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=Ul.exec(s)||Gl.exec(s);if(!t)return null;var e,r,i=qa({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(kl[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Ka(i)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,r=s.b,i=s.a,n=i===void 0?1:i;return Zt(t)&&Zt(e)&&Zt(r)?Xa({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(s){var t=s.h,e=s.s,r=s.l,i=s.a,n=i===void 0?1:i;if(!Zt(t)||!Zt(e)||!Zt(r))return null;var a=qa({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return Ka(a)},"hsl"],[function(s){var t=s.h,e=s.s,r=s.v,i=s.a,n=i===void 0?1:i;if(!Zt(t)||!Zt(e)||!Zt(r))return null;var a=function(o){return{h:Ha(o.h),s:Bt(o.s,0,100),v:Bt(o.v,0,100),a:Bt(o.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return $a(a)},"hsv"]]},Za=function(s,t){for(var e=0;e<t.length;e++){var r=t[e][0](s);if(r)return[r,t[e][1]]}return[null,void 0]},Vl=function(s){return typeof s=="string"?Za(s.trim(),Qs.string):typeof s=="object"&&s!==null?Za(s,Qs.object):[null,void 0]},ti=function(s,t){var e=sr(s);return{h:e.h,s:Bt(e.s+100*t,0,100),l:e.l,a:e.a}},ei=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Ja=function(s,t){var e=sr(s);return{h:e.h,s:e.s,l:Bt(e.l+100*t,0,100),a:e.a}},ri=function(){function s(t){this.parsed=Vl(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return Lt(ei(this.rgba),2)},s.prototype.isDark=function(){return ei(this.rgba)<.5},s.prototype.isLight=function(){return ei(this.rgba)>=.5},s.prototype.toHex=function(){return t=Js(this.rgba),e=t.r,r=t.g,i=t.b,a=(n=t.a)<1?Sr(Lt(255*n)):"","#"+Sr(e)+Sr(r)+Sr(i)+a;var t,e,r,i,n,a},s.prototype.toRgb=function(){return Js(this.rgba)},s.prototype.toRgbString=function(){return t=Js(this.rgba),e=t.r,r=t.g,i=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+i+", "+n+")":"rgb("+e+", "+r+", "+i+")";var t,e,r,i,n},s.prototype.toHsl=function(){return Ya(sr(this.rgba))},s.prototype.toHslString=function(){return t=Ya(sr(this.rgba)),e=t.h,r=t.s,i=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+i+"%, "+n+")":"hsl("+e+", "+r+"%, "+i+"%)";var t,e,r,i,n},s.prototype.toHsv=function(){return t=Wa(this.rgba),{h:Lt(t.h),s:Lt(t.s),v:Lt(t.v),a:Lt(t.a,3)};var t},s.prototype.invert=function(){return Xt({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Xt(ti(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Xt(ti(this.rgba,-t))},s.prototype.grayscale=function(){return Xt(ti(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Xt(Ja(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Xt(Ja(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Xt({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Lt(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=sr(this.rgba);return typeof t=="number"?Xt({h:t,s:e.s,l:e.l,a:e.a}):Lt(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Xt(t).toHex()},s}(),Xt=function(s){return s instanceof ri?s:new ri(s)},Qa=[],Hl=function(s){s.forEach(function(t){Qa.indexOf(t)<0&&(t(ri,Qs),Qa.push(t))})};function Xl(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in e)r[e[i]]=i;var n={};s.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=r[this.toHex()];if(l)return l;if(a?.closest){var u=this.toRgb(),d=1/0,c="black";if(!n.length)for(var p in e)n[p]=new s(e[p]).toRgb();for(var v in e){var f=(o=u,h=n[v],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));f<d&&(d=f,c=v)}return c}},t.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":e[o];return h?new s(h).toRgb():null},"name"])}Hl([Xl]);const Fe=class ms{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof ms)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((i,n)=>i===e[n]);if(t!==null&&e!==null){const i=Object.keys(t),n=Object.keys(e);return i.length!==n.length?!1:i.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,r,i]=this._components;return{r:t,g:e,b:r,a:i}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,i]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(i*255),t}toRgbArray(t){t=t??[];const[e,r,i]=this._components;return t[0]=e,t[1]=r,t[2]=i,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,i,n]=ms.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,i=i*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(i<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,i]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(i*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,i,n]=this._components;return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}normalize(t){let e,r,i,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,r=(a>>8&255)/255,i=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,i,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,i,n=255]=t,e/=255,r/=255,i/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=ms.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=Xt(t);a.isValid()&&({r:e,g:r,b:i,a:n}=a.rgba,e/=255,r/=255,i/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=i,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((i,n)=>{t[n]=Math.min(Math.max(i,e),r)}),t)}};Fe.shared=new Fe,Fe.temp=new Fe,Fe.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ne=Fe;function Wl(){const s=[],t=[];for(let r=0;r<32;r++)s[r]=r,t[r]=r;s[et.NORMAL_NPM]=et.NORMAL,s[et.ADD_NPM]=et.ADD,s[et.SCREEN_NPM]=et.SCREEN,t[et.NORMAL]=et.NORMAL_NPM,t[et.ADD]=et.ADD_NPM,t[et.SCREEN]=et.SCREEN_NPM;const e=[];return e.push(t),e.push(s),e}const $l=Wl();function to(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function Rr(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function eo(s){return!(s&s-1)&&!!s}function ro(s){let t=(s>65535?1:0)<<4;s>>>=t;let e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function Ir(s,t,e){const r=s.length;let i;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(i=t;i<n;++i)s[i]=s[i+e];s.length=n}let ql=0;function ir(){return++ql}const so={},Wt=Object.create(null),te=Object.create(null);function Yl(s,t=globalThis.location){if(s.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function io(s,t=1){const e=ft.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}var ht=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(ht||{});const si=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},no=(s,t)=>si(s).priority??t,pt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(si).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(si).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,i=this._queue;r[e]?r[e]?.(t):(i[e]=i[e]||[],i[e]?.push(t))})}),this},handle(s,t,e){const r=this._addHandlers,i=this._removeHandlers;if(r[s]||i[s])throw new Error(`Extension type ${s} already has a handler`);r[s]=t,i[s]=e;const n=this._queue;return n[s]&&(n[s]?.forEach(a=>t(a)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(s,t,e=-1){return this.handle(s,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((i,n)=>no(n,e)-no(i,e)))},r=>{const i=t.indexOf(r.ref);i!==-1&&t.splice(i,1)})}};class Kl{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Zl=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Jl(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function Ql(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=Zl.replace(/%forloop%/gi,Jl(s));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}const ii=0,ni=1,ai=2,oi=3,hi=4,li=5;class Oe{constructor(){this.data=0,this.blendMode=et.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<ii)}set blend(t){!!(this.data&1<<ii)!==t&&(this.data^=1<<ii)}get offsets(){return!!(this.data&1<<ni)}set offsets(t){!!(this.data&1<<ni)!==t&&(this.data^=1<<ni)}get culling(){return!!(this.data&1<<ai)}set culling(t){!!(this.data&1<<ai)!==t&&(this.data^=1<<ai)}get depthTest(){return!!(this.data&1<<oi)}set depthTest(t){!!(this.data&1<<oi)!==t&&(this.data^=1<<oi)}get depthMask(){return!!(this.data&1<<li)}set depthMask(t){!!(this.data&1<<li)!==t&&(this.data^=1<<li)}get clockwiseFrontFace(){return!!(this.data&1<<hi)}set clockwiseFrontFace(t){!!(this.data&1<<hi)!==t&&(this.data^=1<<hi)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==et.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new Oe;return t.depthTest=!1,t.blend=!0,t}}Oe.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ui=[];function ao(s,t){if(!s)return null;let e="";if(typeof s=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);r&&(e=r[1].toLowerCase())}for(let r=ui.length-1;r>=0;--r){const i=ui[r];if(i.test&&i.test(s,e))return new i(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Gt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,i,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let d=0,c=u.length;d<c;d++)u[d][l](t,e,r,i,n,a,o,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Gt.prototype,{dispatch:{value:Gt.prototype.emit},run:{value:Gt.prototype.emit}});class nr{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Gt("setRealSize"),this.onUpdate=new Gt("update"),this.onError=new Gt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class oo extends nr{constructor(t,e){const{width:r,height:i}=e||{};if(!r||!i)throw new Error("BufferResource width or height invalid");super(r,i),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const i=t.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ue.UNPACK);const n=e.realWidth,a=e.realHeight;return r.width===n&&r.height===a?i.texSubImage2D(e.target,0,0,0,n,a,e.format,r.type,this.data):(r.width=n,r.height=a,i.texImage2D(e.target,0,r.internalFormat,n,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const tu={scaleMode:Yt.NEAREST,alphaMode:ue.NPM},ci=class er extends Er{constructor(t=null,e=null){super(),e=Object.assign({},er.defaultOptions,e);const{alphaMode:r,mipmap:i,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:u,type:d,target:c,resolution:p,resourceOptions:v}=e;t&&!(t instanceof nr)&&(t=ao(t,v),t.internal=!0),this.resolution=p||ft.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=u,this.type=d,this.target=c,this.alphaMode=r,this.uid=ir(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=eo(this.realWidth)&&eo(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete te[this.cacheId],delete Wt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),er.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=ft.STRICT_TEXTURE_CACHE){const i=typeof t=="string";let n=null;if(i)n=t;else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${ir()}`}n=t._pixiId}let a=te[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new er(t,e),a.cacheId=n,er.addToCache(a,n)),a}static fromBuffer(t,e,r,i){t=t||new Float32Array(e*r*4);const n=new oo(t,{width:e,height:r,...i?.resourceOptions});let a,o;return t instanceof Float32Array?(a=X.RGBA,o=ot.FLOAT):t instanceof Int32Array?(a=X.RGBA_INTEGER,o=ot.INT):t instanceof Uint32Array?(a=X.RGBA_INTEGER,o=ot.UNSIGNED_INT):t instanceof Int16Array?(a=X.RGBA_INTEGER,o=ot.SHORT):t instanceof Uint16Array?(a=X.RGBA_INTEGER,o=ot.UNSIGNED_SHORT):t instanceof Int8Array?(a=X.RGBA,o=ot.BYTE):(a=X.RGBA,o=ot.UNSIGNED_BYTE),n.internal=!0,new er(n,Object.assign({},tu,{type:o,format:a},i))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),te[e]&&te[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),te[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=te[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete te[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete te[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};ci.defaultOptions={mipmap:le.POW2,anisotropicLevel:0,scaleMode:Yt.LINEAR,wrapMode:xs.CLAMP,alphaMode:ue.UNPACK,target:Se.TEXTURE_2D,format:X.RGBA,type:ot.UNSIGNED_BYTE},ci._globalBatch=0;let xt=ci;class eu{constructor(){this.texArray=null,this.blend=0,this.type=xr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let ru=0;class Nt{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=ru++,this.disposeRunner=new Gt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Ht.ELEMENT_ARRAY_BUFFER:Ht.ARRAY_BUFFER}get index(){return this.type===Ht.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Nt(t)}}class Lr{constructor(t,e=0,r=!1,i=ot.FLOAT,n,a,o,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=i,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,i,n){return new Lr(t,e,r,i,n)}}const su={Float32Array,Uint32Array,Int32Array,Uint8Array};function iu(s,t){let e=0,r=0;const i={};for(let h=0;h<s.length;h++)r+=t[h],e+=s[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<s.length;h++){const l=t[h],u=s[h],d=to(u);i[d]||(i[d]=new su[d](n)),a=i[d];for(let c=0;c<u.length;c++){const p=(c/l|0)*r+o,v=c%l;a[p+v]=u[c]}o+=l}return new Float32Array(n)}const ho={5126:4,5123:2,5121:1};let nu=0;const au={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Pe{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=nu++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Gt("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,i=!1,n,a,o,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Nt||(e instanceof Array&&(e=new Float32Array(e)),e=new Nt(e));const l=t.split("|");if(l.length>1){for(let d=0;d<l.length;d++)this.addAttribute(l[d],e,r,i,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Lr(u,r,i,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Nt||(t instanceof Array&&(t=new Uint16Array(t)),t=new Nt(t)),t.type=Ht.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Nt;let i;for(i in this.attributes){const n=this.attributes[i],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*ho[n.type]/4),n.buffer=0}for(r.data=iu(t,e),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Pe;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Nt(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Lr(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ht.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Pe,r=[],i=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)i[h]=i[h]||0,i[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new au[to(a.buffers[o].data)](i[o]),e.buffers[o]=new Nt(r[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=Ht.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,u=0;for(let d=0;d<a.buffers.length;d++)if(a.buffers[d]!==a.indexBuffer){u=d;break}for(const d in a.attributes){const c=a.attributes[d];(c.buffer|0)===u&&(h+=c.size*ho[c.type]/4)}for(let d=0;d<t.length;d++){const c=t[d].indexBuffer.data;for(let p=0;p<c.length;p++)e.indexBuffer.data[p+l]+=o;o+=t[d].buffers[u].data.length/h,l+=c.length}}return e}}class ou extends Pe{constructor(t=!1){super(),this._buffer=new Nt(null,t,!1),this._indexBuffer=new Nt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ot.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ot.FLOAT).addAttribute("aColor",this._buffer,4,!0,ot.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ot.FLOAT).addIndex(this._indexBuffer)}}const hu=Math.PI*2,lu=180/Math.PI,uu=Math.PI/180;var lo=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(lo||{});class Ot{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ot(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Ot.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Fr=[new Ot,new Ot,new Ot,new Ot];class Et{constructor(t=0,e=0,r=0,i=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i),this.type=lo.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Et(0,0,0,0)}clone(){return new Et(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;const C=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>C}const r=this.left,i=this.right,n=this.top,a=this.bottom;if(i<=r||a<=n)return!1;const o=Fr[0].set(t.left,t.top),h=Fr[1].set(t.left,t.bottom),l=Fr[2].set(t.right,t.top),u=Fr[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(o.x,h.x,l.x,u.x)<=r||Math.min(o.x,h.x,l.x,u.x)>=i||Math.max(o.y,h.y,l.y,u.y)<=n||Math.min(o.y,h.y,l.y,u.y)>=a))return!1;const c=d*(h.y-o.y),p=d*(o.x-h.x),v=c*r+p*n,f=c*i+p*n,m=c*r+p*a,y=c*i+p*a;if(Math.max(v,f,m,y)<=c*o.x+p*o.y||Math.min(v,f,m,y)>=c*u.x+p*u.y)return!1;const x=d*(o.y-l.y),T=d*(l.x-o.x),M=x*r+T*n,g=x*i+T*n,S=x*r+T*a,b=x*i+T*a;return!(Math.max(M,g,S,b)<=x*o.x+T*o.y||Math.min(M,g,S,b)>=x*u.x+T*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this}}Et.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class It{constructor(t=1,e=0,r=0,i=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,i,n,a){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ot;const r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e}applyInverse(t,e){e=e||new Ot;const r=1/(this.a*this.d+this.c*-this.b),i=t.x,n=t.y;return e.x=this.d*r*i+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),i=this.a,n=this.c,a=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,i=this.c,n=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,i,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,i=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,i=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-i,n),h=Math.atan2(r,e),l=Math.abs(o+h);return l<1e-5||Math.abs(hu-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+n*n),t.position.x=this.tx+(a.x*e+a.y*i),t.position.y=this.ty+(a.x*r+a.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,i=this.d,n=this.tx,a=t*i-e*r;return this.a=i/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-i*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new It;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new It}static get TEMP_MATRIX(){return new It}}It.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const fe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],pe=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],me=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ge=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],di=[],uo=[],Nr=Math.sign;function cu(){for(let s=0;s<16;s++){const t=[];di.push(t);for(let e=0;e<16;e++){const r=Nr(fe[s]*fe[e]+me[s]*pe[e]),i=Nr(pe[s]*fe[e]+ge[s]*pe[e]),n=Nr(fe[s]*me[e]+me[s]*ge[e]),a=Nr(pe[s]*me[e]+ge[s]*ge[e]);for(let o=0;o<16;o++)if(fe[o]===r&&pe[o]===i&&me[o]===n&&ge[o]===a){t.push(o);break}}}for(let s=0;s<16;s++){const t=new It;t.set(fe[s],pe[s],me[s],ge[s],0,0),uo.push(t)}}cu();const At={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>fe[s],uY:s=>pe[s],vX:s=>me[s],vY:s=>ge[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>di[s][t],sub:(s,t)=>di[s][At.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?At.S:At.N:Math.abs(t)*2<=Math.abs(s)?s>0?At.E:At.W:t>0?s>0?At.SE:At.SW:s>0?At.NE:At.NW,matrixAppendRotationInv:(s,t,e=0,r=0)=>{const i=uo[At.inv(t)];i.tx=e,i.ty=r,s.append(i)}};class ye{constructor(t,e,r=0,i=0){this._x=r,this._y=i,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new ye(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}ye.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const fi=class{constructor(){this.worldTransform=new It,this.localTransform=new It,this.position=new ye(this.onChange,this,0,0),this.scale=new ye(this.onChange,this,1,1),this.pivot=new ye(this.onChange,this,0,0),this.skew=new ye(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const e=s.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};fi.IDENTITY=new fi;let pi=fi;pi.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var du=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,fu=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function co(s,t,e){const r=s.createShader(t);return s.shaderSource(r,e),s.compileShader(r),r}function mi(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function fo(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return mi(2*t);case"bvec3":return mi(3*t);case"bvec4":return mi(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ce=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,t)=>s.type==="vec3"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],pu={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},mu={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function gu(s,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in s.uniforms){const i=t[r];if(!i){s.uniforms[r]?.group===!0&&(s.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const n=s.uniforms[r];let a=!1;for(let o=0;o<Ce.length;o++)if(Ce[o].test(i,n)){e.push(Ce[o].code(r,n)),a=!0;break}if(!a){const o=(i.size===1&&!i.isArray?pu:mu)[i.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${o};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const po={};let Or=po;function yu(){if(Or===po||Or?.isContextLost()){const s=ft.ADAPTER.createCanvas();let t;ft.PREFER_ENV>=he.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Or=t}return Or}let Pr;function vu(){if(!Pr){Pr=kt.MEDIUM;const s=yu();if(s&&s.getShaderPrecisionFormat){const t=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);t&&(Pr=t.precision?kt.HIGH:kt.MEDIUM)}}return Pr}function mo(s,t){const e=s.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=s.getShaderInfoLog(t),i=r.split(`
`),n={},a=i.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function bu(s,t,e,r){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||mo(s,e),s.getShaderParameter(r,s.COMPILE_STATUS)||mo(s,r),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}const xu={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function go(s){return xu[s]}let Cr=null;const yo={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function vo(s,t){if(!Cr){const e=Object.keys(yo);Cr={};for(let r=0;r<e.length;++r){const i=e[r];Cr[s[i]]=yo[i]}}return Cr[t]}function bo(s,t,e){if(s.substring(0,9)!=="precision"){let r=t;return t===kt.HIGH&&e!==kt.HIGH&&(r=kt.MEDIUM),`precision ${r} float;
${s}`}else if(e!==kt.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let ar;function _u(){if(typeof ar=="boolean")return ar;try{ar=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ar=!1}return ar}let Eu=0;const Dr={},gi=class rr{constructor(t,e,r="pixi-shader",i={}){this.extra={},this.id=Eu++,this.vertexSrc=t||rr.defaultVertexSrc,this.fragmentSrc=e||rr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Dr[r]?(Dr[r]++,r+=`-${Dr[r]}`):Dr[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=bo(this.vertexSrc,rr.defaultVertexPrecision,kt.HIGH),this.fragmentSrc=bo(this.fragmentSrc,rr.defaultFragmentPrecision,vu())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return fu}static get defaultFragmentSrc(){return du}static from(t,e,r){const i=t+e;let n=so[i];return n||(so[i]=n=new rr(t,e,r)),n}};gi.defaultVertexPrecision=kt.HIGH,gi.defaultFragmentPrecision=Ie.apple.device?kt.HIGH:kt.MEDIUM;let ve=gi,Tu=0;class $t{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Tu++,this.static=!!e,this.ubo=!!r,t instanceof Nt?(this.buffer=t,this.buffer.type=Ht.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Nt(new Float32Array(1)),this.buffer.type=Ht.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new $t(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new $t(t,e,r)}static uboFrom(t,e){return new $t(t,e??!0,!0)}}class kr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof $t?this.uniformGroup=e:this.uniformGroup=new $t(e):this.uniformGroup=new $t({}),this.disposeRunner=new Gt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const i=e.uniforms[r];if(i.group===!0&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const i=ve.from(t,e);return new kr(i,r)}}class wu{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=$t.from({uSamplers:r},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new ve(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new It,default:this.defaultGroupCache[t]};return new kr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Au{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Mu(){return!Ie.apple.device}function Su(s){let t=!0;const e=ft.ADAPTER.getNavigator();if(Ie.tablet||Ie.phone){if(Ie.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(Ie.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?s:4}class xo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Ru=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Iu=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const or=class Vt extends xo{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=ou,this.vertexSize=6,this.state=Oe.for2d(),this.size=Vt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??Su(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Mu(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return bt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Iu}static get defaultFragmentTemplate(){return Ru}setShaderGenerator({vertex:t=Vt.defaultVertexSrc,fragment:e=Vt.defaultFragmentTemplate}={}){this.shaderGenerator=new wu(t,e)}contextChange(){const t=this.renderer.gl;ft.PREFER_ENV===he.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Vt.defaultMaxTextures),this.maxTextures=Ql(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Vt,r=this.size/4,i=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new eu);for(;e.length<i;)e.push(new Au);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Vt._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++xt._globalBatch,h=0,l=r[0],u=0;i.copyBoundTextures(n,e);for(let d=0;d<this._bufferSize;++d){const c=t[d];t[d]=null,c._batchEnabled!==o&&(l.count>=e&&(i.boundArray(l,n,o,e),this.buildDrawCalls(l,u,d),u=d,l=r[++h],++o),c._batchEnabled=o,c.touched=a,l.elements[l.count++]=c)}l.count>0&&(i.boundArray(l,n,o,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(let d=0;d<n.length;d++)n[d]=null;xt._globalBatch=o}buildDrawCalls(t,e,r){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=Vt._drawCallPool;let l=this._dcIndex,u=this._aIndex,d=this._iIndex,c=h[l];c.start=this._iIndex,c.texArray=t;for(let p=e;p<r;++p){const v=i[p],f=v._texture.baseTexture,m=$l[f.alphaMode?1:0][v.blendMode];i[p]=null,e<p&&c.blend!==m&&(c.size=d-c.start,e=p,c=h[++l],c.texArray=t,c.start=d),this.packInterleavedGeometry(v,n,a,u,d),u+=v.vertexData.length/2*o,d+=v.indices.length,c.blend=m}e<r&&(c.size=d-c.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=d}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Vt.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,i=Vt._drawCallPool;let n=null;for(let a=0;a<t;a++){const{texArray:o,type:h,size:l,start:u,blend:d}=i[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=d,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Vt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Rr(Math.ceil(t/8)),r=ro(e),i=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Kl(i*this.vertexSize*4)),n}getIndexBuffer(t){const e=Rr(Math.ceil(t/12)),r=ro(e),i=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(i)),n}packInterleavedGeometry(t,e,r,i,n){const{uint32View:a,float32View:o}=e,h=i/this.vertexSize,l=t.uvs,u=t.indices,d=t.vertexData,c=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),v=Ne.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let f=0;f<d.length;f+=2)o[i++]=d[f],o[i++]=d[f+1],o[i++]=l[f],o[i++]=l[f+1],a[i++]=v,o[i++]=c;for(let f=0;f<u.length;f++)r[n++]=h+u[f]}};or.defaultBatchSize=4096,or.extension={name:"batch",type:ht.RendererPlugin},or._drawCallPool=[],or._textureArrayPool=[];let be=or;pt.add(be);var Lu=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Fu=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const yi=class vr extends kr{constructor(t,e,r){const i=ve.from(t||vr.defaultVertexSrc,e||vr.defaultFragmentSrc);super(i,r),this.padding=0,this.resolution=vr.defaultResolution,this.multisample=vr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Oe}apply(t,e,r,i,n){t.applyFilter(this,e,r,i)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Fu}static get defaultFragmentSrc(){return Lu}};yi.defaultResolution=1,yi.defaultMultisample=St.NONE;let ee=yi;class Br{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ne(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:i}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=i}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Br.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Br.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"background"},pt.add(Br);class _o{constructor(t){this.renderer=t,this.emptyRenderer=new xo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,e,r,i){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const u=n[l],d=u._batchLocation;if(d>=0&&d<i&&e[d]===u){a[l]=d;continue}for(;h<i;){const c=e[h];if(c&&c._batchEnabled===r&&c._batchLocation===h){h++;continue}a[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}_o.extension={type:ht.RendererSystem,name:"batch"},pt.add(_o);let Eo=0;class Ur{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Eo++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Eo++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(ft.PREFER_ENV>=he.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ur.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Ur.extension={type:ht.RendererSystem,name:"context"},pt.add(Ur);class vi{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Gt("disposeFramebuffer"),this.multisample=St.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new xt(null,{scaleMode:Yt.NEAREST,resolution:1,mipmap:le.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new xt(null,{scaleMode:Yt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:le.OFF,format:X.DEPTH_COMPONENT,type:ot.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],n=i.resolution;i.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class To extends xt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],i=arguments[2],n=arguments[3];t={width:e,height:r,scaleMode:i,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=St.NONE),super(null,t),this.mipmap=le.OFF,this.valid=!0,this._clear=new Ne([0,0,0,0]),this.framebuffer=new vi(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Jt extends nr{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,i=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(r,i),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Yl(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,i){const n=t.gl,a=e.realWidth,o=e.realHeight;if(i=i||this.source,typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement){if(!i.complete||i.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===ue.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===a&&r.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,i):(r.width=a,r.height=o,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,i)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class wo extends Jt{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Jt.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const i=this.source;this.url=i.src;const n=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};i.complete&&i.src?n():(i.onload=n,i.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(i=>i.blob()).then(i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ue.UNPACK?"premultiply":"none"})).then(i=>this.destroyed?Promise.reject():(this.bitmap=i,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let i=!0;const n=e._glTextures;for(const a in n){const o=n[a];if(o!==r&&o.dirtyId!==e.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class bi{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const i=e.width,n=e.height;if(r){const a=t.width/2/i,o=t.height/2/n,h=t.x/i+a,l=t.y/n+o;r=At.add(r,At.NW),this.x0=h+a*At.uX(r),this.y0=l+o*At.uY(r),r=At.add(r,2),this.x1=h+a*At.uX(r),this.y1=l+o*At.uY(r),r=At.add(r,2),this.x2=h+a*At.uX(r),this.y2=l+o*At.uY(r),r=At.add(r,2),this.x3=h+a*At.uX(r),this.y3=l+o*At.uY(r)}else this.x0=t.x/i,this.y0=t.y/n,this.x1=(t.x+t.width)/i,this.y1=t.y/n,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/n,this.x3=t.x/i,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}bi.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Ao=new bi;function Gr(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class _t extends Er{constructor(t,e,r,i,n,a,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Et(0,0,1,1)),t instanceof _t&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=Ao,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Ot(a.x,a.y):new Ot(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Wt[e.url]&&_t.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,_t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new _t(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Ao&&(this._uvs=new bi),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=ft.STRICT_TEXTURE_CACHE){const i=typeof t=="string";let n=null;if(i)n=t;else if(t instanceof xt){if(!t.cacheId){const o=e?.pixiIdPrefix||"pixiid";t.cacheId=`${o}-${ir()}`,xt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${ir()}`}n=t._pixiId}let a=Wt[n];if(i&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof xt)?(e.resolution||(e.resolution=io(t)),a=new _t(new xt(t,e)),a.baseTexture.cacheId=n,xt.addToCache(a.baseTexture,n),_t.addToCache(a,n)):!a&&t instanceof xt&&(a=new _t(t),_t.addToCache(a,n)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),i=_t.from(t,Object.assign({resourceOptions:r},e),!1),n=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):n.load().then(()=>Promise.resolve(i))}static fromBuffer(t,e,r,i){return new _t(xt.fromBuffer(t,e,r,i))}static fromLoader(t,e,r,i){const n=new xt(t,Object.assign({scaleMode:xt.defaultOptions.scaleMode,resolution:io(e)},i)),{resource:a}=n;a instanceof wo&&(a.url=e);const o=new _t(n);return r||(r=e),xt.addToCache(o.baseTexture,r),_t.addToCache(o,r),r!==e&&(xt.addToCache(o.baseTexture,e),_t.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Wt[e]&&Wt[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Wt[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Wt[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Wt[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Wt[t.textureCacheIds[e]]===t&&delete Wt[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:i,height:n}=t,a=e+i>this.baseTexture.width,o=r+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${e} + ${i} = ${e+i} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=i&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return _t._EMPTY||(_t._EMPTY=new _t(new xt),Gr(_t._EMPTY),Gr(_t._EMPTY.baseTexture)),_t._EMPTY}static get WHITE(){if(!_t._WHITE){const t=ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),_t._WHITE=new _t(xt.from(t)),Gr(_t._WHITE),Gr(_t._WHITE.baseTexture)}return _t._WHITE}}class jr extends _t{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const i=this.baseTexture.resolution,n=Math.round(t*i)/i,a=Math.round(e*i)/i;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new jr(new To(t))}}class Mo{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=St.NONE){const i=new To(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new jr(i)}getOptimalTexture(t,e,r=1,i=St.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Rr(t),e=Rr(e),n=((t&65535)<<16|e&65535)>>>0,i>1&&(n+=i*4294967296)):n=i>1?-i:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,i)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(t,e,r){const i=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||St.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Mo.SCREEN_KEY=-1;class Nu extends Pe{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ou extends Pe{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Nt(this.vertices),this.uvBuffer=new Nt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Pu{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=St.NONE,this.sourceFrame=new Et,this.destinationFrame=new Et,this.bindingSourceFrame=new Et,this.bindingDestinationFrame=new Et,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const zr=[new Ot,new Ot,new Ot,new Ot],xi=new It;class So{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Mo,this.statePool=[],this.quad=new Nu,this.quadUv=new Ou,this.tempRect=new Et,this.activeState={},this.globalUniforms=new $t({outputFrame:new Et,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,i=this.defaultFilterStack,n=this.statePool.pop()||new Pu,a=r.renderTexture;let o,h;if(a.current){const m=a.current;o=m.resolution,h=m.multisample}else o=r.resolution,h=r.multisample;let l=e[0].resolution||o,u=e[0].multisample??h,d=e[0].padding,c=e[0].autoFit,p=e[0].legacy??!0;for(let m=1;m<e.length;m++){const y=e[m];l=Math.min(l,y.resolution||o),u=Math.min(u,y.multisample??h),d=this.useMaxPadding?Math.max(d,y.padding):d+y.padding,c=c&&y.autoFit,p=p||(y.legacy??!0)}i.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),i.push(n),n.resolution=l,n.multisample=u,n.legacy=p,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(d);const v=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(xi.copyFrom(r.projection.transform).invert(),v),c?(n.sourceFrame.fit(v),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(v)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,f),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;const n=i.inputSize,a=i.inputPixel,o=i.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const l=i.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,ce.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let d=0;for(d=0;d<r.length-1;++d){d===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[d].apply(this,l,u,ce.CLEAR,e);const c=l;l=u,u=c}r[d].apply(this,l,h.renderTexture,ce.BLEND,e),d>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ce.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=i.stateId&1||this.forceClear;(e===ce.CLEAR||e===ce.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,i){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,i),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(xr.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(xr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:n}=e._texture,a=t.set(i.width,0,0,i.height,r.x,r.y),o=e.worldTransform.copyTo(It.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,i=St.NONE){return this.texturePool.getOptimalTexture(t,e,r,i)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||St.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=zr[0],i=zr[1],n=zr[2],a=zr[3];r.set(e.left,e.top),i.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(i,i),t.apply(n,n),t.apply(a,a);const o=Math.min(r.x,i.x,n.x,a.x),h=Math.min(r.y,i.y,n.y,a.y),l=Math.max(r.x,i.x,n.x,a.x),u=Math.max(r.y,i.y,n.y,a.y);e.x=o,e.y=h,e.width=l-o,e.height=u-h}roundFrame(t,e,r,i,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?xi.copyFrom(n):xi.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}So.extension={type:ht.RendererSystem,name:"filter"},pt.add(So);class Cu{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=St.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Du=new Et;class Ro{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new vi(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Et,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ft.PREFER_ENV===he.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=i=>e.drawBuffersWEBGL(i):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:i}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,o=e.height>>r,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,o)}else{const a=t.width>>r,o=t.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,i){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),(n.width!==r||n.height!==i||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=i,this.gl.viewport(t,e,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,i,n=bs.COLOR|bs.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,i),a.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Cu(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const i=t.colorTextures;let n=i.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=i[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+h))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){i.stencil=i.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,i.stencil)}else i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=St.NONE;if(t<=1||e===null)return r;for(let i=0;i<e.length;i++)if(e[i]<=t){r=e[i];break}return r===1&&(r=St.NONE),r}blit(t,e,r){const{current:i,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!i)return;const h=i.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=i.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new vi(i.width,i.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==i.width||t.height!==i.height)&&(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}e||(e=Du,e.width=i.width,e.height=i.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,i=t.height,n=this.gl,a=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,r,i):n.renderbufferStorage(n.RENDERBUFFER,h,r,i),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Et}destroy(){this.renderer=null}}Ro.extension={type:ht.RendererSystem,name:"framebuffer"},pt.add(Ro);const _i={5126:4,5123:2,5121:1};class Io{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ft.PREFER_ENV===he.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=i=>r.bindVertexArrayOES(i),t.deleteVertexArray=i=>r.deleteVertexArrayOES(i)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(i,n)=>r.vertexAttribDivisorANGLE(i,n),t.drawElementsInstanced=(i,n,a,o,h)=>r.drawElementsInstancedANGLE(i,n,a,o,h),t.drawArraysInstanced=(i,n,a,o)=>r.drawArraysInstancedANGLE(i,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},n=!0);const a=i[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];e.update(i)}}checkCompatibility(t,e){const r=t.attributes,i=e.attributeData;for(const n in i)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,i=e.attributeData,n=["g",t.id];for(const a in r)i[a]&&n.push(a,i[a].location);return n.join("-")}initGeometryVao(t,e,r=!0){const i=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[o.id]=u,u;const d=t.buffers,c=t.attributes,p={},v={};for(const f in d)p[f]=0,v[f]=0;for(const f in c)!c[f].size&&o.attributeData[f]?c[f].size=o.attributeData[f].size:c[f].size||console.warn(`PIXI Geometry attribute '${f}' size cannot be determined (likely the bound shader does not have the attribute)`),p[c[f].buffer]+=c[f].size*_i[c[f].type];for(const f in c){const m=c[f],y=m.size;m.stride===void 0&&(p[m.buffer]===y*_i[m.type]?m.stride=0:m.stride=p[m.buffer]),m.start===void 0&&(m.start=v[m.buffer],v[m.buffer]+=y*_i[m.type])}u=i.createVertexArray(),i.bindVertexArray(u);for(let f=0;f<d.length;f++){const m=d[f];a.bind(m),r&&m._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=u,l[h]=u,i.bindVertexArray(null),a.unbind(Ht.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,n=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let o=0;o<n.length;o++){const h=n[o]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(n[o],e))}if(!e){for(const o in r)if(o[0]==="g"){const h=r[o];this._activeVao===h&&this.unbind(),i.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,i=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const u=o[l],d=a[u.buffer],c=d._glBuffers[i];if(e.attributeData[l]){h!==c&&(n.bind(d),h=c);const p=e.attributeData[l].location;if(r.enableVertexAttribArray(p),r.vertexAttribPointer(p,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(p,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,i){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(r||0)*o,i||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,r,e||a.getSize(),i||1):n.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Io.extension={type:ht.RendererSystem,name:"geometry"},pt.add(Io);const Lo=new It;class ku{constructor(t,e){this._texture=t,this.mapCoord=new It,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let i=0;i<t.length;i+=2){const n=t[i],a=t[i+1];e[i]=n*r.a+a*r.c+r.tx,e[i+1]=n*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=e.orig,n=e.trim;n&&(Lo.set(i.width/n.width,0,0,i.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Lo));const a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(e._frame.x+h+l)/a.width,o[1]=(e._frame.y+h+l)/a.height,o[2]=(e._frame.x+e._frame.width-h+l)/a.width,o[3]=(e._frame.y+e._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var Bu=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Uu=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Gu extends ee{constructor(t,e,r){let i=null;typeof t!="string"&&e===void 0&&r===void 0&&(i=t,t=void 0,e=void 0,r=void 0),super(t||Uu,e||Bu,r),this.maskSprite=i,this.maskMatrix=new It}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,i){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new ku(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))}}class ju{constructor(t=null){this.type=Rt.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ee.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Rt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Fo{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new ju;n.pooled=!0,n.maskObject=e,r=n}const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Rt.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Rt.SCISSOR:this.renderer.scissor.push(r);break;case Rt.STENCIL:this.renderer.stencil.push(r);break;case Rt.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Rt.COLOR:this.pushColorMask(r);break}r.type===Rt.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Rt.SCISSOR:this.renderer.scissor.pop(e);break;case Rt.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Rt.SPRITE:this.popSpriteMask(e);break;case Rt.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Rt.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Rt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Rt.SCISSOR:t.type=Rt.STENCIL:t.type=Rt.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let i=t._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new Gu])),i[0].resolution=t.resolution,i[0].multisample=t.multisample,i[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Fo.extension={type:ht.RendererSystem,name:"mask"},pt.add(Fo);class No{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==r&&(i===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Oo=new It,Po=[],Co=class gs extends No{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:i}=this,n=i.renderTexture,a=r.getBounds(!0,Po.pop()??new Et);this.roundFrameToPixels(a,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:i,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||gs.isMatrixRotated(e.worldTransform)||gs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,i,n){gs.isMatrixRotated(n)||(n=n?Oo.copyFrom(n):Oo.identity(),n.translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,t),t.fit(i),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Po.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Co.extension={type:ht.RendererSystem,name:"scissor"};let zu=Co;pt.add(zu);class Do extends No{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,i=t._stencilCounter;i===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;i!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,i!==0&&(r._colorMask=i,e.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Do.extension={type:ht.RendererSystem,name:"stencil"},pt.add(Do);class ko{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return bt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}ko.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"_plugin"},pt.add(ko);class Bo{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new It,this.transform=null}update(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,i){const n=this.projectionMatrix,a=i?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Bo.extension={type:ht.RendererSystem,name:"projection"},pt.add(Bo);const Vu=new pi,Uo=new Et;class Go{constructor(t){this.renderer=t,this._tempMatrix=new It}generateTexture(t,e){const{region:r,...i}=e||{},n=r?.copyTo(Uo)||t.getLocalBounds(Uo,!0),a=i.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),i.width=n.width,i.height=n.height,i.resolution=a,i.multisample??(i.multisample=this.renderer.multisample);const o=jr.create(i);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=Vu,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,o}destroy(){}}Go.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"textureGenerator"},pt.add(Go);const xe=new Et,hr=new Et;class jo{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Et,this.destinationFrame=new Et,this.viewportFrame=new Et}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const i=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(xe.width=t.frame.width,xe.height=t.frame.height,e=xe),r||(hr.x=t.frame.x,hr.y=t.frame.y,hr.width=e.width,hr.height=e.height,r=hr),a=n.framebuffer):(o=i.resolution,e||(xe.width=i._view.screen.width,xe.height=i._view.screen.height,e=xe),r||(r=xe,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*o,h.y=r.y*o,h.width=r.width*o,h.height=r.height*o,t||(h.y=i.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=Ne.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:u,height:d}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,d)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}jo.extension={type:ht.RendererSystem,name:"renderTexture"},pt.add(jo);class Hu{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Xu(s,t){const e={},r=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const n=t.getActiveAttrib(s,i);if(n.name.startsWith("gl_"))continue;const a=vo(t,n.type),o={type:a,name:n.name,size:go(a),location:t.getAttribLocation(s,n.name)};e[n.name]=o}return e}function Wu(s,t){const e={},r=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const n=t.getActiveUniform(s,i),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=vo(t,n.type);e[a]={name:a,index:i,type:h,size:n.size,isArray:o,value:fo(h,n.size)}}return e}function $u(s,t){const e=co(s,s.VERTEX_SHADER,t.vertexSrc),r=co(s,s.FRAGMENT_SHADER,t.fragmentSrc),i=s.createProgram();s.attachShader(i,e),s.attachShader(i,r);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(i,n.names,n.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(i),s.getProgramParameter(i,s.LINK_STATUS)||bu(s,i,e,r),t.attributeData=Xu(i,s),t.uniformData=Wu(i,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const o=Object.keys(t.attributeData);o.sort((h,l)=>h>l?1:-1);for(let h=0;h<o.length;h++)t.attributeData[o[h]].location=h,s.bindAttribLocation(i,h,o[h]);s.linkProgram(i)}s.deleteShader(e),s.deleteShader(r);const a={};for(const o in t.uniformData){const h=t.uniformData[o];a[o]={location:s.getUniformLocation(i,o),value:fo(h.type,h.size)}}return new Hu(i,a)}function qu(s,t,e,r,i){e.buffer.update(i)}const Yu={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},zo={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Ku(s){const t=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,i=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=zo[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const o=r%e%16;r+=o,i+=o}r+e>16?(i=Math.ceil(i/16)*16,a.offset=i,i+=e,r=e):(a.offset=i,r+=e,i+=e)}return i=Math.ceil(i/16)*16,{uboElements:t,size:i}}function Zu(s,t){const e=[];for(const r in s)t[r]&&e.push(t[r]);return e.sort((r,i)=>r.index-i.index),e}function Ju(s,t){if(!s.autoManage)return{size:0,syncFunc:qu};const e=Zu(s.uniforms,t),{uboElements:r,size:i}=Ku(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],h=s.uniforms[o.data.name],l=o.data.name;let u=!1;for(let d=0;d<Ce.length;d++){const c=Ce[d];if(c.codeUbo&&c.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Ce[d].codeUbo(o.data.name,h)),u=!0;break}}if(!u)if(o.data.size>1){const d=go(o.data.type),c=Math.max(zo[o.data.type]/16,1),p=d/c,v=(4-p%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*c}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${v};
                }

                `)}else{const d=Yu[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${d};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Qu=0;const Vr={textureCount:0,uboCount:0};class Vo{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Qu++}systemCheck(){if(!_u())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(Vr.textureCount=0,Vr.uboCount=0,this.syncUniformGroup(t.uniformGroup,Vr)),i}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=gu(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const i=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),i(r.uniformData,t.uniforms,this.renderer,Vr,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=Ju(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const i=t.uniforms,n=[`${r}-`];for(const a in i)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,i=$u(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Vo.extension={type:ht.RendererSystem,name:"shader"},pt.add(Vo);class Hr{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Hr.defaultOptions={hello:!1},Hr.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"startup"},pt.add(Hr);function tc(s,t=[]){return t[et.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.ADD]=[s.ONE,s.ONE],t[et.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.NONE]=[0,0],t[et.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[et.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[et.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[et.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[et.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[et.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[et.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[et.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[et.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[et.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[et.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}const ec=0,rc=1,sc=2,ic=3,nc=4,ac=5,Ho=class Ji{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=et.NONE,this._blendEq=!1,this.map=[],this.map[ec]=this.setBlend,this.map[rc]=this.setOffset,this.map[sc]=this.setCullFace,this.map[ic]=this.setDepthTest,this.map[nc]=this.setFrontFace,this.map[ac]=this.setDepthMask,this.checks=[],this.defaultState=new Oe,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=tc(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(Ji.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(Ji.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Ho.extension={type:ht.RendererSystem,name:"state"};let oc=Ho;pt.add(oc);class hc extends Er{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(i=>t.systems[i]),r=[...e,...Object.keys(t.systems).filter(i=>!e.includes(i))];for(const i of r)this.addSystem(t.systems[i],i)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Gt(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const i in this.runners)this.runners[i].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(i=>{const n=r.find(a=>this._systemsHash[a]===i);i[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const lr=class ys{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=ys.defaultMaxIdle,this.checkCountMax=ys.defaultCheckCountMax,this.mode=ys.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==_s.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let i=0;i<e.length;i++){const n=e[i];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[i]=null,r=!0)}if(r){let i=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[i++]=e[n]);e.length=i}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let i=t.children.length-1;i>=0;i--)this.unload(t.children[i])}destroy(){this.renderer=null}};lr.defaultMode=_s.AUTO,lr.defaultMaxIdle=60*60,lr.defaultCheckCountMax=60*10,lr.extension={type:ht.RendererSystem,name:"textureGC"};let _e=lr;pt.add(_e);class Ei{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ot.UNSIGNED_BYTE,this.internalFormat=X.RGBA,this.samplerType=0}}function lc(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[s.RGB]:$.FLOAT,[s.RGBA]:$.FLOAT,[s.ALPHA]:$.FLOAT,[s.LUMINANCE]:$.FLOAT,[s.LUMINANCE_ALPHA]:$.FLOAT,[s.R8]:$.FLOAT,[s.R8_SNORM]:$.FLOAT,[s.RG8]:$.FLOAT,[s.RG8_SNORM]:$.FLOAT,[s.RGB8]:$.FLOAT,[s.RGB8_SNORM]:$.FLOAT,[s.RGB565]:$.FLOAT,[s.RGBA4]:$.FLOAT,[s.RGB5_A1]:$.FLOAT,[s.RGBA8]:$.FLOAT,[s.RGBA8_SNORM]:$.FLOAT,[s.RGB10_A2]:$.FLOAT,[s.RGB10_A2UI]:$.FLOAT,[s.SRGB8]:$.FLOAT,[s.SRGB8_ALPHA8]:$.FLOAT,[s.R16F]:$.FLOAT,[s.RG16F]:$.FLOAT,[s.RGB16F]:$.FLOAT,[s.RGBA16F]:$.FLOAT,[s.R32F]:$.FLOAT,[s.RG32F]:$.FLOAT,[s.RGB32F]:$.FLOAT,[s.RGBA32F]:$.FLOAT,[s.R11F_G11F_B10F]:$.FLOAT,[s.RGB9_E5]:$.FLOAT,[s.R8I]:$.INT,[s.R8UI]:$.UINT,[s.R16I]:$.INT,[s.R16UI]:$.UINT,[s.R32I]:$.INT,[s.R32UI]:$.UINT,[s.RG8I]:$.INT,[s.RG8UI]:$.UINT,[s.RG16I]:$.INT,[s.RG16UI]:$.UINT,[s.RG32I]:$.INT,[s.RG32UI]:$.UINT,[s.RGB8I]:$.INT,[s.RGB8UI]:$.UINT,[s.RGB16I]:$.INT,[s.RGB16UI]:$.UINT,[s.RGB32I]:$.INT,[s.RGB32UI]:$.UINT,[s.RGBA8I]:$.INT,[s.RGBA8UI]:$.UINT,[s.RGBA16I]:$.INT,[s.RGBA16UI]:$.UINT,[s.RGBA32I]:$.INT,[s.RGBA32UI]:$.UINT,[s.DEPTH_COMPONENT16]:$.FLOAT,[s.DEPTH_COMPONENT24]:$.FLOAT,[s.DEPTH_COMPONENT32F]:$.FLOAT,[s.DEPTH_STENCIL]:$.FLOAT,[s.DEPTH24_STENCIL8]:$.FLOAT,[s.DEPTH32F_STENCIL8]:$.FLOAT}:t={[s.RGB]:$.FLOAT,[s.RGBA]:$.FLOAT,[s.ALPHA]:$.FLOAT,[s.LUMINANCE]:$.FLOAT,[s.LUMINANCE_ALPHA]:$.FLOAT,[s.DEPTH_STENCIL]:$.FLOAT},t}function uc(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[ot.UNSIGNED_BYTE]:{[X.RGBA]:s.RGBA8,[X.RGB]:s.RGB8,[X.RG]:s.RG8,[X.RED]:s.R8,[X.RGBA_INTEGER]:s.RGBA8UI,[X.RGB_INTEGER]:s.RGB8UI,[X.RG_INTEGER]:s.RG8UI,[X.RED_INTEGER]:s.R8UI,[X.ALPHA]:s.ALPHA,[X.LUMINANCE]:s.LUMINANCE,[X.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[ot.BYTE]:{[X.RGBA]:s.RGBA8_SNORM,[X.RGB]:s.RGB8_SNORM,[X.RG]:s.RG8_SNORM,[X.RED]:s.R8_SNORM,[X.RGBA_INTEGER]:s.RGBA8I,[X.RGB_INTEGER]:s.RGB8I,[X.RG_INTEGER]:s.RG8I,[X.RED_INTEGER]:s.R8I},[ot.UNSIGNED_SHORT]:{[X.RGBA_INTEGER]:s.RGBA16UI,[X.RGB_INTEGER]:s.RGB16UI,[X.RG_INTEGER]:s.RG16UI,[X.RED_INTEGER]:s.R16UI,[X.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[ot.SHORT]:{[X.RGBA_INTEGER]:s.RGBA16I,[X.RGB_INTEGER]:s.RGB16I,[X.RG_INTEGER]:s.RG16I,[X.RED_INTEGER]:s.R16I},[ot.UNSIGNED_INT]:{[X.RGBA_INTEGER]:s.RGBA32UI,[X.RGB_INTEGER]:s.RGB32UI,[X.RG_INTEGER]:s.RG32UI,[X.RED_INTEGER]:s.R32UI,[X.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[ot.INT]:{[X.RGBA_INTEGER]:s.RGBA32I,[X.RGB_INTEGER]:s.RGB32I,[X.RG_INTEGER]:s.RG32I,[X.RED_INTEGER]:s.R32I},[ot.FLOAT]:{[X.RGBA]:s.RGBA32F,[X.RGB]:s.RGB32F,[X.RG]:s.RG32F,[X.RED]:s.R32F,[X.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[ot.HALF_FLOAT]:{[X.RGBA]:s.RGBA16F,[X.RGB]:s.RGB16F,[X.RG]:s.RG16F,[X.RED]:s.R16F},[ot.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:s.RGB565},[ot.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:s.RGBA4},[ot.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:s.RGB5_A1},[ot.UNSIGNED_INT_2_10_10_10_REV]:{[X.RGBA]:s.RGB10_A2,[X.RGBA_INTEGER]:s.RGB10_A2UI},[ot.UNSIGNED_INT_10F_11F_11F_REV]:{[X.RGB]:s.R11F_G11F_B10F},[ot.UNSIGNED_INT_5_9_9_9_REV]:{[X.RGB]:s.RGB9_E5},[ot.UNSIGNED_INT_24_8]:{[X.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[ot.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[X.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:t={[ot.UNSIGNED_BYTE]:{[X.RGBA]:s.RGBA,[X.RGB]:s.RGB,[X.ALPHA]:s.ALPHA,[X.LUMINANCE]:s.LUMINANCE,[X.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[ot.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:s.RGB},[ot.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:s.RGBA},[ot.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:s.RGBA}},t}class Xo{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new xt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=uc(t),this.samplerTypes=lc(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let i=0;i<e;i++)this.boundTextures[i]=null;this.emptyTextures={};const r=new Ei(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Ei(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let i=0;i<this.boundTextures.length;i++)this.bind(null,i)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i=0;i<r.length;i++)r[i]===this.unknownTexture&&this.bind(null,i)}for(let i=0;i<r.length;i++)r[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[i]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[i].samplerType!==$.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new Ei(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??$.FLOAT,this.webGLVersion===2&&t.type===ot.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==$.FLOAT&&(this.hasIntegerTextures=!0);else{const i=t.realWidth,n=t.realHeight,a=r.gl;(e.width!==i||e.height!==n||e.dirtyId<0)&&(e.width=i,e.height=n,a.texImage2D(t.target,0,e.internalFormat,i,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const i=this.managedTextures.indexOf(t);i!==-1&&Ir(this.managedTextures,i,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===le.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=xs.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==le.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Yt.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const i=this.renderer.context.extensions.anisotropicFiltering;if(i&&t.anisotropicLevel>0&&t.scaleMode===Yt.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Yt.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Yt.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Xo.extension={type:ht.RendererSystem,name:"texture"},pt.add(Xo);class Wo{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:i}=this;e&&i.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:i}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[i]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(r.buffer.update(o),o._glBuffers[i].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[i].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o,e))}r&&(e||i.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Wo.extension={type:ht.RendererSystem,name:"transformFeedback"},pt.add(Wo);class Xr{constructor(t){this.renderer=t}init(t){this.screen=new Et(0,0,t.width,t.height),this.element=t.view||ft.ADAPTER.createCanvas(),this.resolution=t.resolution||ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Xr.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Xr.extension={type:[ht.RendererSystem,ht.CanvasRendererSystem],name:"_view"},pt.add(Xr),ft.PREFER_ENV=he.WEBGL2,ft.STRICT_TEXTURE_CACHE=!1,ft.RENDER_OPTIONS={...Ur.defaultOptions,...Br.defaultOptions,...Xr.defaultOptions,...Hr.defaultOptions},Object.defineProperties(ft,{WRAP_MODE:{get(){return xt.defaultOptions.wrapMode},set(s){bt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),xt.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return xt.defaultOptions.scaleMode},set(s){bt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),xt.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return xt.defaultOptions.mipmap},set(s){bt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),xt.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return xt.defaultOptions.anisotropicLevel},set(s){bt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),xt.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return bt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ee.defaultResolution},set(s){ee.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return bt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ee.defaultMultisample},set(s){ee.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return be.defaultMaxTextures},set(s){bt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),be.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return be.defaultBatchSize},set(s){bt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),be.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return be.canUploadSameBuffer},set(s){bt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),be.canUploadSameBuffer=s}},GC_MODE:{get(){return _e.defaultMode},set(s){bt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),_e.defaultMode=s}},GC_MAX_IDLE:{get(){return _e.defaultMaxIdle},set(s){bt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),_e.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return _e.defaultCheckCountMax},set(s){bt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),_e.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return ve.defaultVertexPrecision},set(s){bt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),ve.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return ve.defaultFragmentPrecision},set(s){bt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),ve.defaultFragmentPrecision=s}}});var Wr=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Wr||{});class Ti{constructor(t,e=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=i}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const $o=class Dt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Ti(null,null,1/0),this.deltaMS=1/Dt.targetFPMS,this.elapsedMS=1/Dt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Wr.NORMAL){return this._addListener(new Ti(t,e,r))}addOnce(t,e,r=Wr.NORMAL){return this._addListener(new Ti(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Dt.targetFPMS;const r=this._head;let i=r.next;for(;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Dt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Dt._shared){const t=Dt._shared=new Dt;t.autoStart=!0,t._protected=!0}return Dt._shared}static get system(){if(!Dt._system){const t=Dt._system=new Dt;t.autoStart=!0,t._protected=!0}return Dt._system}};$o.targetFPMS=.06;let re=$o;Object.defineProperties(ft,{TARGET_FPMS:{get(){return re.targetFPMS},set(s){bt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),re.targetFPMS=s}}});class qo{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Wr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?re.shared:new re,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}qo.extension=ht.Application,pt.add(qo);const Yo=[];pt.handleByList(ht.Renderer,Yo);function cc(s){for(const t of Yo)if(t.test(s))return new t(s);throw new Error("Unable to auto-detect a suitable renderer.")}var dc=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const fc=dc;class Ko{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=St.HIGH?this.multisample=St.HIGH:e>=St.MEDIUM?this.multisample=St.MEDIUM:e>=St.LOW?this.multisample=St.LOW:this.multisample=St.NONE}destroy(){}}Ko.extension={type:ht.RendererSystem,name:"_multisample"},pt.add(Ko);class pc{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Zo{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:i,CONTEXT_UID:n}=this;r=r||0;const a=t._glBuffers[n]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,e.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new pc(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Zo.extension={type:ht.RendererSystem,name:"buffer"},pt.add(Zo);class Jo{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let i,n,a,o;if(e&&(i=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(i||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),i&&(e.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Jo.extension={type:ht.RendererSystem,name:"objectRenderer"},pt.add(Jo);const $r=class Qi extends hc{constructor(t){super(),this.type=sn.WEBGL,t=Object.assign({},ft.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new $t({projectionMatrix:new It},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Qi.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(bt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Qi.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:Dl()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return bt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return bt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return bt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return bt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){bt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return bt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){bt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return bt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};$r.extension={type:ht.Renderer,priority:1},$r.__plugins={},$r.__systems={};let wi=$r;pt.handleByMap(ht.RendererPlugin,wi.__plugins),pt.handleByMap(ht.RendererSystem,wi.__systems),pt.add(wi);class Qo extends nr{constructor(t,e){const{width:r,height:i}=e||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new xt;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof nr?this.addResourceAt(t[r],r):this.addResourceAt(ao(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class mc extends Qo{constructor(t,e){const{width:r,height:i}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:r,height:i}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Se.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:i,itemDirtyIds:n,items:a}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,e.format,r.type,null);for(let h=0;h<i;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class gc extends Jt{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const th=class br extends Qo{constructor(t,e){const{width:r,height:i,autoLoad:n,linkBaseTexture:a}=e||{};if(t&&t.length!==br.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:i});for(let o=0;o<br.SIDES;o++)this.items[o].target=Se.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=Se.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=Se.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const i=this.itemDirtyIds;for(let n=0;n<br.SIDES;n++){const a=this.items[n];(i[n]<a.dirtyId||r.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,r),i[n]=a.dirtyId):i[n]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),i[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===br.SIDES}};th.SIDES=6;let yc=th;class De extends Jt{constructor(t,e){e=e||{};let r,i,n;typeof t=="string"?(r=De.EMPTY,i=t,n=!0):(r=t,i=null,n=!1),super(r),this.url=i,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await ft.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(i,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ue.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return De._EMPTY=De._EMPTY??ft.ADAPTER.createCanvas(0,0),De._EMPTY}}const Ai=class vs extends Jt{constructor(t,e){e=e||{},super(ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},vs.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Jt.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),i=Math.round(i),n=Math.round(n);const a=this.source;a.width=i,a.height=n,a._pixiId=`canvas_${ir()}`,a.getContext("2d").drawImage(t,0,0,e,r,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(t){const e=vs.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&vs.SVG_XML.test(t)}};Ai.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Ai.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let vc=Ai;class bc extends Jt{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Mi=class tn extends Jt{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const i=t[0].src||t[0];Jt.crossOrigin(r,i,e.crossorigin);for(let n=0;n<t.length;++n){const a=document.createElement("source");let{src:o,mime:h}=t[n];if(o=o||t[n],o.startsWith("data:"))h=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||tn.MIME_TYPES[u]||`video/${u}`}a.src=o,h&&(a.type=h),r.appendChild(a)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=re.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(re.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(re.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(re.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||tn.TYPES.includes(e)}};Mi.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Mi.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let xc=Mi;ui.push(De,wo,gc,xc,bc,vc,oo,yc,mc);class eh{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Et.EMPTY:(t=t||new Et(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:i,c:n,d:a,tx:o,ty:h}=t,l=r*e.x+n*e.y+o,u=i*e.x+a*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,a=t[0],o=t[1];e=a<e?a:e,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=t[2],o=t[3],e=a<e?a:e,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=t[4],o=t[5],e=a<e?a:e,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,a=t[6],o=t[7],e=a<e?a:e,r=o<r?o:r,i=a>i?a:i,n=o>n?o:n,this.minX=e,this.minY=r,this.maxX=i,this.maxY=n}addFrame(t,e,r,i,n){this.addFrameMatrix(t.worldTransform,e,r,i,n)}addFrameMatrix(t,e,r,i,n){const a=t.a,o=t.b,h=t.c,l=t.d,u=t.tx,d=t.ty;let c=this.minX,p=this.minY,v=this.maxX,f=this.maxY,m=a*e+h*r+u,y=o*e+l*r+d;c=m<c?m:c,p=y<p?y:p,v=m>v?m:v,f=y>f?y:f,m=a*i+h*r+u,y=o*i+l*r+d,c=m<c?m:c,p=y<p?y:p,v=m>v?m:v,f=y>f?y:f,m=a*e+h*n+u,y=o*e+l*n+d,c=m<c?m:c,p=y<p?y:p,v=m>v?m:v,f=y>f?y:f,m=a*i+h*n+u,y=o*i+l*n+d,c=m<c?m:c,p=y<p?y:p,v=m>v?m:v,f=y>f?y:f,this.minX=c,this.minY=p,this.maxX=v,this.maxY=f}addVertexData(t,e,r){let i=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];i=l<i?l:i,n=u<n?u:n,a=l>a?l:a,o=u>o?u:o}this.minX=i,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)}addVerticesMatrix(t,e,r,i,n=0,a=n){const o=t.a,h=t.b,l=t.c,u=t.d,d=t.tx,c=t.ty;let p=this.minX,v=this.minY,f=this.maxX,m=this.maxY;for(let y=r;y<i;y+=2){const x=e[y],T=e[y+1],M=o*x+l*T+d,g=u*T+h*x+c;p=Math.min(p,M-n),f=Math.max(f,M+n),v=Math.min(v,g-a),m=Math.max(m,g+a)}this.minX=p,this.minY=v,this.maxX=f,this.maxY=m}addBounds(t){const e=this.minX,r=this.minY,i=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&i<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=i<h?i:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&i<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=i<h?i:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,i,n,a){t-=n,e-=a,r+=n,i+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i}}class ke extends Er{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new pi,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new eh,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const i=e[r];Object.defineProperty(ke.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Et),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds||(this._localBounds=new eh);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const i=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=i,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,i=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new _c),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*lu}set angle(t){this.transform.rotation=t*uu}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class _c extends ke{constructor(){super(...arguments),this.sortDirty=null}}ke.prototype.displayObjectUpdateTransform=ke.prototype.updateTransform;const Ec=new It;function Tc(s,t){return s.zIndex===t.zIndex?s._lastSortedIndex-t._lastSortedIndex:s.zIndex-t.zIndex}const rh=class en extends ke{constructor(){super(),this.children=[],this.sortableChildren=en.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Ir(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,Ir(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Ir(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,i=e,n=i-r;let a;if(n>0&&n<=i){a=this.children.splice(r,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const i=this.children[e];i._lastSortedIndex=e,!t&&i.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(Tc),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let i=0,n=this.children.length;i<n;++i){const a=this.children[i];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,i;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==en.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(i?(i=Ec.copyFrom(i),i.prepend(n)):i=n),r&&e.intersects(r,i))this._render(t);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const i=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Rt.NONE));if(i&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(t)}i&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let i=0;i<r.length;++i)r[i].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};rh.defaultSortableChildren=!1;let ur=rh;ur.prototype.containerUpdateTransform=ur.prototype.updateTransform,Object.defineProperties(ft,{SORTABLE_CHILDREN:{get(){return ur.defaultSortableChildren},set(s){bt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ur.defaultSortableChildren=s}}});const sh=class rn{constructor(t){this.stage=new ur,t=Object.assign({forceCanvas:!1},t),this.renderer=cc(t),rn._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const r=rn._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};sh._plugins=[];let wc=sh;pt.handleByList(ht.Application,wc._plugins);class ih{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:n}=this._resizeTo;e=i,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ih.extension=ht.Application,pt.add(ih);var Ac=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Mc=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`;const nh=class extends ee{constructor(s){super(Ac,Mc),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,nh.defaults,s)}apply(s,t,e,r){const{width:i,height:n}=t.filterFrame;this.uniforms.dimensions[0]=i,this.uniforms.dimensions[1]=n,s.applyFilter(this,t,e,r)}get radius(){return this.uniforms.radius}set radius(s){this.uniforms.radius=s}get strength(){return this.uniforms.strength}set strength(s){this.uniforms.strength=s}get center(){return this.uniforms.center}set center(s){this.uniforms.center=s}};let Sc=nh;Sc.defaults={center:[.5,.5],radius:100,strength:1};var Rc=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ah extends ee{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(fc,Rc,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,i,n]=Ne.shared.setValue(t).toArray(),a=[r,0,0,0,0,0,i,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),i=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=r+(1-r)*a,l=a*(1-r)-o*i,u=a*(1-r)+o*i,d=a*(1-r)+o*i,c=r+a*(1-r),p=a*(1-r)-o*i,v=a*(1-r)-o*i,f=a*(1-r)+o*i,m=r+a*(1-r),y=[h,l,u,0,0,d,c,p,0,0,v,f,m,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,i=-.5*(r-1),n=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=t*2/3+1,i=(r-1)*-.5,n=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456085,-.8545344976951645,-.09155508482755584,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491134,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593523,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964945,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.03770324983778316,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,i,n){t=t||.2,e=e||.15,r=r||16770432,i=i||3375104;const a=Ne.shared,[o,h,l]=a.setValue(r).toArray(),[u,d,c]=a.setValue(i).toArray(),p=[.3,.59,.11,0,0,o,h,l,t,0,u,d,c,e,0,o-u,h-d,l-c,0,0];this._loadMatrix(p,n)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ah.prototype.grayscale=ah.prototype.greyscale;var Ic=Object.defineProperty,Lc=(s,t,e)=>t in s?Ic(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,I=(s,t,e)=>Lc(s,typeof t!="symbol"?t+"":t,e);class Fc{}class Nc extends Fc{constructor(t){super(),I(this,"observer"),I(this,"flowSpeed",4),I(this,"currerntRenderScale",.75),this.canvas=t,this.observer=new ResizeObserver(()=>{const e=Math.max(1,t.clientWidth*window.devicePixelRatio*this.currerntRenderScale),r=Math.max(1,t.clientHeight*window.devicePixelRatio*this.currerntRenderScale);this.onResize(e,r)}),this.observer.observe(t)}setRenderScale(t){this.currerntRenderScale=t,this.onResize(this.canvas.clientWidth*window.devicePixelRatio*this.currerntRenderScale,this.canvas.clientHeight*window.devicePixelRatio*this.currerntRenderScale)}onResize(t,e){this.canvas.width=t,this.canvas.height=e}setFlowSpeed(t){this.flowSpeed=t}dispose(){this.observer.disconnect(),this.canvas.remove()}getElement(){return this.canvas}}const gt=1e-6,oh=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),hh=class Mt extends Float32Array{constructor(...t){switch(t.length){case 16:super(t);break;case 2:super(t[0],t[1],16);break;case 1:const e=t[0];typeof e=="number"?super([e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]):super(e,0,16);break;default:super(oh);break}}get str(){return Mt.str(this)}copy(t){return this.set(t),this}identity(){return this.set(oh),this}multiply(t){return Mt.multiply(this,this,t)}mul(t){return this}transpose(){return Mt.transpose(this,this)}invert(){return Mt.invert(this,this)}translate(t){return Mt.translate(this,this,t)}rotate(t,e){return Mt.rotate(this,this,t,e)}scale(t){return Mt.scale(this,this,t)}rotateX(t){return Mt.rotateX(this,this,t)}rotateY(t){return Mt.rotateY(this,this,t)}rotateZ(t){return Mt.rotateZ(this,this,t)}perspectiveNO(t,e,r,i){return Mt.perspectiveNO(this,t,e,r,i)}perspectiveZO(t,e,r,i){return Mt.perspectiveZO(this,t,e,r,i)}orthoNO(t,e,r,i,n,a){return Mt.orthoNO(this,t,e,r,i,n,a)}orthoZO(t,e,r,i,n,a){return Mt.orthoZO(this,t,e,r,i,n,a)}static create(){return new Mt}static clone(t){return new Mt(t)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static fromValues(...t){return new Mt(...t)}static set(t,...e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static transpose(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}static invert(t,e){const r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],v=e[11],f=e[12],m=e[13],y=e[14],x=e[15],T=r*h-i*o,M=r*l-n*o,g=r*u-a*o,S=i*l-n*h,b=i*u-a*h,B=n*u-a*l,C=d*m-c*f,G=d*y-p*f,D=d*x-v*f,U=c*y-p*m,Y=c*x-v*m,H=p*x-v*y;let V=T*H-M*Y+g*U+S*D-b*G+B*C;return V?(V=1/V,t[0]=(h*H-l*Y+u*U)*V,t[1]=(n*Y-i*H-a*U)*V,t[2]=(m*B-y*b+x*S)*V,t[3]=(p*b-c*B-v*S)*V,t[4]=(l*D-o*H-u*G)*V,t[5]=(r*H-n*D+a*G)*V,t[6]=(y*g-f*B-x*M)*V,t[7]=(d*B-p*g+v*M)*V,t[8]=(o*Y-h*D+u*C)*V,t[9]=(i*D-r*Y-a*C)*V,t[10]=(f*b-m*g+x*T)*V,t[11]=(c*g-d*b-v*T)*V,t[12]=(h*G-o*U-l*C)*V,t[13]=(r*U-i*G+n*C)*V,t[14]=(m*M-f*S-y*T)*V,t[15]=(d*S-c*M+p*T)*V,t):null}static adjoint(t,e){const r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],v=e[11],f=e[12],m=e[13],y=e[14],x=e[15],T=r*h-i*o,M=r*l-n*o,g=r*u-a*o,S=i*l-n*h,b=i*u-a*h,B=n*u-a*l,C=d*m-c*f,G=d*y-p*f,D=d*x-v*f,U=c*y-p*m,Y=c*x-v*m,H=p*x-v*y;return t[0]=h*H-l*Y+u*U,t[1]=n*Y-i*H-a*U,t[2]=m*B-y*b+x*S,t[3]=p*b-c*B-v*S,t[4]=l*D-o*H-u*G,t[5]=r*H-n*D+a*G,t[6]=y*g-f*B-x*M,t[7]=d*B-p*g+v*M,t[8]=o*Y-h*D+u*C,t[9]=i*D-r*Y-a*C,t[10]=f*b-m*g+x*T,t[11]=c*g-d*b-v*T,t[12]=h*G-o*U-l*C,t[13]=r*U-i*G+n*C,t[14]=m*M-f*S-y*T,t[15]=d*S-c*M+p*T,t}static determinant(t){const e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],d=t[9],c=t[10],p=t[11],v=t[12],f=t[13],m=t[14],y=t[15],x=e*o-r*a,T=e*h-i*a,M=r*h-i*o,g=u*f-d*v,S=u*m-c*v,b=d*m-c*f,B=e*b-r*S+i*g,C=a*b-o*S+h*g,G=u*M-d*T+c*x,D=v*M-f*T+m*x;return l*B-n*C+y*G-p*D}static multiply(t,e,r){const i=e[0],n=e[1],a=e[2],o=e[3],h=e[4],l=e[5],u=e[6],d=e[7],c=e[8],p=e[9],v=e[10],f=e[11],m=e[12],y=e[13],x=e[14],T=e[15];let M=r[0],g=r[1],S=r[2],b=r[3];return t[0]=M*i+g*h+S*c+b*m,t[1]=M*n+g*l+S*p+b*y,t[2]=M*a+g*u+S*v+b*x,t[3]=M*o+g*d+S*f+b*T,M=r[4],g=r[5],S=r[6],b=r[7],t[4]=M*i+g*h+S*c+b*m,t[5]=M*n+g*l+S*p+b*y,t[6]=M*a+g*u+S*v+b*x,t[7]=M*o+g*d+S*f+b*T,M=r[8],g=r[9],S=r[10],b=r[11],t[8]=M*i+g*h+S*c+b*m,t[9]=M*n+g*l+S*p+b*y,t[10]=M*a+g*u+S*v+b*x,t[11]=M*o+g*d+S*f+b*T,M=r[12],g=r[13],S=r[14],b=r[15],t[12]=M*i+g*h+S*c+b*m,t[13]=M*n+g*l+S*p+b*y,t[14]=M*a+g*u+S*v+b*x,t[15]=M*o+g*d+S*f+b*T,t}static mul(t,e,r){return t}static translate(t,e,r){const i=r[0],n=r[1],a=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*a+e[12],t[13]=e[1]*i+e[5]*n+e[9]*a+e[13],t[14]=e[2]*i+e[6]*n+e[10]*a+e[14],t[15]=e[3]*i+e[7]*n+e[11]*a+e[15];else{const o=e[0],h=e[1],l=e[2],u=e[3],d=e[4],c=e[5],p=e[6],v=e[7],f=e[8],m=e[9],y=e[10],x=e[11];t[0]=o,t[1]=h,t[2]=l,t[3]=u,t[4]=d,t[5]=c,t[6]=p,t[7]=v,t[8]=f,t[9]=m,t[10]=y,t[11]=x,t[12]=o*i+d*n+f*a+e[12],t[13]=h*i+c*n+m*a+e[13],t[14]=l*i+p*n+y*a+e[14],t[15]=u*i+v*n+x*a+e[15]}return t}static scale(t,e,r){const i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static rotate(t,e,r,i){let n=i[0],a=i[1],o=i[2],h=Math.sqrt(n*n+a*a+o*o);if(h<gt)return null;h=1/h,n*=h,a*=h,o*=h;const l=Math.sin(r),u=Math.cos(r),d=1-u,c=e[0],p=e[1],v=e[2],f=e[3],m=e[4],y=e[5],x=e[6],T=e[7],M=e[8],g=e[9],S=e[10],b=e[11],B=n*n*d+u,C=a*n*d+o*l,G=o*n*d-a*l,D=n*a*d-o*l,U=a*a*d+u,Y=o*a*d+n*l,H=n*o*d+a*l,V=a*o*d-n*l,E=o*o*d+u;return t[0]=c*B+m*C+M*G,t[1]=p*B+y*C+g*G,t[2]=v*B+x*C+S*G,t[3]=f*B+T*C+b*G,t[4]=c*D+m*U+M*Y,t[5]=p*D+y*U+g*Y,t[6]=v*D+x*U+S*Y,t[7]=f*D+T*U+b*Y,t[8]=c*H+m*V+M*E,t[9]=p*H+y*V+g*E,t[10]=v*H+x*V+S*E,t[11]=f*H+T*V+b*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t}static rotateX(t,e,r){let i=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],d=e[9],c=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+u*i,t[5]=o*n+d*i,t[6]=h*n+c*i,t[7]=l*n+p*i,t[8]=u*n-a*i,t[9]=d*n-o*i,t[10]=c*n-h*i,t[11]=p*n-l*i,t}static rotateY(t,e,r){let i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[8],d=e[9],c=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-u*i,t[1]=o*n-d*i,t[2]=h*n-c*i,t[3]=l*n-p*i,t[8]=a*i+u*n,t[9]=o*i+d*n,t[10]=h*i+c*n,t[11]=l*i+p*n,t}static rotateZ(t,e,r){let i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[4],d=e[5],c=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+u*i,t[1]=o*n+d*i,t[2]=h*n+c*i,t[3]=l*n+p*i,t[4]=u*n-a*i,t[5]=d*n-o*i,t[6]=c*n-h*i,t[7]=p*n-l*i,t}static fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}static fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotation(t,e,r){let i=r[0],n=r[1],a=r[2],o=Math.sqrt(i*i+n*n+a*a);if(o<gt)return null;o=1/o,i*=o,n*=o,a*=o;const h=Math.sin(e),l=Math.cos(e),u=1-l;return t[0]=i*i*u+l,t[1]=n*i*u+a*h,t[2]=a*i*u-n*h,t[3]=0,t[4]=i*n*u-a*h,t[5]=n*n*u+l,t[6]=a*n*u+i*h,t[7]=0,t[8]=i*a*u+n*h,t[9]=n*a*u-i*h,t[10]=a*a*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromXRotation(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromYRotation(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromZRotation(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotationTranslation(t,e,r){const i=e[0],n=e[1],a=e[2],o=e[3],h=i+i,l=n+n,u=a+a,d=i*h,c=i*l,p=i*u,v=n*l,f=n*u,m=a*u,y=o*h,x=o*l,T=o*u;return t[0]=1-(v+m),t[1]=c+T,t[2]=p-x,t[3]=0,t[4]=c-T,t[5]=1-(d+m),t[6]=f+y,t[7]=0,t[8]=p+x,t[9]=f-y,t[10]=1-(d+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromQuat2(t,e){const r=-e[0],i=-e[1],n=-e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7];let d=r*r+i*i+n*n+a*a;return d>0?(jt[0]=(o*a+u*r+h*n-l*i)*2/d,jt[1]=(h*a+u*i+l*r-o*n)*2/d,jt[2]=(l*a+u*n+o*i-h*r)*2/d):(jt[0]=(o*a+u*r+h*n-l*i)*2,jt[1]=(h*a+u*i+l*r-o*n)*2,jt[2]=(l*a+u*n+o*i-h*r)*2),Mt.fromRotationTranslation(t,e,jt),t}static normalFromMat4(t,e){const r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],v=e[11],f=e[12],m=e[13],y=e[14],x=e[15],T=r*h-i*o,M=r*l-n*o,g=r*u-a*o,S=i*l-n*h,b=i*u-a*h,B=n*u-a*l,C=d*m-c*f,G=d*y-p*f,D=d*x-v*f,U=c*y-p*m,Y=c*x-v*m,H=p*x-v*y;let V=T*H-M*Y+g*U+S*D-b*G+B*C;return V?(V=1/V,t[0]=(h*H-l*Y+u*U)*V,t[1]=(l*D-o*H-u*G)*V,t[2]=(o*Y-h*D+u*C)*V,t[3]=0,t[4]=(n*Y-i*H-a*U)*V,t[5]=(r*H-n*D+a*G)*V,t[6]=(i*D-r*Y-a*C)*V,t[7]=0,t[8]=(m*B-y*b+x*S)*V,t[9]=(y*g-f*B-x*M)*V,t[10]=(f*b-m*g+x*T)*V,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):null}static normalFromMat4Fast(t,e){const r=e[0],i=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],d=e[10];return t[0]=o*d-d*u,t[1]=h*l-l*d,t[2]=a*u-u*l,t[3]=0,t[4]=u*n-d*i,t[5]=d*r-l*n,t[6]=l*i-u*r,t[7]=0,t[8]=i*h-n*o,t[9]=n*a-r*h,t[10]=r*o-i*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static getTranslation(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}static getScaling(t,e){const r=e[0],i=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],d=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(a*a+o*o+h*h),t[2]=Math.sqrt(l*l+u*u+d*d),t}static getRotation(t,e){Mt.getScaling(jt,e);const r=1/jt[0],i=1/jt[1],n=1/jt[2],a=e[0]*r,o=e[1]*i,h=e[2]*n,l=e[4]*r,u=e[5]*i,d=e[6]*n,c=e[8]*r,p=e[9]*i,v=e[10]*n,f=a+u+v;let m=0;return f>0?(m=Math.sqrt(f+1)*2,t[3]=.25*m,t[0]=(d-p)/m,t[1]=(c-h)/m,t[2]=(o-l)/m):a>u&&a>v?(m=Math.sqrt(1+a-u-v)*2,t[3]=(d-p)/m,t[0]=.25*m,t[1]=(o+l)/m,t[2]=(c+h)/m):u>v?(m=Math.sqrt(1+u-a-v)*2,t[3]=(c-h)/m,t[0]=(o+l)/m,t[1]=.25*m,t[2]=(d+p)/m):(m=Math.sqrt(1+v-a-u)*2,t[3]=(o-l)/m,t[0]=(c+h)/m,t[1]=(d+p)/m,t[2]=.25*m),t}static decompose(t,e,r,i){e[0]=i[12],e[1]=i[13],e[2]=i[14];const n=i[0],a=i[1],o=i[2],h=i[4],l=i[5],u=i[6],d=i[8],c=i[9],p=i[10];r[0]=Math.sqrt(n*n+a*a+o*o),r[1]=Math.sqrt(h*h+l*l+u*u),r[2]=Math.sqrt(d*d+c*c+p*p);const v=1/r[0],f=1/r[1],m=1/r[2],y=n*v,x=a*f,T=o*m,M=h*v,g=l*f,S=u*m,b=d*v,B=c*f,C=p*m,G=y+g+C;let D=0;return G>0?(D=Math.sqrt(G+1)*2,t[3]=.25*D,t[0]=(S-B)/D,t[1]=(b-T)/D,t[2]=(x-M)/D):y>g&&y>C?(D=Math.sqrt(1+y-g-C)*2,t[3]=(S-B)/D,t[0]=.25*D,t[1]=(x+M)/D,t[2]=(b+T)/D):g>C?(D=Math.sqrt(1+g-y-C)*2,t[3]=(b-T)/D,t[0]=(x+M)/D,t[1]=.25*D,t[2]=(S+B)/D):(D=Math.sqrt(1+C-y-g)*2,t[3]=(x-M)/D,t[0]=(b+T)/D,t[1]=(S+B)/D,t[2]=.25*D),t}static fromRotationTranslationScale(t,e,r,i){const n=e[0],a=e[1],o=e[2],h=e[3],l=n+n,u=a+a,d=o+o,c=n*l,p=n*u,v=n*d,f=a*u,m=a*d,y=o*d,x=h*l,T=h*u,M=h*d,g=i[0],S=i[1],b=i[2];return t[0]=(1-(f+y))*g,t[1]=(p+M)*g,t[2]=(v-T)*g,t[3]=0,t[4]=(p-M)*S,t[5]=(1-(c+y))*S,t[6]=(m+x)*S,t[7]=0,t[8]=(v+T)*b,t[9]=(m-x)*b,t[10]=(1-(c+f))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromRotationTranslationScaleOrigin(t,e,r,i,n){const a=e[0],o=e[1],h=e[2],l=e[3],u=a+a,d=o+o,c=h+h,p=a*u,v=a*d,f=a*c,m=o*d,y=o*c,x=h*c,T=l*u,M=l*d,g=l*c,S=i[0],b=i[1],B=i[2],C=n[0],G=n[1],D=n[2],U=(1-(m+x))*S,Y=(v+g)*S,H=(f-M)*S,V=(v-g)*b,E=(1-(p+x))*b,w=(y+T)*b,_=(f+M)*B,O=(y-T)*B,A=(1-(p+m))*B;return t[0]=U,t[1]=Y,t[2]=H,t[3]=0,t[4]=V,t[5]=E,t[6]=w,t[7]=0,t[8]=_,t[9]=O,t[10]=A,t[11]=0,t[12]=r[0]+C-(U*C+V*G+_*D),t[13]=r[1]+G-(Y*C+E*G+O*D),t[14]=r[2]+D-(H*C+w*G+A*D),t[15]=1,t}static fromQuat(t,e){const r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,h=i+i,l=n+n,u=r*o,d=i*o,c=i*h,p=n*o,v=n*h,f=n*l,m=a*o,y=a*h,x=a*l;return t[0]=1-c-f,t[1]=d+x,t[2]=p-y,t[3]=0,t[4]=d-x,t[5]=1-u-f,t[6]=v+m,t[7]=0,t[8]=p+y,t[9]=v-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static frustumNO(t,e,r,i,n,a,o=1/0){const h=1/(r-e),l=1/(n-i);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=(o+a)*u,t[14]=2*o*a*u}else t[10]=-1,t[14]=-2*a;return t}static frustum(t,e,r,i,n,a,o=1/0){return t}static frustumZO(t,e,r,i,n,a,o=1/0){const h=1/(r-e),l=1/(n-i);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=o*u,t[14]=o*a*u}else t[10]=-1,t[14]=-a;return t}static perspectiveNO(t,e,r,i,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(i-n);t[10]=(n+i)*o,t[14]=2*n*i*o}else t[10]=-1,t[14]=-2*i;return t}static perspective(t,e,r,i,n=1/0){return t}static perspectiveZO(t,e,r,i,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(i-n);t[10]=n*o,t[14]=n*i*o}else t[10]=-1,t[14]=-i;return t}static perspectiveFromFieldOfView(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+h),u=2/(n+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-h)*l*.5),t[9]=(n-a)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}static orthoNO(t,e,r,i,n,a,o){const h=1/(e-r),l=1/(i-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+i)*l,t[14]=(o+a)*u,t[15]=1,t}static ortho(t,e,r,i,n,a,o){return t}static orthoZO(t,e,r,i,n,a,o){const h=1/(e-r),l=1/(i-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+i)*l,t[14]=a*u,t[15]=1,t}static lookAt(t,e,r,i){const n=e[0],a=e[1],o=e[2],h=i[0],l=i[1],u=i[2],d=r[0],c=r[1],p=r[2];if(Math.abs(n-d)<gt&&Math.abs(a-c)<gt&&Math.abs(o-p)<gt)return Mt.identity(t);let v=n-d,f=a-c,m=o-p,y=1/Math.sqrt(v*v+f*f+m*m);v*=y,f*=y,m*=y;let x=l*m-u*f,T=u*v-h*m,M=h*f-l*v;y=Math.sqrt(x*x+T*T+M*M),y?(y=1/y,x*=y,T*=y,M*=y):(x=0,T=0,M=0);let g=f*M-m*T,S=m*x-v*M,b=v*T-f*x;return y=Math.sqrt(g*g+S*S+b*b),y?(y=1/y,g*=y,S*=y,b*=y):(g=0,S=0,b=0),t[0]=x,t[1]=g,t[2]=v,t[3]=0,t[4]=T,t[5]=S,t[6]=f,t[7]=0,t[8]=M,t[9]=b,t[10]=m,t[11]=0,t[12]=-(x*n+T*a+M*o),t[13]=-(g*n+S*a+b*o),t[14]=-(v*n+f*a+m*o),t[15]=1,t}static targetTo(t,e,r,i){const n=e[0],a=e[1],o=e[2],h=i[0],l=i[1],u=i[2];let d=n-r[0],c=a-r[1],p=o-r[2],v=d*d+c*c+p*p;v>0&&(v=1/Math.sqrt(v),d*=v,c*=v,p*=v);let f=l*p-u*c,m=u*d-h*p,y=h*c-l*d;return v=f*f+m*m+y*y,v>0&&(v=1/Math.sqrt(v),f*=v,m*=v,y*=v),t[0]=f,t[1]=m,t[2]=y,t[3]=0,t[4]=c*y-p*m,t[5]=p*f-d*y,t[6]=d*m-c*f,t[7]=0,t[8]=d,t[9]=c,t[10]=p,t[11]=0,t[12]=n,t[13]=a,t[14]=o,t[15]=1,t}static frob(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}static sub(t,e,r){return t}static multiplyScalar(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}static multiplyScalarAndAdd(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}static equals(t,e){const r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],d=t[8],c=t[9],p=t[10],v=t[11],f=t[12],m=t[13],y=t[14],x=t[15],T=e[0],M=e[1],g=e[2],S=e[3],b=e[4],B=e[5],C=e[6],G=e[7],D=e[8],U=e[9],Y=e[10],H=e[11],V=e[12],E=e[13],w=e[14],_=e[15];return Math.abs(r-T)<=gt*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(i-M)<=gt*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(n-g)<=gt*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-S)<=gt*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-b)<=gt*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(h-B)<=gt*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(l-C)<=gt*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(u-G)<=gt*Math.max(1,Math.abs(u),Math.abs(G))&&Math.abs(d-D)<=gt*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(c-U)<=gt*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(p-Y)<=gt*Math.max(1,Math.abs(p),Math.abs(Y))&&Math.abs(v-H)<=gt*Math.max(1,Math.abs(v),Math.abs(H))&&Math.abs(f-V)<=gt*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-E)<=gt*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(y-w)<=gt*Math.max(1,Math.abs(y),Math.abs(w))&&Math.abs(x-_)<=gt*Math.max(1,Math.abs(x),Math.abs(_))}static str(t){return`Mat4(${t.join(", ")})`}};I(hh,"BYTE_LENGTH",16*Float32Array.BYTES_PER_ELEMENT);let lt=hh;const jt=new Float32Array(3);lt.prototype.mul=lt.prototype.multiply,lt.sub=lt.subtract,lt.mul=lt.multiply,lt.frustum=lt.frustumNO,lt.perspective=lt.perspectiveNO,lt.ortho=lt.orthoNO;const lh=class qt extends Float32Array{constructor(...t){switch(t.length){case 3:super(t);break;case 2:super(t[0],t[1],3);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e]):super(e,0,3);break}default:super(3);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get magnitude(){const t=this[0],e=this[1],r=this[2];return Math.sqrt(t*t+e*e+r*r)}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1],r=this[2];return t*t+e*e+r*r}get sqrMag(){return this.squaredMagnitude}get str(){return qt.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this}distance(t){return qt.distance(this,t)}dist(t){return 0}squaredDistance(t){return qt.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}normalize(){return qt.normalize(this,this)}static create(){return new qt}static clone(t){return new qt(t)}static magnitude(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static fromValues(t,e,r){return new qt(t,e,r)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}static set(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}static sub(t,e,r){return[0,0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}static mul(t,e,r){return[0,0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}static div(t,e,r){return[0,0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}static scaleAndAdd(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}static distance(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}static sqrDist(t,e){return 0}static squaredLength(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}static normalize(t,e){const r=e[0],i=e[1],n=e[2];let a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static cross(t,e,r){const i=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2];return t[0]=n*l-a*h,t[1]=a*o-i*l,t[2]=i*h-n*o,t}static lerp(t,e,r,i){const n=e[0],a=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t}static slerp(t,e,r,i){const n=Math.acos(Math.min(Math.max(qt.dot(e,r),-1),1)),a=Math.sin(n),o=Math.sin((1-i)*n)/a,h=Math.sin(i*n)/a;return t[0]=o*e[0]+h*r[0],t[1]=o*e[1]+h*r[1],t[2]=o*e[2]+h*r[2],t}static hermite(t,e,r,i,n,a){const o=a*a,h=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),d=o*(3-2*a);return t[0]=e[0]*h+r[0]*l+i[0]*u+n[0]*d,t[1]=e[1]*h+r[1]*l+i[1]*u+n[1]*d,t[2]=e[2]*h+r[2]*l+i[2]*u+n[2]*d,t}static bezier(t,e,r,i,n,a){const o=1-a,h=o*o,l=a*a,u=h*o,d=3*a*h,c=3*l*o,p=l*a;return t[0]=e[0]*u+r[0]*d+i[0]*c+n[0]*p,t[1]=e[1]*u+r[1]*d+i[1]*c+n[1]*p,t[2]=e[2]*u+r[2]*d+i[2]*c+n[2]*p,t}static transformMat4(t,e,r){const i=e[0],n=e[1],a=e[2],o=r[3]*i+r[7]*n+r[11]*a+r[15]||1;return t[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,t}static transformMat3(t,e,r){let i=e[0],n=e[1],a=e[2];return t[0]=i*r[0]+n*r[3]+a*r[6],t[1]=i*r[1]+n*r[4]+a*r[7],t[2]=i*r[2]+n*r[5]+a*r[8],t}static transformQuat(t,e,r){const i=r[0],n=r[1],a=r[2],o=r[3]*2,h=e[0],l=e[1],u=e[2],d=n*u-a*l,c=a*h-i*u,p=i*l-n*h,v=(n*p-a*c)*2,f=(a*d-i*p)*2,m=(i*c-n*d)*2;return t[0]=h+d*o+v,t[1]=l+c*o+f,t[2]=u+p*o+m,t}static rotateX(t,e,r,i){const n=r[1],a=r[2],o=e[1]-n,h=e[2]-a;return t[0]=e[0],t[1]=o*Math.cos(i)-h*Math.sin(i)+n,t[2]=o*Math.sin(i)+h*Math.cos(i)+a,t}static rotateY(t,e,r,i){const n=r[0],a=r[2],o=e[0]-n,h=e[2]-a;return t[0]=h*Math.sin(i)+o*Math.cos(i)+n,t[1]=e[1],t[2]=h*Math.cos(i)-o*Math.sin(i)+a,t}static rotateZ(t,e,r,i){const n=r[0],a=r[1],o=e[0]-n,h=e[1]-a;return t[0]=o*Math.cos(i)-h*Math.sin(i)+n,t[1]=o*Math.sin(i)+h*Math.cos(i)+a,t[2]=r[2],t}static angle(t,e){const r=t[0],i=t[1],n=t[2],a=e[0],o=e[1],h=e[2],l=Math.sqrt((r*r+i*i+n*n)*(a*a+o*o+h*h)),u=l&&qt.dot(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t}static str(t){return`Vec3(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}static equals(t,e){const r=t[0],i=t[1],n=t[2],a=e[0],o=e[1],h=e[2];return Math.abs(r-a)<=gt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=gt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=gt*Math.max(1,Math.abs(n),Math.abs(h))}};I(lh,"BYTE_LENGTH",3*Float32Array.BYTES_PER_ELEMENT);let yt=lh;yt.prototype.sub=yt.prototype.subtract,yt.prototype.mul=yt.prototype.multiply,yt.prototype.div=yt.prototype.divide,yt.prototype.dist=yt.prototype.distance,yt.prototype.sqrDist=yt.prototype.squaredDistance,yt.sub=yt.subtract,yt.mul=yt.multiply,yt.div=yt.divide,yt.dist=yt.distance,yt.sqrDist=yt.squaredDistance,yt.sqrLen=yt.squaredLength,yt.mag=yt.magnitude,yt.length=yt.magnitude,yt.len=yt.magnitude;const uh=class ae extends Float32Array{constructor(...t){switch(t.length){case 4:super(t);break;case 2:super(t[0],t[1],4);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e,e]):super(e,0,4);break}default:super(4);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}get magnitude(){const t=this[0],e=this[1],r=this[2],i=this[3];return Math.sqrt(t*t+e*e+r*r+i*i)}get mag(){return this.magnitude}get str(){return ae.str(this)}copy(t){return super.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this[3]*=t[3],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this[3]/=t[3],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this[3]+=t[3]*e,this}distance(t){return ae.distance(this,t)}dist(t){return 0}squaredDistance(t){return ae.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this[3]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this[3]=Math.abs(this[3]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}normalize(){return ae.normalize(this,this)}static create(){return new ae}static clone(t){return new ae(t)}static fromValues(t,e,r,i){return new ae(t,e,r,i)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}static set(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}static sub(t,e,r){return t}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}static mul(t,e,r){return t}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}static div(t,e,r){return t}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}static scaleAndAdd(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}static distance(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,i,n,a)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return r*r+i*i+n*n+a*a}static sqrDist(t,e){return 0}static magnitude(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}static sqrLen(t){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t}static normalize(t,e){const r=e[0],i=e[1],n=e[2],a=e[3];let o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=a*o,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}static cross(t,e,r,i){const n=r[0]*i[1]-r[1]*i[0],a=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],h=r[1]*i[2]-r[2]*i[1],l=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],d=e[0],c=e[1],p=e[2],v=e[3];return t[0]=c*u-p*l+v*h,t[1]=-(d*u)+p*o-v*a,t[2]=d*l-c*o+v*n,t[3]=-(d*h)+c*a-p*n,t}static lerp(t,e,r,i){const n=e[0],a=e[1],o=e[2],h=e[3];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t[3]=h+i*(r[3]-h),t}static transformMat4(t,e,r){const i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,t}static transformQuat(t,e,r){const i=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2],u=r[3],d=u*i+h*a-l*n,c=u*n+l*i-o*a,p=u*a+o*n-h*i,v=-o*i-h*n-l*a;return t[0]=d*u+v*-o+c*-l-p*-h,t[1]=c*u+v*-h+p*-o-d*-l,t[2]=p*u+v*-l+d*-h-c*-o,t[3]=e[3],t}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}static str(t){return`Vec4(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}static equals(t,e){const r=t[0],i=t[1],n=t[2],a=t[3],o=e[0],h=e[1],l=e[2],u=e[3];return Math.abs(r-o)<=gt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-h)<=gt*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-l)<=gt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=gt*Math.max(1,Math.abs(a),Math.abs(u))}};I(uh,"BYTE_LENGTH",4*Float32Array.BYTES_PER_ELEMENT);let nt=uh;nt.prototype.sub=nt.prototype.subtract,nt.prototype.mul=nt.prototype.multiply,nt.prototype.div=nt.prototype.divide,nt.prototype.dist=nt.prototype.distance,nt.prototype.sqrDist=nt.prototype.squaredDistance,nt.sub=nt.subtract,nt.mul=nt.multiply,nt.div=nt.divide,nt.dist=nt.distance,nt.sqrDist=nt.squaredDistance,nt.sqrLen=nt.squaredLength,nt.mag=nt.magnitude,nt.length=nt.magnitude,nt.len=nt.magnitude;const ch=class oe extends Float32Array{constructor(...t){switch(t.length){case 2:{const e=t[0];typeof e=="number"?super([e,t[1]]):super(e,t[1],2);break}case 1:{const e=t[0];typeof e=="number"?super([e,e]):super(e,0,2);break}default:super(2);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get magnitude(){return Math.hypot(this[0],this[1])}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1];return t*t+e*e}get sqrMag(){return this.squaredMagnitude}get str(){return oe.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this}distance(t){return oe.distance(this,t)}dist(t){return 0}squaredDistance(t){return oe.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this}dot(t){return this[0]*t[0]+this[1]*t[1]}normalize(){return oe.normalize(this,this)}static create(){return new oe}static clone(t){return new oe(t)}static fromValues(t,e){return new oe(t,e)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t}static set(t,e,r){return t[0]=e,t[1]=r,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}static sub(t,e,r){return[0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}static mul(t,e,r){return[0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}static div(t,e,r){return[0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}static scaleAndAdd(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}static distance(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}static sqrDist(t,e){return 0}static magnitude(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1];return e*e+r*r}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t}static normalize(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]}static cross(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}static lerp(t,e,r,i){const n=e[0],a=e[1];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t}static transformMat2(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}static transformMat2d(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}static transformMat3(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}static transformMat4(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}static rotate(t,e,r,i){const n=e[0]-r[0],a=e[1]-r[1],o=Math.sin(i),h=Math.cos(i);return t[0]=n*h-a*o+r[0],t[1]=n*o+a*h+r[1],t}static angle(t,e){const r=t[0],i=t[1],n=e[0],a=e[1],o=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+a*a),h=o&&(r*n+i*a)/o;return Math.acos(Math.min(Math.max(h,-1),1))}static zero(t){return t[0]=0,t[1]=0,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]}static equals(t,e){const r=t[0],i=t[1],n=e[0],a=e[1];return Math.abs(r-n)<=gt*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=gt*Math.max(1,Math.abs(i),Math.abs(a))}static str(t){return`Vec2(${t.join(", ")})`}};I(ch,"BYTE_LENGTH",2*Float32Array.BYTES_PER_ELEMENT);let ut=ch;ut.prototype.sub=ut.prototype.subtract,ut.prototype.mul=ut.prototype.multiply,ut.prototype.div=ut.prototype.divide,ut.prototype.dist=ut.prototype.distance,ut.prototype.sqrDist=ut.prototype.squaredDistance,ut.sub=ut.subtract,ut.mul=ut.multiply,ut.div=ut.divide,ut.dist=ut.distance,ut.sqrDist=ut.squaredDistance,ut.sqrLen=ut.squaredLength,ut.mag=ut.magnitude,ut.length=ut.magnitude,ut.len=ut.magnitude;function Oc(s){return new Promise((t,e)=>{const r=document.createElement("img");r.onload=()=>t(r),r.onerror=e,r.src=s,r.crossOrigin="anonymous",r.loading="eager"})}function Pc(s){return new Promise((t,e)=>{const r=document.createElement("video");let i=!1,n=!1,a=!1;r.addEventListener("playing",()=>{i=!0,o()},!0),r.addEventListener("timeupdate",()=>{n=!0,o()},!0),r.addEventListener("error",h=>{a=!0,e(h)},!0);function o(){i&&n&&!a&&t(r)}r.src=s,r.playsInline=!0,r.crossOrigin="anonymous",r.autoplay=!0,r.loop=!0,r.muted=!0,r.play()})}function Cc(s,t=!1){return t?Pc(s):Oc(s)}function Dc(s){return new Promise((t,e)=>{(s instanceof HTMLImageElement?s.complete:s.readyState>=3)?t(s):(s.onload=()=>t(s),s.onerror=e)})}function kc(s,t,e){const r=s.data,i=s.width,n=s.height;let a,o,h,l,u,d,c,p,v,f,m,y,x;const T=i-1,M=n-1,g=t+1,S=t+g,b=t+1,B=t+b,C=1/(S*B),G=[],D=[],U=[],Y=[],H=[],V=[];for(;e-- >0;){for(x=y=0,d=0;d<n;d++){for(a=r[x]*g,o=r[x+1]*g,h=r[x+2]*g,l=r[x+3]*g,c=1;c<=t;c++)p=x+((c>T?T:c)<<2),a+=r[p++],o+=r[p++],h+=r[p++],l+=r[p];for(u=0;u<i;u++)G[y]=a,D[y]=o,U[y]=h,Y[y]=l,d===0&&(H[u]=Math.min(u+g,T)<<2,V[u]=Math.max(u-t,0)<<2),v=x+H[u],f=x+V[u],a+=r[v++]-r[f++],o+=r[v++]-r[f++],h+=r[v++]-r[f++],l+=r[v]-r[f],y++;x+=i<<2}for(u=0;u<i;u++){for(m=u,a=G[m]*b,o=D[m]*b,h=U[m]*b,l=Y[m]*b,c=1;c<=t;c++)m+=c>M?0:i,a+=G[m],o+=D[m],h+=U[m],l+=Y[m];for(y=u<<2,d=0;d<n;d++)r[y]=a*C+.5|0,r[y+1]=o*C+.5|0,r[y+2]=h*C+.5|0,r[y+3]=l*C+.5|0,u===0&&(H[d]=Math.min(d+b,M)*i,V[d]=Math.max(d-t,0)*i),v=u+H[d],f=u+V[d],a+=G[v]-G[f],o+=D[v]-D[f],h+=U[v]-U[f],l+=Y[v]-Y[f],y+=i<<2}}}function Bc(s,t){const e=s.data;for(let r=0;r<e.length;r+=4){const i=e[r],n=e[r+1],a=e[r+2],o=e[r+3],h=i*.3+n*.59+a*.11;e[r]=h*(1-t)+i*t,e[r+1]=h*(1-t)+n*t,e[r+2]=h*(1-t)+a*t,e[r+3]=o}}function Uc(s,t){const e=s.data;for(let r=0;r<e.length;r+=4){const i=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=i*t,e[r+1]=n*t,e[r+2]=a*t,e[r+3]=o}}function dh(s,t){const e=s.data;for(let r=0;r<e.length;r+=4){const i=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=(i-128)*t+128,e[r+1]=(n-128)*t+128,e[r+2]=(a-128)*t+128,e[r+3]=o}}const P=(s,t,e,r,i=0,n=0,a=1,o=1)=>Object.freeze({cx:s,cy:t,x:e,y:r,ur:i,vr:n,up:a,vp:o}),Be=(s,t,e)=>Object.freeze({width:s,height:t,conf:e}),fh=[Be(5,5,[P(0,0,-1,-1,0,0,1,1),P(1,0,-.5,-1,0,0,1,1),P(2,0,0,-1,0,0,1,1),P(3,0,.5,-1,0,0,1,1),P(4,0,1,-1,0,0,1,1),P(0,1,-1,-.5,0,0,1,1),P(1,1,-.5,-.5,0,0,1,1),P(2,1,-.0052029684413368305,-.6131420587090777,0,0,1,1),P(3,1,.5884227308309977,-.3990805107556692,0,0,1,1),P(4,1,1,-.5,0,0,1,1),P(0,2,-1,0,0,0,1,1),P(1,2,-.4210024670505933,-.11895058380429502,0,0,1,1),P(2,2,-.1019613423315412,-.023812118047224606,0,-47,.629,.849),P(3,2,.4027512566092544,-.06345314544600389,0,0,1,1),P(4,2,1,0,0,0,1,1),P(0,3,-1,.5,0,0,1,1),P(1,3,.06801958477287173,.5205913248960121,-31,-45,1,1),P(2,3,.21446469120128908,.29331610114301043,6,-56,.566,1.321),P(3,3,.5,.5,0,0,1,1),P(4,3,1,.5,0,0,1,1),P(0,4,-1,1,0,0,1,1),P(1,4,-.31378372841550195,1,0,0,1,1),P(2,4,.26153633255328046,1,0,0,1,1),P(3,4,.5,1,0,0,1,1),P(4,4,1,1,0,0,1,1)]),Be(6,6,[P(0,0,-1,-1,0,0,1,1),P(1,0,-.6,-1,0,0,1,1),P(2,0,-.19999999999999996,-1,0,0,1,1),P(3,0,.19999999999999996,-1,0,0,1,1),P(4,0,.6000000000000001,-1,0,0,1,1),P(5,0,1,-1,0,0,1,1),P(0,1,-1,-.6,0,0,1,1),P(1,1,-.6,-.6,0,0,1,1),P(2,1,-.10980661589020636,-.4108069757237176,0,0,1,1),P(3,1,.3739852535608153,-.437252891735175,0,0,1,1),P(4,1,.6000000000000001,-.6,0,0,1,1),P(5,1,1,-.6,0,0,1,1),P(0,2,-1,-.19999999999999996,0,0,1,1),P(1,2,-.5125306585683541,-.1780829148228924,0,0,1,1),P(2,2,-.19999999999999996,-.19999999999999996,0,0,1,1),P(3,2,.19999999999999996,-.19999999999999996,0,0,1,1),P(4,2,.6485698281140977,-.1939504644297667,0,0,1,1),P(5,2,1,-.19999999999999996,0,0,1,1),P(0,3,-1,.19999999999999996,0,0,1,1),P(1,3,-.7321983182109801,.23447337495584344,0,0,1,1),P(2,3,-.4654590172163629,.4619082526543773,0,0,1,1),P(3,3,-.12549716300753677,.4275285618394826,-65,-36,1.195,2.296),P(4,3,.3582947064434847,-.04320874316445944,0,0,1,1),P(5,3,1,.19999999999999996,0,0,1,1),P(0,4,-1,.6000000000000001,0,0,1,1),P(1,4,-.742658682955867,.6549634395380164,0,0,1,1),P(2,4,-.3843911904434889,.7475241455781174,0,0,.535,.66),P(3,4,.07847994951775883,.7263674127689514,0,0,1,1),P(4,4,.6000000000000001,.6000000000000001,0,0,1,1),P(5,4,1,.6000000000000001,0,0,1,1),P(0,5,-1,1,0,0,1,1),P(1,5,-.6,1,0,0,1,1),P(2,5,-.19999999999999996,1,0,0,1,1),P(3,5,.19999999999999996,1,0,0,1,1),P(4,5,.6000000000000001,1,0,0,1,1),P(5,5,1,1,0,0,1,1)]),Be(4,4,[P(0,0,-1,-1,0,0,1,1),P(1,0,-.33333333333333337,-1,0,0,1,1),P(2,0,.33333333333333326,-1,0,0,1,1),P(3,0,1,-1,0,0,1,1),P(0,1,-1,-.04495399932657351,0,0,1,1),P(1,1,-.24056117520129328,-.22465999020104,0,0,1,1),P(2,1,.334758885767489,-.00531297192779423,0,0,1,1),P(3,1,.9989920470678106,-.3382976020775408,8,0,.566,1.792),P(0,2,-1,.33333333333333326,0,0,1,1),P(1,2,-.3425497314639411,-27501607956947893e-21,0,0,1,1),P(2,2,.3321437945812673,.1981776353859399,0,0,1,1),P(3,2,1,.0766118180296832,0,0,1,1),P(0,3,-1,1,0,0,1,1),P(1,3,-.33333333333333337,1,0,0,1,1),P(2,3,.33333333333333326,1,0,0,1,1),P(3,3,1,1,0,0,1,1)]),Be(4,4,[P(0,0,-1,-1,0,0,1,2.075),P(1,0,-.33333333333333337,-1,0,0,1,1),P(2,0,.33333333333333326,-1,0,0,1,1),P(3,0,1,-1,0,0,1,1),P(0,1,-1,-.4545779491139603,0,0,1,1),P(1,1,-.33333333333333337,-.33333333333333337,0,0,1,1),P(2,1,.0889403142626457,-.6025711180694033,-32,45,1,1),P(3,1,1,-.33333333333333337,0,0,1,1),P(0,2,-1,-.07402408608567845,1,0,1,.094),P(1,2,-.2719422694359541,.09775369930903222,25,-18,1.321,0),P(2,2,.19877414408395877,.4307383294587789,48,-40,.755,.975),P(3,2,1,.33333333333333326,-37,0,1,1),P(0,3,-1,1,0,0,1,1),P(1,3,-.33333333333333337,1,0,0,1,1),P(2,3,.5125850864305672,1,-20,-18,0,1.604),P(3,3,1,1,0,0,1,1)]),Be(4,4,[P(0,0,-1,-1,0,0,1,1),P(1,0,-.04704442742088466,-1,0,14,2.013,3.522),P(2,0,.5910378220172194,-1,0,0,1,1),P(3,0,1,-1,0,0,1,1),P(0,1,-1,-.33333333333333337,0,0,1,1),P(1,1,-.13072734537998032,-.2061608440816096,0,0,1,1),P(2,1,.5178152688030109,-.45722068427387885,0,0,1,1),P(3,1,1,-.5021471819924956,0,0,1,1),P(0,2,-1,.33333333333333326,0,0,1,1),P(1,2,-.4210024670505933,.2563178089041497,0,0,1,1),P(2,2,.1124761349386414,-.050239469646410795,4,-2,.849,1.132),P(3,2,1,-.08195229156543427,0,0,1,1),P(0,3,-1,1,0,0,1,1),P(1,3,-.33333333333333337,1,0,0,1,1),P(2,3,.33333333333333326,1,0,0,1,1),P(3,3,1,1,0,0,1,1)]),Be(5,5,[P(0,0,-1,-1,0,0,1,1),P(1,0,-.632824853134554,-1,0,-31,1.101,1.038),P(2,0,-.1019613423315412,-1,0,0,1,1),P(3,0,.7348678372594151,-1,0,39,.66,2.421),P(4,0,1,-1,0,0,1,1),P(0,1,-1,-.5,0,0,1,1),P(1,1,-.7165077710936496,-.5100753874722515,0,0,.629,1),P(2,1,-.5491419351754585,-.4149369217151808,16,25,1,1.478),P(3,1,.5021247216856803,-.5523591500309495,0,44,.629,1.509),P(4,1,1,-.5,0,0,1,1),P(0,2,-1,0,0,0,1,1),P(1,2,-.6851266768589888,-.013241177407550042,0,0,1,1),P(2,2,-.36347046095371505,-.09252323220510884,-23,-31,1,1),P(3,2,.08371013189020227,-.11630784864437647,0,0,.409,1),P(4,2,1,-.002670236767875478,0,0,1,1),P(0,3,-1,.5,0,0,1,1),P(1,3,-.3294742755328324,.6844409048109668,-3,19,1.415,1),P(2,3,.028793216979545733,.36202721530089466,6,0,1.541,.472),P(3,3,.5230454511754543,.2801024253434172,10,-42,0,1.352),P(4,3,1,.5,-3,0,1.981,2.17),P(0,4,-1,1,0,0,1,1),P(1,4,-.48114956433369327,1,0,53,0,1.509),P(2,4,0,1,0,0,1,1),P(3,4,.6093434603207717,1,0,0,.629,1),P(4,4,1,1,0,0,1,1)])],Gc=`precision highp float;

varying vec3 v_color;
varying vec2 v_uv;
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_volume;
uniform float u_alpha;

/* Gradient noise from Jorge Jimenez's presentation: */
/* http://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare */
float gradientNoise(in vec2 uv) {
    return fract(52.9829189 * fract(dot(uv, vec2(0.06711056, 0.00583715))));
}

vec2 rot(vec2 v, float a) {
    float s = sin(a);
    float c = cos(a);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}

void main() {
    float dither = (1.0 / 255.0) * gradientNoise(gl_FragCoord.xy) - (0.5 / 255.0);
    vec4 result = texture2D(u_texture, rot(v_uv * max(1.0, 1.0 + u_volume), u_time + u_volume));
    result *= vec4(v_color, u_alpha);
    result *= vec4(1.0 - u_volume * 0.1);
    result += vec4(dither);
    gl_FragColor = result;
}
`,jc=`precision highp float;

attribute vec2 a_pos;
attribute vec3 a_color;
attribute vec2 a_uv;
varying vec3 v_color;
varying vec2 v_uv;

uniform float u_aspect;

void main() {
    v_color = a_color;
    v_uv = a_uv;
    vec2 pos = a_pos;
    if (u_aspect > 1.0) {
        pos.y *= u_aspect;
    } else {
        pos.x /= u_aspect;
    }
    gl_Position = vec4(pos, 0.0, 1.0);
}
`;class zc{constructor(t,e,r,i="unknown"){I(this,"gl"),I(this,"program"),I(this,"vertexShader"),I(this,"fragmentShader"),I(this,"attrs"),I(this,"notFoundUniforms",new Set),this.label=i,this.gl=t,this.vertexShader=this.createShader(t.VERTEX_SHADER,e),this.fragmentShader=this.createShader(t.FRAGMENT_SHADER,r),this.program=this.createProgram();const n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),a={};for(let o=0;o<n;o++){const h=t.getActiveAttrib(this.program,o);if(!h)continue;const l=t.getAttribLocation(this.program,h.name);l!==-1&&(a[h.name]=l)}this.attrs=a}createShader(t,e){const r=this.gl,i=r.createShader(t);if(!i)throw new Error("Failed to create shader");if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS))throw new Error(`Failed to compile shader for type ${t} "${this.label}": ${r.getShaderInfoLog(i)}`);return i}createProgram(){const t=this.gl,e=t.createProgram();if(!e)throw new Error("Failed to create program");if(t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),t.validateProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){const r=t.getProgramInfoLog(e);throw t.deleteProgram(e),new Error(`Failed to link program "${this.label}": ${r}`)}return e}use(){this.gl.useProgram(this.program)}warnUniformNotFound(t){this.notFoundUniforms.has(t)||(this.notFoundUniforms.add(t),console.warn(`Failed to get uniform location for program "${this.label}": ${t}`))}setUniform1f(t,e){const r=this.gl,i=r.getUniformLocation(this.program,t);i?r.uniform1f(i,e):this.warnUniformNotFound(t)}setUniform2f(t,e,r){const i=this.gl,n=i.getUniformLocation(this.program,t);n?i.uniform2f(n,e,r):this.warnUniformNotFound(t)}setUniform1i(t,e){const r=this.gl,i=r.getUniformLocation(this.program,t);i?r.uniform1i(i,e):this.warnUniformNotFound(t)}dispose(){const t=this.gl;t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader),t.deleteProgram(this.program)}}class Vc{constructor(t,e,r,i){I(this,"vertexWidth",0),I(this,"vertexHeight",0),I(this,"vertexBuffer"),I(this,"indexBuffer"),I(this,"vertexData"),I(this,"indexData"),I(this,"vertexIndexLength",0),I(this,"wireFrame",!1),this.gl=t,this.attrPos=e,this.attrColor=r,this.attrUV=i;const n=t.createBuffer();if(!n)throw new Error("Failed to create vertex buffer");this.vertexBuffer=n;const a=t.createBuffer();if(!a)throw new Error("Failed to create index buffer");this.indexBuffer=a,this.bind(),this.vertexData=new Float32Array(0),this.indexData=new Uint16Array(0),this.resize(2,2),this.update()}setWireFrame(t){this.wireFrame=t,this.resize(this.vertexWidth,this.vertexHeight)}setVertexPos(t,e,r,i){const n=(t+e*this.vertexWidth)*7;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=i}setVertexColor(t,e,r,i,n){const a=(t+e*this.vertexWidth)*7+2;if(a>=this.vertexData.length-1){console.warn("Vertex position out of range",a,this.vertexData.length);return}this.vertexData[a]=r,this.vertexData[a+1]=i,this.vertexData[a+2]=n}setVertexUV(t,e,r,i){const n=(t+e*this.vertexWidth)*7+2+3;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=i}getVertexIndexLength(){return this.vertexIndexLength}draw(){const t=this.gl;this.wireFrame?t.drawElements(t.LINES,this.vertexIndexLength,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,this.vertexIndexLength,t.UNSIGNED_SHORT,0)}resize(t,e){this.vertexWidth=t,this.vertexHeight=e,this.vertexIndexLength=t*e*6,this.wireFrame&&(this.vertexIndexLength=t*e*10);const r=new Float32Array(t*e*7),i=new Uint16Array(this.vertexIndexLength);this.vertexData=r,this.indexData=i;for(let a=0;a<e;a++)for(let o=0;o<t;o++){const h=o/(t-1)*2-1,l=a/(e-1)*2-1;this.setVertexPos(o,a,h||0,l||0),this.setVertexColor(o,a,1,1,1),this.setVertexUV(o,a,o/(t-1),a/(e-1))}for(let a=0;a<e-1;a++)for(let o=0;o<t-1;o++)if(this.wireFrame){const h=(a*t+o)*10;i[h]=a*t+o,i[h+1]=a*t+o+1,i[h+2]=a*t+o+1,i[h+3]=(a+1)*t+o,i[h+4]=(a+1)*t+o,i[h+5]=(a+1)*t+o+1,i[h+6]=(a+1)*t+o+1,i[h+7]=a*t+o+1,i[h+8]=a*t+o,i[h+9]=(a+1)*t+o}else{const h=(a*t+o)*6;i[h]=a*t+o,i[h+1]=a*t+o+1,i[h+2]=(a+1)*t+o,i[h+3]=a*t+o+1,i[h+4]=(a+1)*t+o+1,i[h+5]=(a+1)*t+o}const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexData,n.STATIC_DRAW)}bind(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.attrPos!==void 0&&(t.vertexAttribPointer(this.attrPos,2,t.FLOAT,!1,4*7,0),t.enableVertexAttribArray(this.attrPos)),this.attrColor!==void 0&&(t.vertexAttribPointer(this.attrColor,3,t.FLOAT,!1,4*7,4*2),t.enableVertexAttribArray(this.attrColor)),this.attrUV!==void 0&&(t.vertexAttribPointer(this.attrUV,2,t.FLOAT,!1,4*7,4*5),t.enableVertexAttribArray(this.attrUV))}update(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexData,t.DYNAMIC_DRAW)}dispose(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer)}}class Hc{constructor(){I(this,"color",yt.fromValues(1,1,1)),I(this,"location",ut.fromValues(0,0)),I(this,"uTangent",ut.fromValues(0,0)),I(this,"vTangent",ut.fromValues(0,0)),I(this,"_uRot",0),I(this,"_vRot",0),I(this,"_uScale",1),I(this,"_vScale",1),Object.seal(this)}get uRot(){return this._uRot}get vRot(){return this._vRot}set uRot(t){this._uRot=t,this.updateUTangent()}set vRot(t){this._vRot=t,this.updateVTangent()}get uScale(){return this._uScale}get vScale(){return this._vScale}set uScale(t){this._uScale=t,this.updateUTangent()}set vScale(t){this._vScale=t,this.updateVTangent()}updateUTangent(){this.uTangent[0]=Math.cos(this._uRot)*this._uScale,this.uTangent[1]=Math.sin(this._uRot)*this._uScale}updateVTangent(){this.vTangent[0]=-Math.sin(this._vRot)*this._vScale,this.vTangent[1]=Math.cos(this._vRot)*this._vScale}}const Ue=lt.fromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0),cr=lt.clone(Ue).transpose(),se=nt.create(),qr=nt.create(),Ge=nt.create(),je=lt.create(),ze=lt.create();function Xc(s,t,e,r,i=ut.create()){se[0]=s**3,se[1]=s**2,se[2]=s,se[3]=1,qr.copy(se),Ge[0]=t**3,Ge[1]=t**2,Ge[2]=t,Ge[3]=1,je.copy(e).transpose(),lt.mul(je,je,Ue),lt.mul(je,cr,je),nt.transformMat4(se,se,je);const n=Ge.dot(se);ze.copy(r).transpose(),lt.mul(ze,ze,Ue),lt.mul(ze,cr,ze),nt.transformMat4(qr,qr,ze);const a=Ge.dot(qr);return i.x=n,i.y=a,i}function ph(s,t,e,r,i,n=lt.create()){const a=l=>l.location[i],o=l=>l.uTangent[i],h=l=>l.vTangent[i];return n[0]=a(s),n[1]=a(t),n[2]=h(s),n[3]=h(t),n[4]=a(e),n[5]=a(r),n[6]=h(e),n[7]=h(r),n[8]=o(s),n[9]=o(t),n[10]=0,n[11]=0,n[12]=o(e),n[13]=o(r),n[14]=0,n[15]=0,n}function Si(s,t,e,r,i,n=lt.create()){const a=o=>o.color[i];return n.fill(0),n[0]=a(s),n[1]=a(t),n[4]=a(e),n[5]=a(r),n}const Qt=nt.create(),Yr=nt.create(),Kr=nt.create(),Ee=nt.create(),Ve=lt.create(),He=lt.create(),Xe=lt.create(),Zr=yt.create();function Wc(s,t,e,r,i){return Qt[0]=s**3,Qt[1]=s**2,Qt[2]=s,Qt[3]=1,Yr.copy(Qt),Kr.copy(Qt),Ee[0]=t**3,Ee[1]=t**2,Ee[2]=t,Ee[3]=1,Ve.copy(e).transpose(),lt.mul(Ve,Ve,Ue),lt.mul(Ve,cr,Ve),nt.transformMat4(Qt,Qt,Ve),Zr.r=Ee.dot(Qt),He.copy(r).transpose(),lt.mul(He,He,Ue),lt.mul(He,cr,He),nt.transformMat4(Yr,Yr,He),Zr.g=Ee.dot(Yr),Xe.copy(i).transpose(),lt.mul(Xe,Xe,Ue),lt.mul(Xe,cr,Xe),nt.transformMat4(Kr,Kr,Xe),Zr.b=Ee.dot(Kr),Zr}class $c{constructor(t,e){I(this,"_width",0),I(this,"_height",0),I(this,"_data",[]),this.resize(t,e),Object.seal(this)}resize(t,e){this._width=t,this._height=e,this._data=new Array(t*e).fill(0)}set(t,e,r){this._data[t+e*this._width]=r}get(t,e){return this._data[t+e*this._width]}get width(){return this._width}get height(){return this._height}}class qc extends Vc{constructor(t,e,r,i){super(t,e,r,i),I(this,"_subDivisions",10),I(this,"_controlPoints",new $c(3,3)),I(this,"uMX",lt.create()),I(this,"uMY",lt.create()),I(this,"uMR",lt.create()),I(this,"uMG",lt.create()),I(this,"uMB",lt.create()),I(this,"tmpV2",ut.create()),this.resizeControlPoints(3,3),Object.seal(this)}setWireFrame(t){super.setWireFrame(t),this.updateMesh()}resetSubdivition(t){this._subDivisions=t,super.resize((this._controlPoints.width-1)*t,(this._controlPoints.height-1)*t)}resizeControlPoints(t,e){if(!(t>=2&&e>=2))throw new Error("Control points must be larger than 3x3 or equal");this._controlPoints.resize(t,e);for(let r=0;r<e;r++)for(let i=0;i<t;i++){const n=new Hc;n.location.x=i/(t-1)*2-1,n.location.y=r/(e-1)*2-1,n.uTangent.x=2/(t-1),n.vTangent.y=2/(e-1),this._controlPoints.set(i,r,n)}this.resetSubdivition(this._subDivisions)}getControlPoint(t,e){return this._controlPoints.get(t,e)}updateMesh(){const t=this._subDivisions-1,e=t*(this._controlPoints.height-1),r=t*(this._controlPoints.width-1);for(let i=0;i<this._controlPoints.width-1;i++)for(let n=0;n<this._controlPoints.height-1;n++){const a=this._controlPoints.get(i,n),o=this._controlPoints.get(i,n+1),h=this._controlPoints.get(i+1,n),l=this._controlPoints.get(i+1,n+1),u=ph(a,o,h,l,"x",this.uMX),d=ph(a,o,h,l,"y",this.uMY),c=Si(a,o,h,l,"r",this.uMR),p=Si(a,o,h,l,"g",this.uMG),v=Si(a,o,h,l,"b",this.uMB),f=i/(this._controlPoints.width-1),m=n/(this._controlPoints.height-1);for(let y=0;y<this._subDivisions;y++)for(let x=0;x<this._subDivisions;x++){const T=n*this._subDivisions+y,M=i*this._subDivisions+x,[g,S]=Xc(y/t,x/t,u,d,this.tmpV2);this.setVertexPos(T,M,g,S),this.setVertexUV(T,M,f+x/r,1-m-y/e);const[b,B,C]=Wc(y/t,x/t,c,p,v);this.setVertexColor(T,M,b,B,C)}}this.update()}}class mh{constructor(t,e){I(this,"tex"),this.gl=t;const r=t.createTexture();if(!r)throw new Error("Failed to create texture");this.tex=r,t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)}dispose(){this.gl.deleteTexture(this.tex)}}function Yc(s,t){if("OffscreenCanvas"in window)return new OffscreenCanvas(s,t);const e=document.createElement("canvas");return e.width=s,e.height=t,e}class Kc extends Nc{constructor(t){super(t),I(this,"gl"),I(this,"lastFrameTime",0),I(this,"frameTime",0),I(this,"lastTickTime",0),I(this,"volume",0),I(this,"tickHandle",0),I(this,"maxFPS",60),I(this,"paused",!1),I(this,"staticMode",!1),I(this,"mainProgram"),I(this,"manualControl",!1),I(this,"reduceImageSizeCanvas",Yc(32,32)),I(this,"targetSize",ut.fromValues(0,0)),I(this,"currentSize",ut.fromValues(0,0)),I(this,"meshStates",[]),I(this,"_disposed",!1),I(this,"onTickBinded",this.onTick.bind(this)),I(this,"supportTextureFloat",!0);const e=t.getContext("webgl");if(!e)throw new Error("WebGL not supported");e.getExtension("EXT_color_buffer_float")||console.warn("EXT_color_buffer_float not supported"),e.getExtension("EXT_float_blend")||(console.warn("EXT_float_blend not supported"),this.supportTextureFloat=!1),e.getExtension("OES_texture_float_linear")||console.warn("OES_texture_float_linear not supported"),e.getExtension("OES_texture_float")||(this.supportTextureFloat=!1,console.warn("OES_texture_float not supported")),this.gl=e,e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.ALWAYS),this.mainProgram=new zc(e,jc,Gc,"main-program-mg"),this.requestTick()}setManualControl(t){this.manualControl=t}setWireFrame(t){for(const e of this.meshStates)e.mesh.setWireFrame(t)}getControlPoint(t,e){var r,i;return(i=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:i.getControlPoint(t,e)}resizeControlPoints(t,e){var r,i;return(i=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:i.resizeControlPoints(t,e)}resetSubdivition(t){var e,r;return(r=(e=this.meshStates[this.meshStates.length-1])==null?void 0:e.mesh)==null?void 0:r.resetSubdivition(t)}onTick(t){if(this.tickHandle=0,this.paused||this._disposed)return;Number.isNaN(this.lastFrameTime)&&(this.lastFrameTime=t);const e=t-this.lastTickTime,r=t-this.lastFrameTime;if(this.lastFrameTime=t,e<1e3/this.maxFPS){this.requestTick();return}this.frameTime+=r,this.onRedraw(this.frameTime,r)&&this.staticMode?this.staticMode&&(this.lastFrameTime=Number.NaN):this.requestTick(),this.lastTickTime=t}checkIfResize(){const[t,e]=[this.targetSize.x,this.targetSize.y],[r,i]=[this.currentSize.x,this.currentSize.y];if(t!==r||e!==i){super.onResize(t,e);const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,t,e),this.currentSize.x=t,this.currentSize.y=e}}onRedraw(t,e){const r=this.meshStates[this.meshStates.length-1];let i=!1;if(r){if(r.mesh.bind(),this.manualControl&&r.mesh.updateMesh(),r.alpha=Math.min(1,r.alpha+e/500),r.alpha>=1){const a=this.meshStates.splice(0,this.meshStates.length-1);for(const o of a)o.mesh.dispose(),o.texture.dispose()}this.meshStates.length===1&&r.alpha>=1&&(i=!0)}const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.clear(n.COLOR_BUFFER_BIT),this.checkIfResize(),this.mainProgram.use(),n.activeTexture(n.TEXTURE0),this.mainProgram.setUniform1f("u_time",t/1e4),this.mainProgram.setUniform1f("u_aspect",this.manualControl?1:this.canvas.width/this.canvas.height),this.mainProgram.setUniform1i("u_texture",0),this.mainProgram.setUniform1f("u_volume",this.volume);for(const a of this.meshStates)this.mainProgram.setUniform1f("u_alpha",a.alpha),a.texture.bind(),a.mesh.bind(),a.mesh.draw();return n.flush(),i}requestTick(){this._disposed||this.tickHandle===0&&(this.tickHandle=requestAnimationFrame(this.onTickBinded))}onResize(t,e){this.targetSize.x=Math.ceil(t),this.targetSize.y=Math.ceil(e),this.requestTick()}setStaticMode(t){this.staticMode=t,this.lastFrameTime=performance.now(),this.requestTick()}setFPS(t){this.maxFPS=t}pause(){this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this.paused=!0}resume(){this.paused=!1,this.requestTick()}async setAlbum(t,e){if(typeof t=="string"&&t.trim().length===0)throw new Error("Empty album url");let r=null,i=5;for(;!r&&i>0;)try{typeof t=="string"?r=await Cc(t,e):r=await Dc(t)}catch(u){console.warn(`failed on loading album resource, retrying (${i})`,{albumSource:t,error:u}),i--}if(!r)return;const n=this.reduceImageSizeCanvas,a=n.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("Failed to create canvas context");a.clearRect(0,0,n.width,n.height);const o=r instanceof HTMLVideoElement?r.videoWidth:r.naturalWidth,h=r instanceof HTMLVideoElement?r.videoHeight:r.naturalHeight;if(o*h===0)throw new Error("Invalid image size");a.drawImage(r,0,0,o,h,0,0,n.width,n.height);const l=a.getImageData(0,0,n.width,n.height);if(dh(l,.4),Bc(l,3),dh(l,1.7),Uc(l,.75),kc(l,2,4),this.manualControl&&this.meshStates.length>0)this.meshStates[0].texture.dispose(),this.meshStates[0].texture=new mh(this.gl,l);else{const u=new qc(this.gl,this.mainProgram.attrs.a_pos,this.mainProgram.attrs.a_color,this.mainProgram.attrs.a_uv);u.resetSubdivition(15);const d=fh[Math.floor(Math.random()*fh.length)];u.resizeControlPoints(d.width,d.height);const c=2/(d.width-1),p=2/(d.height-1);for(const m of d.conf){const y=u.getControlPoint(m.cx,m.cy);y.location.x=m.x,y.location.y=m.y,y.uRot=m.ur*Math.PI/180,y.vRot=m.vr*Math.PI/180,y.uScale=c*m.up,y.vScale=p*m.vp}u.updateMesh();const v=new mh(this.gl,l),f={mesh:u,texture:v,alpha:0};this.meshStates.push(f)}this.requestTick()}setLowFreqVolume(t){this.volume=t/10}setHasLyric(t){}dispose(){super.dispose(),this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this._disposed=!0,this.mainProgram.dispose();for(const t of this.meshStates)t.mesh.dispose(),t.texture.dispose()}}class Ri{constructor(t,e){I(this,"element"),I(this,"renderer"),this.renderer=t,this.element=e,e.style.pointerEvents="none",e.style.zIndex="-1",e.style.contain="strict"}static new(t){const e=document.createElement("canvas");return new Ri(new t(e),e)}setRenderScale(t){this.renderer.setRenderScale(t)}setFlowSpeed(t){this.renderer.setFlowSpeed(t)}setStaticMode(t){this.renderer.setStaticMode(t)}setFPS(t){this.renderer.setFPS(t)}pause(){this.renderer.pause()}resume(){this.renderer.resume()}setLowFreqVolume(t){this.renderer.setLowFreqVolume(t)}setHasLyric(t){this.renderer.setHasLyric(t)}setAlbum(t,e){return this.renderer.setAlbum(t,e)}getElement(){return this.element}dispose(){this.renderer.dispose(),this.element.remove()}}const Zc="_lyricLine_lennj_6",Jc="_dirty_lennj_26",Qc="_lyricBgLine_lennj_42",td="_active_lennj_51",ed="_hasDuetLine_lennj_63",rd="_lyricDuetLine_lennj_64",sd="_lyricMainLine_lennj_78",id="_emphasizeWrapper_lennj_88",nd="_emphasize_lennj_88",ad="_lyricSubLine_lennj_111",od="_disableSpring_lennj_118",hd="_interludeDots_lennj_123",ld="_enabled_lennj_135",ud="_duet_lennj_149",cd="_tmpDisableTransition_lennj_161",ct={lyricLine:Zc,dirty:Jc,lyricBgLine:Qc,active:td,hasDuetLine:ed,lyricDuetLine:rd,lyricMainLine:sd,emphasizeWrapper:id,emphasize:nd,lyricSubLine:ad,disableSpring:od,interludeDots:hd,enabled:ld,duet:ud,tmpDisableTransition:cd};function dd(s,t=20){let e=0;return(...r)=>{clearTimeout(e),e=setTimeout(()=>s(...r),t)}}const gh=-1,Jr=0,Qr=1,ts=2,Ii=3,Li=4,Fi=5,Ni=6,yh=7,vh=8,bh=typeof self=="object"?self:globalThis,fd=(s,t)=>{const e=(i,n)=>(s.set(n,i),i),r=i=>{if(s.has(i))return s.get(i);const[n,a]=t[i];switch(n){case Jr:case gh:return e(a,i);case Qr:{const o=e([],i);for(const h of a)o.push(r(h));return o}case ts:{const o=e({},i);for(const[h,l]of a)o[r(h)]=r(l);return o}case Ii:return e(new Date(a),i);case Li:{const{source:o,flags:h}=a;return e(new RegExp(o,h),i)}case Fi:{const o=e(new Map,i);for(const[h,l]of a)o.set(r(h),r(l));return o}case Ni:{const o=e(new Set,i);for(const h of a)o.add(r(h));return o}case yh:{const{name:o,message:h}=a;return e(new bh[o](h),i)}case vh:return e(BigInt(a),i);case"BigInt":return e(Object(BigInt(a)),i)}return e(new bh[n](a),i)};return r},xh=s=>fd(new Map,s)(0),We="",{toString:pd}={},{keys:md}=Object,dr=s=>{const t=typeof s;if(t!=="object"||!s)return[Jr,t];const e=pd.call(s).slice(8,-1);switch(e){case"Array":return[Qr,We];case"Object":return[ts,We];case"Date":return[Ii,We];case"RegExp":return[Li,We];case"Map":return[Fi,We];case"Set":return[Ni,We]}return e.includes("Array")?[Qr,e]:e.includes("Error")?[yh,e]:[ts,e]},es=([s,t])=>s===Jr&&(t==="function"||t==="symbol"),gd=(s,t,e,r)=>{const i=(a,o)=>{const h=r.push(a)-1;return e.set(o,h),h},n=a=>{if(e.has(a))return e.get(a);let[o,h]=dr(a);switch(o){case Jr:{let u=a;switch(h){case"bigint":o=vh,u=a.toString();break;case"function":case"symbol":if(s)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return i([gh],a)}return i([o,u],a)}case Qr:{if(h)return i([h,[...a]],a);const u=[],d=i([o,u],a);for(const c of a)u.push(n(c));return d}case ts:{if(h)switch(h){case"BigInt":return i([h,a.toString()],a);case"Boolean":case"Number":case"String":return i([h,a.valueOf()],a)}if(t&&"toJSON"in a)return n(a.toJSON());const u=[],d=i([o,u],a);for(const c of md(a))(s||!es(dr(a[c])))&&u.push([n(c),n(a[c])]);return d}case Ii:return i([o,a.toISOString()],a);case Li:{const{source:u,flags:d}=a;return i([o,{source:u,flags:d}],a)}case Fi:{const u=[],d=i([o,u],a);for(const[c,p]of a)(s||!(es(dr(c))||es(dr(p))))&&u.push([n(c),n(p)]);return d}case Ni:{const u=[],d=i([o,u],a);for(const c of a)(s||!es(dr(c)))&&u.push(n(c));return d}}const{message:l}=a;return i([o,{name:h,message:l}],a)};return n},_h=(s,{json:t,lossy:e}={})=>{const r=[];return gd(!(t||e),!!t,new Map,r)(s),r},Eh=typeof structuredClone=="function"?(s,t)=>t&&("json"in t||"lossy"in t)?xh(_h(s,t)):structuredClone(s):(s,t)=>xh(_h(s,t)),yd=(s,t)=>s.size===t.size&&[...s].every(e=>t.has(e)),vd=s=>/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u.test(s);function bd(s){return t=>(s(t+.001)-s(t-.001))/(2*.001)}function Th(s){return bd(s)}class rs{constructor(t=0){I(this,"currentPosition",0),I(this,"targetPosition",0),I(this,"currentTime",0),I(this,"params",{}),I(this,"currentSolver"),I(this,"getV"),I(this,"getV2"),I(this,"queueParams"),I(this,"queuePosition"),this.targetPosition=t,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const t=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=xd(this.currentPosition,t,this.targetPosition,0,this.params),this.getV=Th(this.currentSolver),this.getV2=Th(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(t){this.targetPosition=t,this.currentPosition=t,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(t=0){this.currentTime+=t,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=t,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=t,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(t,e=0){e>0?this.queueParams={...this.queuePosition??{},...t,time:e}:(this.queuePosition=void 0,this.params={...this.params,...t},this.resetSolver())}setTargetPosition(t,e=0){e>0?this.queuePosition={...this.queuePosition??{},position:t,time:e}:(this.queuePosition=void 0,this.targetPosition=t,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function xd(s,t,e,r=0,i){const n=i?.soft??!1,a=i?.stiffness??100,o=i?.damping??10,h=i?.mass??1,l=e-s;if(n||1<=o/(2*Math.sqrt(a*h))){const v=-Math.sqrt(a/h),f=-v*l-t;return m=>(m-=r,m<0?s:e-(l+m*f)*Math.E**(m*v))}const u=Math.sqrt(4*h*a-o**2),d=(o*l-2*h*t)/u,c=.5*u/h,p=-(.5*o)/h;return v=>(v-=r,v<0?s:e-(Math.cos(v*c)*l+Math.sin(v*c)*d)*Math.E**(v*p))}const Oi=[],Pi=[];let Ci=!1;function _d(){let s=Pi.shift();for(;s;){try{s.resolve(s.task())}catch(t){s.reject(t)}s=Pi.shift()}for(s=Oi.shift();s;){try{s.resolve(s.task())}catch(t){s.reject(t)}s=Oi.shift()}Ci=!1}function wh(){Ci||(Ci=!0,requestAnimationFrame(_d))}function Di(s){const t={task:s,resolve:()=>{},reject:()=>{}},e=new Promise((r,i)=>{t.resolve=r,t.reject=i});return Oi.push(t),wh(),e}function ss(s){const t={task:s,resolve:()=>{},reject:()=>{}},e=new Promise((r,i)=>{t.resolve=r,t.reject=i});return Pi.push(t),wh(),e}class Ed{constructor(t){I(this,"element",document.createElement("div")),I(this,"left",0),I(this,"top",0),I(this,"delay",0),I(this,"lineSize",[0,0]),I(this,"lineTransforms",{posX:new rs(0),posY:new rs(0)}),I(this,"lastStyle",""),this.lyricPlayer=t,this.element.setAttribute("class",ct.lyricLine),this.rebuildStyle()}async measureSize(){return await Di(()=>[this.element.clientWidth,this.element.clientHeight])}show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let t=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(t+=`transition-delay:${this.delay}ms;`),t!==this.lastStyle&&(this.lastStyle=t,this.element.setAttribute("style",t))}getElement(){return this.element}setTransform(t=this.left,e=this.top,r=!1,i=0){this.left=t,this.top=e,this.delay=i*1e3|0,r||!this.lyricPlayer.getEnableSpring()?(r&&this.element.classList.add(ct.tmpDisableTransition),this.lineTransforms.posX.setPosition(t),this.lineTransforms.posY.setPosition(e),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),r&&requestAnimationFrame(()=>{this.element.classList.remove(ct.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(t,i),this.lineTransforms.posY.setTargetPosition(e,i))}update(t=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(t),this.lineTransforms.posY.update(t),this.isInSight?this.show():this.hide())}get isInSight(){const t=this.lineTransforms.posX.getCurrentPosition(),e=this.lineTransforms.posY.getCurrentPosition(),r=t+this.lineSize[0],i=e+this.lineSize[1],n=this.lyricPlayer.size[0],a=this.lyricPlayer.size[1];return!(t>n||e>a||r<0||i<0)}dispose(){this.element.remove()}}function Td(s){const t=2.5949095;return s<.5?(2*s)**2*((t+1)*2*s-t)/2:((2*s-2)**2*((t+1)*(s*2-2)+t)+2)/2}function wd(s){return s===1?1:1-2**(-10*s)}const Te=(s,t,e)=>Math.max(s,Math.min(t,e));class Ad{constructor(){I(this,"element",document.createElement("div")),I(this,"dot0",document.createElement("span")),I(this,"dot1",document.createElement("span")),I(this,"dot2",document.createElement("span")),I(this,"left",0),I(this,"top",0),I(this,"playing",!0),I(this,"lastStyle",""),I(this,"currentInterlude"),I(this,"currentTime",0),I(this,"targetBreatheDuration",1500),this.element.className=ct.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}getElement(){return this.element}setTransform(t=this.left,e=this.top){this.left=t,this.top=e,this.update()}setInterlude(t){this.currentInterlude=t,this.currentTime=t?.[0]??0,t?this.element.classList.add(ct.enabled):this.element.classList.remove(ct.enabled)}pause(){this.playing=!1,this.element.classList.remove(ct.playing)}resume(){this.playing=!0,this.element.classList.add(ct.playing)}update(t=0){if(!this.playing)return;this.currentTime+=t;let e="";if(e+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const r=this.currentInterlude[1]-this.currentInterlude[0],i=this.currentTime-this.currentInterlude[0];if(i<=r){const n=r/Math.ceil(r/this.targetBreatheDuration);let a=1,o=1;a*=Math.sin(1.5*Math.PI-i/n*2)/20+1,i<2e3&&(a*=wd(i/2e3)),i<500?o=0:i<1e3&&(o*=(i-500)/500),r-i<750&&(a*=1-Td((750-(r-i))/750/2)),r-i<375&&(o*=Te(0,(r-i)/375,1));const h=Math.max(0,r-750);a=Math.max(0,a)*.7,e+=` scale(${a})`;const l=Te(.25,i*3/h*.75,1),u=Te(.25,(i-h/3)*3/h*.75,1),d=Te(.25,(i-h/3*2)*3/h*.75,1);this.dot0.style.opacity=`${Te(0,Math.max(0,o*l),1)}`,this.dot1.style.opacity=`${Te(0,Math.max(0,o*u),1)}`,this.dot2.style.opacity=`${Te(0,Math.max(0,o*d),1)}`}else e+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";e+=";",this.lastStyle!==e&&(this.element.setAttribute("style",e),this.lastStyle=e)}}dispose(){this.element.remove()}}class Md extends EventTarget{constructor(){super(),I(this,"element",document.createElement("div")),I(this,"currentTime",0),I(this,"lyricLinesSize",new WeakMap),I(this,"currentLyricLines",[]),I(this,"processedLines",[]),I(this,"lyricLinesIndexes",new WeakMap),I(this,"hotLines",new Set),I(this,"bufferedLines",new Set),I(this,"isNonDynamic",!1),I(this,"hasDuetLine",!1),I(this,"scrollToIndex",0),I(this,"disableSpring",!1),I(this,"interludeDotsSize",[0,0]),I(this,"interludeDots",new Ad),I(this,"bottomLine",new Ed(this)),I(this,"enableBlur",!0),I(this,"enableScale",!0),I(this,"hidePassedLines",!1),I(this,"scrollBoundary",[0,0]),I(this,"currentLyricLineObjects",[]),I(this,"isSeeking",!1),I(this,"lastCurrentTime",0),I(this,"alignAnchor","center"),I(this,"alignPosition",.35),I(this,"scrollOffset",0),I(this,"size",[0,0]),I(this,"allowScroll",!0),I(this,"isPageVisible",!0),I(this,"initialLayoutFinished",!1),I(this,"posXSpringParams",{mass:1,damping:10,stiffness:100}),I(this,"posYSpringParams",{mass:.9,damping:15,stiffness:90}),I(this,"scaleSpringParams",{mass:2,damping:25,stiffness:100}),I(this,"scaleForBGSpringParams",{mass:1,damping:20,stiffness:50}),I(this,"onPageShow",()=>{this.isPageVisible=!0,this.setCurrentTime(this.currentTime,!0)}),I(this,"onPageHide",()=>{this.isPageVisible=!1}),I(this,"scrolledHandler",0),I(this,"isScrolled",!1),I(this,"resizeObserver",new ResizeObserver(l=>{const u=l[0].contentRect;this.size[0]=u.width,this.size[1]=u.height,this.onResize()})),I(this,"wordFadeWidth",.5),I(this,"targetAlignIndex",0),this.resizeObserver.observe(this.element),this.element.classList.add(ct.lyricPlayer),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow),window.addEventListener("pagehide",this.onPageHide);let t=0,e="none",r=0,i=0,n=0,a=Symbol("amll-scroll"),o=0,h=0;this.element.addEventListener("touchstart",l=>{this.beginScrollHandler()&&(l.preventDefault(),t=this.scrollOffset,r=l.touches[0].screenY,o=r,i=Date.now(),n=0)}),this.element.addEventListener("touchmove",l=>{if(this.beginScrollHandler()){l.preventDefault();const u=l.touches[0].screenY,d=u-r,c=u-o,p=c>0?"down":c<0?"up":"none";e!==p?(e=p,t=this.scrollOffset,r=u,i=Date.now()):this.scrollOffset=t-d,o=u,h=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",l=>{if(this.beginScrollHandler()){l.preventDefault(),r=0;const u=Date.now();if(u-h>100)return this.endScrollHandler();const d=u-i;n=(this.scrollOffset-t)/d*1e3;let c=0;const p=Symbol("amll-scroll");a=p;const v=f=>{c||(c=f),a===p&&this.beginScrollHandler()&&(this.scrollOffset+=n*(f-c)/1e3,n*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(n)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(v),this.endScrollHandler(),c=f)};requestAnimationFrame(v),this.endScrollHandler()}}),this.element.addEventListener("wheel",l=>{this.beginScrollHandler()&&(l.deltaMode===l.DOM_DELTA_PIXEL?(this.scrollOffset+=l.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=l.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}beginScrollHandler(){const t=this.allowScroll;return t&&(this.isScrolled=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),t}endScrollHandler(){}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}setWordFadeWidth(t=.5){this.wordFadeWidth=Math.max(1e-4,t)}setEnableScale(t=!0){this.enableScale=t,this.calcLayout()}getEnableScale(){return this.enableScale}getWordFadeWidth(){return this.wordFadeWidth}setIsSeeking(t){this.isSeeking=t}setHidePassedLines(t){this.hidePassedLines=t,this.calcLayout()}setEnableBlur(t){this.enableBlur!==t&&(this.enableBlur=t,this.calcLayout())}setAlignAnchor(t){this.alignAnchor=t}setAlignPosition(t){this.alignPosition=t}setEnableSpring(t=!0){this.disableSpring=!t,t?this.element.classList.remove(ct.disableSpring):this.element.classList.add(ct.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}getCurrentInterlude(){var t,e,r,i;if(this.bufferedLines.size>0)return;const n=this.currentTime+20,a=this.scrollToIndex;if(a===0){if((t=this.processedLines[0])!=null&&t.startTime){if(this.processedLines[0].startTime>n)return[n,Math.max(n,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet];if(this.processedLines[1].startTime>n&&this.processedLines[0].endTime<n)return[Math.max(this.processedLines[0].endTime,n),this.processedLines[1].startTime,0,this.processedLines[1].isDuet]}}else if((e=this.processedLines[a])!=null&&e.endTime&&(r=this.processedLines[a+1])!=null&&r.startTime){if(this.processedLines[a+1].startTime>n&&this.processedLines[a].endTime<n)return[Math.max(this.processedLines[a].endTime,n),this.processedLines[a+1].startTime,a,this.processedLines[a+1].isDuet];if((i=this.processedLines[a+2])!=null&&i.startTime&&this.processedLines[a+2].startTime>n&&this.processedLines[a+1].endTime<n)return[Math.max(this.processedLines[a+1].endTime,n),this.processedLines[a+2].startTime,a+1,this.processedLines[a+2].isDuet]}}setLyricLines(t,e=0){this.initialLayoutFinished=!1;for(const r of t)for(const i of r.words)i.word=i.word.replace(/\s+/g," ");this.lastCurrentTime=e,this.currentTime=e,this.currentLyricLines=Eh(t),this.processedLines=Eh(t),this.isNonDynamic=!0;for(const r of this.processedLines)if(r.words.length>1){this.isNonDynamic=!1;break}this.hasDuetLine=this.processedLines.some(r=>r.isDuet),this.processedLines.forEach((r,i,n)=>{const a=n[i+1];r.words[r.words.length-1]&&(a?a.startTime>r.endTime&&(r.endTime=Math.min(r.endTime+1500,a.startTime)):r.endTime=r.endTime+1500)}),this.processedLines.forEach((r,i,n)=>{if(r.isBG)return;const a=n[i+1];a!=null&&a.isBG&&(a.startTime=Math.min(a.startTime,r.startTime))});for(const r of this.currentLyricLineObjects)r.dispose();this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setCurrentTime(0,!0)}setCurrentTime(t,e=!1){var r,i,n,a,o,h,l,u,d;if(this.currentTime=t,!this.initialLayoutFinished&&!e)return;const c=new Set,p=new Set,v=new Set;for(const f of this.hotLines){const m=this.processedLines[f];if(m){if(m.isBG)return;const y=this.processedLines[f+1];if(y!=null&&y.isBG){const x=this.processedLines[f+2],T=Math.min(m.startTime,y?.startTime),M=Math.min(Math.max(m.endTime,x?.startTime??Number.MAX_VALUE),Math.max(m.endTime,y?.endTime));(T>t||M<=t)&&(this.hotLines.delete(f),c.add(f),this.hotLines.delete(f+1),c.add(f+1),e&&((r=this.currentLyricLineObjects[f])==null||r.disable(),(i=this.currentLyricLineObjects[f+1])==null||i.disable()))}else(m.startTime>t||m.endTime<=t)&&(this.hotLines.delete(f),c.add(f),e&&((n=this.currentLyricLineObjects[f])==null||n.disable()))}else this.hotLines.delete(f),c.add(f),e&&((a=this.currentLyricLineObjects[f])==null||a.disable())}this.currentLyricLineObjects.forEach((f,m,y)=>{var x,T;const M=f.getLine();!M.isBG&&M.startTime<=t&&M.endTime>t&&(this.hotLines.has(m)||(this.hotLines.add(m),v.add(m),e&&f.enable(),(T=(x=y[m+1])==null?void 0:x.getLine())!=null&&T.isBG&&(this.hotLines.add(m+1),v.add(m+1),e&&y[m+1].enable())))});for(const f of this.bufferedLines)this.hotLines.has(f)||(p.add(f),e&&((o=this.currentLyricLineObjects[f])==null||o.disable()));if(e){this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(f=>f.startTime>=t),this.bufferedLines.clear();for(const f of this.hotLines)this.bufferedLines.add(f);this.calcLayout(!0)}else if(p.size>0||v.size>0)if(p.size===0&&v.size>0){for(const f of v)this.bufferedLines.add(f),(h=this.currentLyricLineObjects[f])==null||h.enable();this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()}else if(v.size===0&&p.size>0){if(yd(p,this.bufferedLines)){for(const f of this.bufferedLines)this.hotLines.has(f)||(this.bufferedLines.delete(f),(l=this.currentLyricLineObjects[f])==null||l.disable());this.calcLayout()}}else{for(const f of v)this.bufferedLines.add(f),(u=this.currentLyricLineObjects[f])==null||u.enable();for(const f of p)this.bufferedLines.delete(f),(d=this.currentLyricLineObjects[f])==null||d.disable();this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()}this.lastCurrentTime=t}async calcLayout(t,e){var r;e&&(await Promise.all(this.currentLyricLineObjects.map(async v=>{const f=await v.measureSize();this.lyricLinesSize.set(v,f)})),this.interludeDotsSize[0]=this.interludeDots.getElement().clientWidth,this.interludeDotsSize[1]=this.interludeDots.getElement().clientHeight,this.bottomLine.lineSize=await this.bottomLine.measureSize());const i=this.getCurrentInterlude();let n=-this.scrollOffset,a=this.scrollToIndex,o=0;i?(o=i[1]-i[0],o>=4e3&&this.currentLyricLineObjects[i[2]+1]&&(a=i[2]+1)):this.interludeDots.setInterlude(void 0);const h=this.currentLyricLineObjects.slice(0,a).reduce((v,f)=>{var m;return v+(f.getLine().isBG?0:((m=this.lyricLinesSize.get(f))==null?void 0:m[1])??0)},0);this.scrollBoundary[0]=-h,n-=h,n+=this.size[1]*this.alignPosition;const l=this.currentLyricLineObjects[a];if(this.targetAlignIndex=a,l){const v=((r=this.lyricLinesSize.get(l))==null?void 0:r[1])??0;switch(this.alignAnchor){case"bottom":n-=v;break;case"center":n-=v/2;break}}const u=Math.max(...this.bufferedLines);let d=0,c=.05,p=!1;this.currentLyricLineObjects.forEach((v,f)=>{var m,y;const x=this.bufferedLines.has(f),T=x||f>=this.scrollToIndex&&f<u,M=v.getLine();!p&&o>=4e3&&(f===this.scrollToIndex&&i?.[2]===-2||f===this.scrollToIndex+1)&&(p=!0,this.interludeDots.setTransform(0,n+10),i&&this.interludeDots.setInterlude([i[0],i[1]]),n+=this.interludeDotsSize[1]+40);let g;this.hidePassedLines?f<(i?i[2]+1:this.scrollToIndex)?g=0:x?g=.85:g=this.isNonDynamic?.2:1:x?g=.85:g=this.isNonDynamic?.2:1;let S=0;this.enableBlur&&(T?S=0:(S=1,f<this.scrollToIndex?S+=Math.abs(this.scrollToIndex-f)+1:S+=Math.abs(f-Math.max(this.scrollToIndex,u))));const b=this.enableScale?97:100;v.setTransform(n,T?100:M.isBG?75:b,g,window.innerWidth<=1024?S*.8:S,t,d),M.isBG&&T?n+=((m=this.lyricLinesSize.get(v))==null?void 0:m[1])??0:M.isBG||(n+=((y=this.lyricLinesSize.get(v))==null?void 0:y[1])??0),n>=0&&!this.isSeeking&&(M.isBG||(d+=c),f>=this.scrollToIndex&&(c/=1.05))}),this.scrollBoundary[1]=n+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(0,n,t,d)}setLinePosXSpringParams(t={}){}setLinePosYSpringParams(t={}){this.posYSpringParams={...this.posYSpringParams,...t},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams);for(const e of this.currentLyricLineObjects)e.lineTransforms.posY.updateParams(this.posYSpringParams)}setLineScaleSpringParams(t={}){this.scaleSpringParams={...this.scaleSpringParams,...t},this.scaleForBGSpringParams={...this.scaleForBGSpringParams,...t};for(const e of this.currentLyricLineObjects)e.getLine().isBG?e.lineTransforms.scale.updateParams(this.scaleForBGSpringParams):e.lineTransforms.scale.updateParams(this.scaleSpringParams)}pause(){this.interludeDots.pause()}resume(){this.interludeDots.resume()}update(t=0){this.bottomLine.update(t/1e3),this.interludeDots.update(t/1e3)}onResize(){}getBottomLineElement(){return this.bottomLine.getElement()}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}getLyricLines(){return this.currentLyricLines}getCurrentTime(){return this.currentTime}getElement(){return this.element}dispose(){this.element.remove(),window.removeEventListener("pageshow",this.onPageShow),window.removeEventListener("pagehide",this.onPageHide)}}class $e extends EventTarget{constructor(){super(...arguments),I(this,"top",0),I(this,"scale",1),I(this,"blur",0),I(this,"opacity",1),I(this,"delay",0),I(this,"lineTransforms",{posY:new rs(0),scale:new rs(100)})}setTransform(t=this.top,e=this.scale,r=this.opacity,i=this.blur,n=!1,a=0){this.top=t,this.scale=e,this.opacity=r,this.blur=i,this.delay=a}static shouldEmphasize(t){return vd(t.word)?t.endTime-t.startTime>=1e3:t.endTime-t.startTime>=1e3&&t.word.trim().length<=7&&t.word.trim().length>1}dispose(){}}function Sd(s){return s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Rd=4,Id=.001,Ld=1e-7,Fd=10,fr=11,is=1/(fr-1),Nd=typeof Float32Array=="function";function Ah(s,t){return 1-3*t+3*s}function Mh(s,t){return 3*t-6*s}function Sh(s){return 3*s}function ns(s,t,e){return((Ah(t,e)*s+Mh(t,e))*s+Sh(t))*s}function Rh(s,t,e){return 3*Ah(t,e)*s*s+2*Mh(t,e)*s+Sh(t)}function Od(s,t,e,r,i){var n,a,o=0;do a=t+(e-t)/2,n=ns(a,r,i)-s,n>0?e=a:t=a;while(Math.abs(n)>Ld&&++o<Fd);return a}function Pd(s,t,e,r){for(var i=0;i<Rd;++i){var n=Rh(t,e,r);if(n===0)return t;var a=ns(t,e,r)-s;t-=a/n}return t}function Cd(s){return s}var Dd=function(s,t,e,r){if(!(0<=s&&s<=1&&0<=e&&e<=1))throw new Error("bezier x values must be in [0, 1] range");if(s===t&&e===r)return Cd;for(var i=Nd?new Float32Array(fr):new Array(fr),n=0;n<fr;++n)i[n]=ns(n*is,s,e);function a(o){for(var h=0,l=1,u=fr-1;l!==u&&i[l]<=o;++l)h+=is;--l;var d=(o-i[l])/(i[l+1]-i[l]),c=h+d*is,p=Rh(c,s,e);return p>=Id?Pd(o,c,s,e):p===0?c:Od(o,h,h+is,s,e)}return function(o){return o===0?0:o===1?1:ns(a(o),t,r)}};const as=Sd(Dd),kd=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u;function Bd(s){const t=[];for(const n of s){const a=n.word.replace(/\s/g,"").length,o=n.word.split(" ").filter(h=>h.trim().length>0);if(o.length>1){n.word.startsWith(" ")&&t.push({word:" ",startTime:0,endTime:0,obscene:!1});let h=0;for(const l of o){const u={word:l,obscene:n.obscene,startTime:n.startTime+h/a*(n.endTime-n.startTime),endTime:n.startTime+(h+l.length)/a*(n.endTime-n.startTime)};t.push(u),t.push({word:" ",startTime:0,endTime:0,obscene:!1}),h+=l.length}n.word.endsWith(" ")||t.pop()}else t.push({...n})}let e=[],r=[];const i=[];for(const n of t){const a=n.word;e.push(a),r.push(n),a.length>0&&a.trim().length===0?(e.pop(),r.pop(),r.length===1?i.push(r[0]):r.length>1&&i.push(r),i.push(n),e=[],r=[]):(!/^\s*[^\s]*\s*$/.test(e.join(""))||kd.test(a))&&(e.pop(),r.pop(),r.length===1?i.push(r[0]):r.length>1&&i.push(r),e=[a],r=[n])}return r.length===1?i.push(r[0]):i.push(r),i}function Ud(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Gd(s,t=1,e={x:0,y:0}){const[r,i]=[e.x,e.y];return[s[0]*t,s[1]*t,s[2]*t,s[3],s[4]*t,s[5]*t,s[6]*t,s[7],s[8]*t,s[9]*t,s[10]*t,s[11],s[12]-r*t+r,s[13]-i*t+i,s[14],s[15]]}function jd(s,t=4){const e=(r,i)=>r.toFixed(t);return`matrix3d(${s.map(e).join(", ")})`}function zd(s){const t=[];function e(){const r=t[0];r&&s(...r.args).then(i=>{r.resolve(i)}).catch(i=>{r.reject(i)}).finally(()=>{t.shift(),t.length>0&&e()})}return(...r)=>new Promise((i,n)=>{t.push({resolve:i,reject:n,args:r}),t.length===1&&e()})}const os=32,Ih=(s,t)=>e=>Math.min(1,Math.max(0,(e-s)/(t-s))),ki=.5,Vd=Ih(0,ki),Hd=Ih(ki,1),Xd=as(.2,.4,.58,1),Wd=as(.3,0,.58,1),$d=s=>t=>t<s?Xd(Vd(t)):1-Wd(Hd(t));function Lh(s,t=0,e="rgba(0,0,0,var(--bright-mask-alpha, 1.0))",r="rgba(0,0,0,var(--dark-mask-alpha, 1.0))"){const i=2+s+t,n=s/i,a=(1-n)/2;return[`linear-gradient(to right,${e} ${a*100}%,${r} ${(a+n)*100}%)`,i]}let qd=class extends MouseEvent{constructor(s,t){super(t.type,t),this.line=s}};function Yd(s){const t=s.match(/matrix\(([^)]+)\)/);if(t){const e=t[1].split(", "),r=Number.parseFloat(e[0]),i=Number.parseFloat(e[3]);return(r+i)/2}return 1}let Kd=class extends $e{constructor(s,t={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),I(this,"element",document.createElement("div")),I(this,"splittedWords",[]),I(this,"lineSize",[0,0]),I(this,"listenersMap",new Map),I(this,"onMouseEvent",n=>{const a=new qd(this,n);for(const o of this.listenersMap.get(n.type)??[])o.call(this,a);if(!this.dispatchEvent(a)||a.defaultPrevented)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1}),I(this,"isEnabled",!1),I(this,"lastWord"),I(this,"measureLockMark",!1),I(this,"measureLock",zd(async n=>{this.measureLockMark||(this.measureLockMark=!0,this._hide&&await ss(()=>{this._prevParentEl.appendChild(this.element),this.element.style.display="",this.element.style.visibility="hidden"}),await n(),this._hide&&await ss(()=>{this._prevParentEl.removeChild(this.element),this.element.style.display="none",this.element.style.visibility=""}),this.measureLockMark=!1)})),I(this,"_hide",!0),I(this,"_prevParentEl"),I(this,"lastStyle",""),I(this,"maskImageDirty",!1),I(this,"markImageDirtyPromiseResolve",new Set),I(this,"markImageDirtyPromise",new Promise(n=>{this.markImageDirtyPromiseResolve.add(n)})),this.lyricPlayer=s,this.lyricLine=t,this._prevParentEl=s.getElement(),this.element.setAttribute("class",ct.lyricLine),this.lyricLine.isBG&&this.element.classList.add(ct.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(ct.lyricDuetLine),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const e=this.element.children[0],r=this.element.children[1],i=this.element.children[2];e.setAttribute("class",ct.lyricMainLine),r.setAttribute("class",ct.lyricSubLine),i.setAttribute("class",ct.lyricSubLine),this.rebuildElement(),this.rebuildStyle(),this.markMaskImageDirty("Initial construction")}addMouseEventListener(s,t,e){if(t){const r=this.listenersMap.get(s)??new Set;r.size===0&&this.element.addEventListener(s,this.onMouseEvent,e),r.add(t),this.listenersMap.set(s,r)}}removeMouseEventListener(s,t,e){if(t){const r=this.listenersMap.get(s);r&&(r.delete(t),r.size===0&&this.element.removeEventListener(s,this.onMouseEvent,e))}}areWordsOnSameLine(s,t){if(s!=null&&s.mainElement&&t!=null&&t.mainElement){const e=s.mainElement,r=t.mainElement,i=e.getBoundingClientRect(),n=r.getBoundingClientRect();return Math.abs(i.top-n.top)<10}return!0}async enable(s=this.lyricLine.startTime){this.isEnabled=!0,this.element.classList.add(ct.active),await this.waitMaskImageUpdated();const t=this.element.children[0];for(const e of this.splittedWords){for(const r of e.elementAnimations)r.currentTime=0,r.playbackRate=1,r.play();for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,s-this.lyricLine.startTime)),r.playbackRate=1,r.play()}t.classList.add(ct.active)}disable(){this.isEnabled=!1,this.element.classList.remove(ct.active);const s=this.element.children[0];for(const t of this.splittedWords)for(const e of t.elementAnimations)(e.id==="float-word"||e.id.includes("emphasize-word-float-only"))&&(e.playbackRate=-1,e.play());s.classList.remove(ct.active)}async resume(){if(await this.waitMaskImageUpdated(),!!this.isEnabled)for(const s of this.splittedWords){for(const t of s.elementAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(s))&&t.play();for(const t of s.maskAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(s))&&t.play()}}async pause(){if(await this.waitMaskImageUpdated(),!!this.isEnabled)for(const s of this.splittedWords){for(const t of s.elementAnimations)t.pause();for(const t of s.maskAnimations)t.pause()}}setMaskAnimationState(s=0){const t=s-this.lyricLine.startTime;for(const e of this.splittedWords)for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,t)),r.playbackRate=1,t>=0&&t<this.totalDuration?r.play():r.pause()}async measureSize(){return await this.measureLock(async()=>{const s=await Di(()=>[this.element.clientWidth,this.element.clientHeight]);this.lineSize=s}),this.lineSize}getLine(){return this.lyricLine}show(){this._hide=!1,!this.measureLockMark&&!this.element.parentElement&&this._prevParentEl.appendChild(this.element),this.rebuildStyle()}hide(){this._hide=!0,!this.measureLockMark&&this.element.parentElement&&this._prevParentEl.removeChild(this.element)}rebuildStyle(){let s="";s+=`transform:translateY(${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${(this.lineTransforms.scale.getCurrentPosition()/100).toFixed(4)});`,!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(s+=`transition-delay:${this.delay}ms;`),s+=`filter:blur(${Math.min(32,this.blur)}px);`,s!==this.lastStyle&&(this.lastStyle=s,this.element.setAttribute("style",s))}rebuildElement(){this.disposeElements();const s=this.element.children[0],t=this.element.children[1],e=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){s.innerText=this.lyricLine.words.map(i=>i.word).join(""),t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric;return}const r=Bd(this.lyricLine.words);s.innerHTML="";for(const i of r)if(Array.isArray(i)){if(i.length===0)continue;const n=i.reduce((l,u)=>(l.endTime=Math.max(l.endTime,u.endTime),l.startTime=Math.min(l.startTime,u.startTime),l.word+=u.word,l),{word:"",startTime:Number.POSITIVE_INFINITY,endTime:Number.NEGATIVE_INFINITY,wordType:"normal",obscene:!1}),a=i.map(l=>$e.shouldEmphasize(l)).reduce((l,u)=>l||u,$e.shouldEmphasize(n)),o=document.createElement("span");o.classList.add(ct.emphasizeWrapper);const h=[];for(const l of i){const u=document.createElement("span");if(a){u.classList.add(ct.emphasize);const d=[];for(const p of l.word.trim().split("")){const v=document.createElement("span");v.innerText=p,d.push(v),h.push(v),u.appendChild(v)}const c={...l,mainElement:u,subElements:d,elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a};this.splittedWords.push(c)}else u.innerText=l.word,this.splittedWords.push({...l,mainElement:u,subElements:[],elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a});o.appendChild(u)}a&&this.splittedWords[this.splittedWords.length-1].elementAnimations.push(...this.initEmphasizeAnimation(n,h,n.endTime-n.startTime,n.startTime-this.lyricLine.startTime)),n.word.trimStart()!==n.word&&s.appendChild(document.createTextNode(" ")),s.appendChild(o),n.word.trimEnd()!==n.word&&$e.shouldEmphasize(n)&&s.appendChild(document.createTextNode(" "))}else if(i.word.trim().length===0)s.appendChild(document.createTextNode(" "));else{const n=$e.shouldEmphasize(i),a=document.createElement("span"),o={...i,mainElement:a,subElements:[],elementAnimations:[this.initFloatAnimation(i,a)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:n};if($e.shouldEmphasize(i)){a.classList.add(ct.emphasize);const h=[];for(const u of i.word.trim().split("")){const d=document.createElement("span");d.innerText=u,h.push(d),a.appendChild(d)}o.subElements=h;const l=Math.abs(o.endTime-o.startTime);o.elementAnimations.push(...this.initEmphasizeAnimation(i,h,l,o.startTime-this.lyricLine.startTime))}else a.innerText=i.word.trim();i.word.trimStart()!==i.word&&s.appendChild(document.createTextNode(" ")),s.appendChild(a),i.word.trimEnd()!==i.word&&s.appendChild(document.createTextNode(" ")),this.splittedWords.push(o)}t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric}initFloatAnimation(s,t){const e=s.startTime-this.lyricLine.startTime,r=Math.max(1e3,s.endTime-s.startTime);let i=.05;this.lyricLine.isBG&&(i*=2);const n=t.animate([{transform:"translateY(0px)"},{transform:`translateY(${-i}em)`}],{duration:Number.isFinite(r)?r:0,delay:Number.isFinite(e)?e:0,id:"float-word",composite:"add",fill:"both",easing:"ease-out"});return n.pause(),n}initEmphasizeAnimation(s,t,e,r){const i=Math.max(0,r);let n=Math.max(1e3,e),a=[],o=n/2e3;o=o>1?Math.sqrt(o):o**3;let h=n/3e3;h=h>1?Math.sqrt(h):h**3,o*=.6,h*=.5,this.lyricLine.words.length>0&&s.word.includes(this.lyricLine.words[this.lyricLine.words.length-1].word)&&(o*=1.6,h*=1.5,n*=1.2),o=Math.min(1.2,o),h=Math.min(.8,h);const l=Number.isFinite(n)?n:0,u=$d(ki);return a=t.flatMap((d,c,p)=>{const v=i+n/2.5/p.length*c,f=[],m=new Array(os).fill(0).map((M,g)=>{const S=(g+1)/os,b=u(S),B=u(S)*h,C=Gd(Ud(),1+b*.1*o),G=-b*.03*o*(p.length/2-c),D=-b*.025*o;return{offset:S,transform:`${jd(C,4)} translate(${G}em, ${D}em)`,textShadow:`0 0 ${Math.min(.3,h*.3)}em rgba(255, 255, 255, ${B})`}}),y=d.animate(m,{duration:l,delay:Number.isFinite(v)?v:0,id:`emphasize-word-${d.innerText}-${c}`,iterations:1,composite:"replace",fill:"both"});y.onfinish=()=>{y.pause()},y.pause(),f.push(y);const x=new Array(os).fill(0).map((M,g)=>{const S=(g+1)/os;let b=Math.sin(S*Math.PI);return this.lyricLine.isBG&&(b*=2),{offset:S,transform:`translateY(${-b*.05}em)`}}),T=d.animate(x,{duration:l*1.4,delay:Number.isFinite(v)?v-400:0,id:"emphasize-word-float",iterations:1,composite:"add",fill:"both"});return T.onfinish=()=>{T.pause()},T.pause(),f.push(T),f}),a}get totalDuration(){return this.lyricLine.endTime-this.lyricLine.startTime}markMaskImageDirty(s=""){this.maskImageDirty=!0,this.element.classList.contains(ct.dirty)||this.element.classList.add(ct.dirty);const t=Promise.all([this.markImageDirtyPromise,new Promise(e=>{this.markImageDirtyPromiseResolve.add(e)})]).then(()=>{});return this.markImageDirtyPromise=t,t}waitMaskImageUpdated(){return this.markImageDirtyPromise}async updateMaskImage(){this.maskImageDirty=!1,await this.measureLock(async()=>{await Promise.all(this.splittedWords.map(async s=>{const t=s.mainElement;t?await Di(()=>{s.padding=Number.parseFloat(getComputedStyle(t).paddingLeft),s.width=t.clientWidth-s.padding*2,s.height=t.clientHeight-s.padding*2}):(s.width=0,s.height=0,s.padding=0),s.width*s.height===0&&console.warn("Word size is zero")})),await ss(()=>{this.lyricPlayer.supportMaskImage?this.generateWebAnimationBasedMaskImage():this.generateCalcBasedMaskImage()})});for(const s of this.markImageDirtyPromiseResolve)s(),this.markImageDirtyPromiseResolve.delete(s);await ss(()=>{this.element.classList.remove(ct.dirty)})}generateCalcBasedMaskImage(){for(const s of this.splittedWords){const t=s.mainElement;if(t){s.width=t.clientWidth,s.height=t.clientHeight;const e=s.height*this.lyricPlayer.getWordFadeWidth(),[r,i]=Lh(e/s.width),n=`${i*100}% 100%`;this.lyricPlayer.supportMaskImage?(t.style.maskImage=r,t.style.maskRepeat="no-repeat",t.style.maskOrigin="left",t.style.maskSize=n):(t.style.webkitMaskImage=r,t.style.webkitMaskRepeat="no-repeat",t.style.webkitMaskOrigin="left",t.style.webkitMaskSize=n);const a=s.width+e,o=`clamp(${-a}px,calc(${-a}px + (var(--amll-player-time) - ${s.startTime})*${a/Math.abs(s.endTime-s.startTime)}px),0px) 0px, left top`;t.style.maskPosition=o,t.style.webkitMaskPosition=o}}}generateWebAnimationBasedMaskImage(){const s=Math.max(this.splittedWords.reduce((t,e)=>Math.max(e.endTime,t),0),this.lyricLine.endTime)-this.lyricLine.startTime;this.splittedWords.forEach((t,e)=>{const r=t.mainElement;if(r){const i=t.height*this.lyricPlayer.getWordFadeWidth(),[n,a]=Lh(i/(t.width+t.padding*2)),o=`${a*100}% 100%`;this.lyricPlayer.supportMaskImage?(r.style.maskImage=n,r.style.maskRepeat="no-repeat",r.style.maskOrigin="left",r.style.maskSize=o):(r.style.webkitMaskImage=n,r.style.webkitMaskRepeat="no-repeat",r.style.webkitMaskOrigin="left",r.style.webkitMaskSize=o);const h=this.splittedWords.slice(0,e).reduce((x,T)=>x+T.width,0)+(this.splittedWords[0]?i:0),l=-(t.width+t.padding*2+i),u=x=>Math.max(l,Math.min(0,x));let d=-h-t.width-t.padding-i,c=0;const p=[];let v=d,f=0;const m=()=>{const x=d-v,T=Math.max(0,Math.min(1,c)),M=T-f,g=Math.abs(M/x);if(d>l&&v<l){const B=Math.abs(v-l)*g,C=`${u(v)}px 0`,G={offset:f+B,maskPosition:C};p.push(G)}if(d>0&&v<0){const B=Math.abs(v)*g,C=`${u(d)}px 0`,G={offset:f+B,maskPosition:C};p.push(G)}const S=`${u(d)}px 0`,b={offset:T,maskPosition:S};p.push(b),v=d,f=T};m();let y=0;this.splittedWords.forEach((x,T)=>{{const M=x.startTime-this.lyricLine.startTime,g=M-y;c+=g/s,g>0&&m(),y=M}{const M=x.endTime-x.startTime;c+=M/s,d+=x.width,T===0&&(d+=i*1.5),T===this.splittedWords.length-1&&(d+=i*.5),M>0&&m(),y+=M}});for(const x of t.maskAnimations)x.cancel();try{const x=r.animate(p,{duration:s||1,id:`fade-word-${t.word}-${e}`,fill:"both"});x.pause(),t.maskAnimations=[x]}catch(x){console.warn("\u5E94\u7528\u6E10\u53D8\u52A8\u753B\u53D1\u751F\u9519\u8BEF",p,s,x)}}})}getElement(){return this.element}setTransform(s=this.top,t=this.scale,e=1,r=0,i=!1,n=0){super.setTransform(s,t,e,r,i,n);const a=this.isInSight,o=this.lyricPlayer.getEnableSpring();this.top=s,this.scale=t,this.delay=n*1e3|0;const h=this.element.children[0];if(h.style.opacity=`${e}`,i||!o){if(this.blur=Math.min(32,r),i&&this.element.classList.add(ct.tmpDisableTransition),this.lineTransforms.posY.setPosition(s),this.lineTransforms.scale.setPosition(t),o)this.rebuildStyle();else{const l=this.isInSight;a||l?this.show():this.hide()}i&&requestAnimationFrame(()=>{this.element.classList.remove(ct.tmpDisableTransition)})}else if(this.lineTransforms.posY.setTargetPosition(s,n),this.lineTransforms.scale.setTargetPosition(t),this.blur!==Math.min(32,r)){this.blur=Math.min(32,r);const l=r.toFixed(3);this.element.style.filter=`blur(${l}px)`}}update(s=0){if(this.lyricPlayer.getEnableSpring())if(this.lineTransforms.posY.update(s),this.lineTransforms.scale.update(s),this.isInSight?(this.show(),this.maskImageDirty&&this.updateMaskImage()):this.hide(),this.lyricPlayer.getEnableSpring())this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.2+.2}`);else{const t=window.getComputedStyle(this.element).transform,e=Yd(t);this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.2+.2}`)}}_getDebugTargetPos(){return`[\u4F4D\u79FB: ${this.top}; \u7F29\u653E: ${this.scale}; \u5EF6\u65F6: ${this.delay}]`}get isInSight(){const s=this.lineTransforms.posY.getCurrentPosition(),t=this.lineSize[1],e=s+t,r=this.lyricPlayer.size[1];return!(s>r+t||e<-t)}disposeElements(){var s,t;for(const e of this.splittedWords){for(const r of e.elementAnimations)r.cancel();for(const r of e.maskAnimations)r.cancel();for(const r of e.subElements)r.remove(),(s=r.parentNode)==null||s.removeChild(r);e.elementAnimations=[],e.maskAnimations=[],e.subElements=[],e.mainElement.remove(),(t=e.mainElement.parentNode)==null||t.removeChild(e.mainElement)}this.splittedWords=[]}dispose(){this.disposeElements(),this.element.remove()}};class Zd extends MouseEvent{constructor(t,e,r){super(`line-${r.type}`,r),this.lineIndex=t,this.line=e}}class Jd extends Md{constructor(){super(),I(this,"currentLyricLineObjects",[]),I(this,"debounceCalcLayout",dd(()=>this.calcLayout(!0,!0).then(()=>this.currentLyricLineObjects.map(async(t,e)=>{t.markMaskImageDirty("DomLyricPlayer onResize"),await t.waitMaskImageUpdated(),this.hotLines.has(e)&&(t.enable(this.currentTime),t.resume())})),1e3)),I(this,"supportPlusLighter",CSS.supports("mix-blend-mode","plus-lighter")),I(this,"supportMaskImage",CSS.supports("mask-image","none")),I(this,"innerSize",[0,0]),I(this,"onLineClickedHandler",t=>{const e=new Zd(this.lyricLinesIndexes.get(t.line)??-1,t.line,t);this.dispatchEvent(e)||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}),I(this,"_baseFontSize",Number.parseFloat(getComputedStyle(this.element).fontSize)),this.onResize(),this.element.classList.add("amll-lyric-player","dom"),this.disableSpring&&this.element.classList.add(ct.disableSpring)}onResize(){const t=getComputedStyle(this.element);this._baseFontSize=Number.parseFloat(t.fontSize);const e=this.element.clientWidth-Number.parseFloat(t.paddingLeft)-Number.parseFloat(t.paddingRight),r=this.element.clientHeight-Number.parseFloat(t.paddingTop)-Number.parseFloat(t.paddingBottom);this.innerSize[0]=e,this.innerSize[1]=r,this.rebuildStyle();for(const i of this.currentLyricLineObjects)i.getElement().classList.contains(ct.dirty)||i.getElement().classList.add(ct.dirty);this.debounceCalcLayout()}_getIsNonDynamic(){return this.isNonDynamic}get baseFontSize(){return this._baseFontSize}rebuildStyle(){const t=this.innerSize[0],e=this.innerSize[1];this.element.style.setProperty("--amll-lp-width",`${t.toFixed(4)}px`),this.element.style.setProperty("--amll-lp-height",`${e.toFixed(4)}px`)}setWordFadeWidth(t=.5){super.setWordFadeWidth(t);for(const e of this.currentLyricLineObjects)e.markMaskImageDirty("DomLyricPlayer setWordFadeWidth")}setLyricLines(t,e=0){super.setLyricLines(t,e),this.hasDuetLine?this.element.classList.add(ct.hasDuetLine):this.element.classList.remove(ct.hasDuetLine);for(const r of this.currentLyricLineObjects)r.removeMouseEventListener("click",this.onLineClickedHandler),r.removeMouseEventListener("contextmenu",this.onLineClickedHandler),r.dispose();this.currentLyricLineObjects=this.processedLines.map((r,i)=>{const n=new Kd(this,r);return n.addMouseEventListener("click",this.onLineClickedHandler),n.addMouseEventListener("contextmenu",this.onLineClickedHandler),this.element.appendChild(n.getElement()),this.lyricLinesIndexes.set(n,i),n.markMaskImageDirty("DomLyricPlayer setLyricLines"),n}),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.calcLayout(!0,!0).then(()=>{this.initialLayoutFinished=!0})}pause(){super.pause(),this.interludeDots.pause();for(const t of this.currentLyricLineObjects)t.pause()}resume(){super.resume(),this.interludeDots.resume();for(const t of this.currentLyricLineObjects)t.resume()}update(t=0){if(!this.initialLayoutFinished||(super.update(t),!this.isPageVisible))return;const e=t/1e3;this.interludeDots.update(t),this.bottomLine.update(e);for(const r of this.currentLyricLineObjects)r.update(e)}dispose(){super.dispose(),this.element.remove();for(const t of this.currentLyricLineObjects)t.dispose();this.bottomLine.dispose(),this.interludeDots.dispose()}}as(.2,.4,.58,1),as(.3,0,.58,1);const Qd=Jd;it.forwardRef(({album:s,albumIsVideo:t,fps:e,playing:r,flowSpeed:i,renderScale:n,staticMode:a,lowFreqVolume:o,hasLyric:h,renderer:l,style:u,...d},c)=>{const p=it.useRef(),v=it.useRef(null),f=it.useRef(),m=l??Kc;return it.useEffect(()=>{var y;(f.current!==m||p.current===void 0)&&(f.current=m,(y=p.current)==null||y.dispose(),p.current=Ri.new(m))},[m]),it.useEffect(()=>{var y;m&&s&&((y=p.current)==null||y.setAlbum(s,t))},[m,s,t]),it.useEffect(()=>{var y;m&&e&&((y=p.current)==null||y.setFPS(e))},[m,e]),it.useEffect(()=>{var y,x,T;m&&(r===void 0?(y=p.current)==null||y.resume():r?(x=p.current)==null||x.resume():(T=p.current)==null||T.pause())},[m,r]),it.useEffect(()=>{var y;m&&i&&((y=p.current)==null||y.setFlowSpeed(i))},[m,i]),it.useEffect(()=>{var y;m&&((y=p.current)==null||y.setStaticMode(a??!1))},[m,a]),it.useEffect(()=>{var y;m&&n&&((y=p.current)==null||y.setRenderScale(n??.5))},[m,n]),it.useEffect(()=>{var y;m&&o&&((y=p.current)==null||y.setLowFreqVolume(o??1))},[m,o]),it.useEffect(()=>{var y;m&&h!==void 0&&((y=p.current)==null||y.setHasLyric(h??!0))},[m,h]),it.useEffect(()=>{var y;if(p.current){const x=p.current.getElement();x.style.width="100%",x.style.height="100%",x.style.minHeight="0",x.style.minWidth="0",x.style.overflow="hidden",(y=v.current)==null||y.appendChild(x)}},[p.current]),it.useImperativeHandle(c,()=>({wrapperEl:v.current,bgRender:p.current}),[v.current,p.current]),tr.jsx("div",{style:{display:"contents",...u},...d,ref:v})});const tf=it.forwardRef(({disabled:s,playing:t,alignAnchor:e,alignPosition:r,enableSpring:i,enableBlur:n,enableScale:a,hidePassedLines:o,lyricLines:h,currentTime:l,isSeeking:u,wordFadeWidth:d,linePosXSpringParams:c,linePosYSpringParams:p,lineScaleSpringParams:v,bottomLine:f,lyricPlayer:m,onLyricLineClick:y,onLyricLineContextMenu:x,...T},M)=>{const[g,S]=it.useState(),b=it.useRef(null),B=it.useRef(l);return it.useLayoutEffect(()=>{var C;const G=new(m??Qd);return S(G),(C=b.current)==null||C.appendChild(G.getElement()),()=>{G?.dispose(),S(void 0)}},[m]),it.useLayoutEffect(()=>{h!==void 0?(g?.setLyricLines(h,B.current),g?.update()):(g?.setLyricLines([]),g?.update())},[g,h]),it.useEffect(()=>{if(!s){let C=!1,G=-1;const D=U=>{C||(G===-1&&(G=U),g?.update(U-G),G=U,requestAnimationFrame(D))};return g?.calcLayout(),requestAnimationFrame(D),()=>{C=!0}}},[g,s]),it.useEffect(()=>{t!==void 0?t?g?.resume():g?.pause():g?.resume()},[g,t]),it.useEffect(()=>{e!==void 0&&g?.setAlignAnchor(e)},[g,e]),it.useEffect(()=>{o!==void 0&&g?.setHidePassedLines(o)},[g,o]),it.useEffect(()=>{r!==void 0&&g?.setAlignPosition(r)},[g,r]),it.useEffect(()=>{i!==void 0?g?.setEnableSpring(i):g?.setEnableSpring(!0)},[g,i]),it.useEffect(()=>{a!==void 0?g?.setEnableScale(a):g?.setEnableScale(!0)},[g,a]),it.useEffect(()=>{g?.setEnableBlur(n??!0)},[g,n]),it.useEffect(()=>{l!==void 0?(g?.setCurrentTime(l),B.current=l):g?.setCurrentTime(0)},[g,l]),it.useEffect(()=>{g?.setIsSeeking(!!u)},[g,u]),it.useEffect(()=>{g?.setWordFadeWidth(d)},[g,d]),it.useEffect(()=>{c!==void 0&&g?.setLinePosXSpringParams(c)},[g,c]),it.useEffect(()=>{p!==void 0&&g?.setLinePosYSpringParams(p)},[g,p]),it.useEffect(()=>{v!==void 0&&g?.setLineScaleSpringParams(v)},[g,v]),it.useEffect(()=>{if(y){const C=G=>y(G);return g?.addEventListener("line-click",C),()=>g?.removeEventListener("line-click",C)}},[g,y]),it.useEffect(()=>{if(x){const C=G=>x(G);return g?.addEventListener("line-contextmenu",C),()=>g?.removeEventListener("line-contextmenu",C)}},[g,x]),it.useImperativeHandle(M,()=>({wrapperEl:b.current,lyricPlayer:g}),[g]),tr.jsxs(tr.Fragment,{children:[tr.jsx("div",{...T,ref:b}),g!=null&&g.getBottomLineElement()&&f?xf.createPortal(f,g?.getBottomLineElement()):null]})}),Fh=-1,hs=0,pr=1,ls=2,Bi=3,Ui=4,Gi=5,ji=6,Nh=7,Oh=8,Ph=typeof self=="object"?self:globalThis,ef=(s,t)=>{const e=(i,n)=>(s.set(n,i),i),r=i=>{if(s.has(i))return s.get(i);const[n,a]=t[i];switch(n){case hs:case Fh:return e(a,i);case pr:{const o=e([],i);for(const h of a)o.push(r(h));return o}case ls:{const o=e({},i);for(const[h,l]of a)o[r(h)]=r(l);return o}case Bi:return e(new Date(a),i);case Ui:{const{source:o,flags:h}=a;return e(new RegExp(o,h),i)}case Gi:{const o=e(new Map,i);for(const[h,l]of a)o.set(r(h),r(l));return o}case ji:{const o=e(new Set,i);for(const h of a)o.add(r(h));return o}case Nh:{const{name:o,message:h}=a;return e(new Ph[o](h),i)}case Oh:return e(BigInt(a),i);case"BigInt":return e(Object(BigInt(a)),i);case"ArrayBuffer":return e(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return e(new DataView(o),a)}}return e(new Ph[n](a),i)};return r},Ch=s=>ef(new Map,s)(0),qe="",{toString:rf}={},{keys:sf}=Object,mr=s=>{const t=typeof s;if(t!=="object"||!s)return[hs,t];const e=rf.call(s).slice(8,-1);switch(e){case"Array":return[pr,qe];case"Object":return[ls,qe];case"Date":return[Bi,qe];case"RegExp":return[Ui,qe];case"Map":return[Gi,qe];case"Set":return[ji,qe];case"DataView":return[pr,e]}return e.includes("Array")?[pr,e]:e.includes("Error")?[Nh,e]:[ls,e]},us=([s,t])=>s===hs&&(t==="function"||t==="symbol"),nf=(s,t,e,r)=>{const i=(a,o)=>{const h=r.push(a)-1;return e.set(o,h),h},n=a=>{if(e.has(a))return e.get(a);let[o,h]=mr(a);switch(o){case hs:{let u=a;switch(h){case"bigint":o=Oh,u=a.toString();break;case"function":case"symbol":if(s)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return i([Fh],a)}return i([o,u],a)}case pr:{if(h){let c=a;return h==="DataView"?c=new Uint8Array(a.buffer):h==="ArrayBuffer"&&(c=new Uint8Array(a)),i([h,[...c]],a)}const u=[],d=i([o,u],a);for(const c of a)u.push(n(c));return d}case ls:{if(h)switch(h){case"BigInt":return i([h,a.toString()],a);case"Boolean":case"Number":case"String":return i([h,a.valueOf()],a)}if(t&&"toJSON"in a)return n(a.toJSON());const u=[],d=i([o,u],a);for(const c of sf(a))(s||!us(mr(a[c])))&&u.push([n(c),n(a[c])]);return d}case Bi:return i([o,a.toISOString()],a);case Ui:{const{source:u,flags:d}=a;return i([o,{source:u,flags:d}],a)}case Gi:{const u=[],d=i([o,u],a);for(const[c,p]of a)(s||!(us(mr(c))||us(mr(p))))&&u.push([n(c),n(p)]);return d}case ji:{const u=[],d=i([o,u],a);for(const c of a)(s||!us(mr(c)))&&u.push(n(c));return d}}const{message:l}=a;return i([o,{name:h,message:l}],a)};return n},Dh=(s,{json:t,lossy:e}={})=>{const r=[];return nf(!(t||e),!!t,new Map,r)(s),r},af=typeof structuredClone=="function"?(s,t)=>t&&("json"in t||"lossy"in t)?Ch(Dh(s,t)):structuredClone(s):(s,t)=>Ch(Dh(s,t)),of="_amllWrapper_xobkp_1",hf="_isDark_xobkp_7",kh={amllWrapper:of,isDark:hf};globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(s,t){return this.cache.has(s)?this.cache.get(s):(this.cache.set(s,t),t)}},globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(s,t){return this.cache.has(s)?this.cache.get(s):(this.cache.set(s,t),t)}},Zi=it.memo(()=>{const s=_f.c(20),t=Me(Tf),e=Me(wf),r=Me(Af),i=Me(Mf),n=Me(Lf),a=Me(Ff),o=Me(Nf),h=it.useRef(null);let l,u;if(s[0]!==t.lyricLines||s[1]!==a||s[2]!==n){let T;s[4]!==a||s[5]!==n?(T=M=>({...M,translatedLyric:n?M.translatedLyric:"",romanLyric:a?M.romanLyric:""}),s[4]=a,s[5]=n,s[6]=T):T=s[6],u=af(t.lyricLines.map(T)),s[0]=t.lyricLines,s[1]=a,s[2]=n,s[3]=u}else u=s[3];l=u;const d=l;let c,p;s[7]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{setTimeout(()=>{h.current?.lyricPlayer?.calcLayout(!0,!0)},1500)},p=[],s[7]=c,s[8]=p):(c=s[7],p=s[8]),it.useEffect(c,p);const v=i&&kh.isDark;let f;s[9]!==v?(f=Ef(kh.amllWrapper,v),s[9]=v,s[10]=f):f=s[10];let m;s[11]===Symbol.for("react.memo_cache_sentinel")?(m={height:"100%",boxSizing:"content-box"},s[11]=m):m=s[11];let y;s[12]!==e||s[13]!==r||s[14]!==d||s[15]!==o?(y=tr.jsx(tf,{style:m,onLyricLineClick:lf,lyricLines:d,currentTime:e,playing:r,wordFadeWidth:o,ref:h}),s[12]=e,s[13]=r,s[14]=d,s[15]=o,s[16]=y):y=s[16];let x;return s[17]!==f||s[18]!==y?(x=tr.jsx(Sf,{className:f,children:y}),s[17]=f,s[18]=y,s[19]=x):x=s[19],x});function lf(s){Rf.seekMusic(s.line.getLine().startTime/1e3)}});export{Zi as AMLLWrapper,Pf as __tla,Zi as default};
